<style>
    .upyunCon {
        height: 628px;
    }
    
    .up-place {
        height: 62px;
        border-bottom: 1px solid #ddd;
    }
    
    .up-place .btn {
        border-radius: 0;
    }
    
    .up-place .place-input {
        background-color: #f3f3f3;
        border: 1px solid #ccc;
        height: 30px;
        line-height: 28px;
        overflow: hidden;
        margin: 1px 0 0 -1px;
        width: 340px;
    }
    
    .place-input ul {
        display: inline-block;
        position: relative;
        width: auto;
    }
    
    .place-input ul li {
        background: url("/static/img/ico/ico-ltr.png") no-repeat right center;
        float: left;
        padding-left: 10px;
        padding-right: 18px;
    }
    
    .place-input ul li a {
        height: 28px;
        cursor: pointer;
        display: inline-block;
    }
    
    .upyunlist {
        height: 516px;
        overflow: auto;
    }
    
    .up-bottom {
        background-color: #fafafa;
        border-top: 1px solid #eee;
        bottom: 0;
        position: absolute;
        width: 100%;
    }
    
    .up-use {
        line-height: 50px
    }
    
    .list-list .cursor span {
        line-height: 30px;
    }
    .list-list .cursor span:nth-of-type(2){
        max-width: 280px;
        display: block;
        overflow:hidden;
        text-overflow:ellipsis;
        white-space: nowrap;
    }
    
    .btn-title {
        margin-top: 1px
    }
    .tip {
        font-size: 10px;
        font-style: oblique;
        color: green;
    }
    </style>
<style> 
.cosfs_path_style.changepath {
    height: 500px
}
.cosfs_path_style.changepath .path-con-left {
    width: 150px;
    height: 500px;
    float: left;
    border-right: #e4e3e3 1px solid;
    padding-top: 10px;
}
.cosfs_path_style.changepath .path-con-left .open_disk span{
    padding-right: 7px;
}
.cosfs_path_style.changepath .path-con-left dl dt {
    height: 30px;
    line-height: 30px;
    font-size: 13px;
    font-weight: normal;
    margin-left: 20px;
    cursor: pointer;
}
.cosfs_path_style.changepath .path-con-left dl::-webkit-scrollbar{
    width: 4px;
}
.cosfs_path_style.changepath .path-con-left dl dd span {
    color: #666
}
.cosfs_path_style.changepath .path-con-right {
    float: left;
    height: 500px;
    overflow: hidden;
    width: 600px
}
.cosfs_path_style.changepath .file-list{
    overflow: auto;
    height: 416px;
    top: -2px;
}
.cosfs_path_style.changepath .file-list .table-hover>tbody>tr {
    height: 50px;
    cursor: pointer;
}
.cosfs_path_style.changepath .file-list .table>tbody>tr>td {
    vertical-align: middle;
}
.cosfs_path_style.changepath .path-con-right .list-list td {
    cursor: auto;
}
.cosfs_path_style.changepath .file-list .list-list span.glyphicon-folder-open {
    margin-right: 15px;
    font-size: 23px;
}

.cosfs_path_style.changepath .list-list span.glyphicon {
    color: #666;
    margin-right: 10px;
    font-size: 18px
}
.cosfs_path_style.changepath .list-list span.glyphicon-folder-open {
    color: #edca5c
}
.cosfs_path_style.changepath .file-list .dir_block {
    display: inline-block;
    height: 30px;
    line-height: 30px;
}
.cosfs_path_style.changepath .table_dir .dir_block, .table_files .dir_block {
    height: 28px;
    line-height: 28px;
    width: 200px;
    display: inline-block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.cosfs_path_style.changepath .table_dir .dir_block.fileWidthStyle, .table_files .dir_block.fileWidthStyle{
    width: 175px;
}
.cosfs_path_style.changepath .list-list .ico-default {
    background-position: center center;
    background-repeat: no-repeat;
    display: inline-block;
    height: 30px;
    margin-right: 9px;
    width: 30px;
}

.getfile-btn {
    background: #f6f8f8 none repeat scroll 0 0;
    border-top: 1px solid #edf1f2;
    padding: 8px 20px 10px;
    text-align: right;
    width: 100%
}
</style>
<style>
.bucket_path_view {
    height: 30px;
    border-bottom: 1px solid #eee;
    font-size: 0;
    box-sizing: content-box;
    padding-bottom: 15px;
}
.bucket_path_view .bucket_path_upper {
    display: inline-block;
    height: 30px;
    line-height: 30px;
    vertical-align: top;
    border: 1px solid #cfcfcf;
    box-sizing: border-box;
    text-align: center;
    vertical-align: top;
    border-top-left-radius: 2px;
    border-bottom-left-radius: 2px;
    border-right: none;
    color: #666;
    padding: 0 12px;
}
.bucket_path_view .bucket_path_upper span {
    font-size: 12px;
    display: inline-block;
    height: 28px;
    line-height: 28px;
    vertical-align: top;
    top: 0;
}
.bucket_path_view .bucket_path_upper:hover {
    background-color: #20a53a;
    color: #fff;
    cursor: pointer;
    border: 1px solid #20a53a;
    border-right: none;
}
.bucket_path_input {
    display: inline-block;
    height: 30px;
    width: 50%;
    box-sizing: border-box;
    position: relative;
    border-top-left-radius: 2px;
    border-bottom-left-radius: 2px;
}
.bucket_path_view .bucket_dir_view {
    white-space: nowrap;
    position: absolute;
    left: 1px;
    height: 30px;
    line-height: 28px;
}
.bucket_path_view input#fileInputPath {
    border: 1px solid #cfcfcf;
    display: inline-block;
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    height: 30px;
    padding-left: 5px;
    box-sizing: border-box;
    background: #f3f3f3;
    font-size: 13px;
}
.bucket_path_view .bucket_path_refresh {
    display: inline-block;
    width: 30px;
    height: 30px;
    line-height: 30px;
    border: 1px solid #cfcfcf;
    box-sizing: border-box;
    text-align: center;
    vertical-align: top;
    border-left: 0;
    border-top-right-radius: 2px;
    border-bottom-right-radius: 2px;
    cursor: pointer;
}
.bucket_path_view .bucket_path_refresh:hover{
    background: #20a53a;
    border-color: #38983b;
}
.bucket_path_view .bucket_path_refresh i {
    font-size: 12px;
    color: #444;
    line-height: 27px;
}
.bucket_path_view .bucket_path_refresh i:hover{
    color: #fff;
}
#bucket_files_view .ico{
    height: 20px;
    margin-right: 5px;
    width: 23px;
    background-size: 80% 80%;
}
</style>
<div class="pd20" id="tencent_cosfs"></div>
<script type="text/javascript">
var bt_tools={table:function(e){function t(e){this.config=e,this.$load()}var a=this;return t.prototype={style_list:[],event_list:{},checkbox_list:[],batch_active:{},event_rows_model:{},data:[],page:"",column:[],batch_thread:[],random:bt.get_random(5),init:!1,checked:!1,$load:function(){var e=this;this.config.init&&this.config.init(this),$(this.config.el).addClass("bt_table"),this.config.minWidth&&this.style_list.push({className:this.config.el+" table",css:"min-width:"+this.config.minWidth}),this.config.tootls?this.$reader_tootls(this.config.tootls):0===$(e.config.el+".divtable").length&&$(e.config.el).append('<div class="divtable mtb10" style="heigth:'+(this.config.height||"auto")+'"></div>'),this.$reader_content(),void 0!==e.config.url?this.$refresh_table_list(e.config.load||!1):void 0!==this.config.data?this.$reader_content(this.config.data):alert("缺少data或url参数"),this.config.methods&&$.extend(this,this.config.methods)},$refresh_table_list:function(e,t){var a=this;this.$http(function(e){t&&t(e),a.$reader_content(e.data,void 0!==e.total?parseInt(e.total):e.page)},e)},$reader_content:function(e,t){var a=this,s="",i="",n=0,c=this.config.column,l={},o=$(a.config.el+" .checkbox_"+a.random);e=e||[],this.data=e,o.length&&(o.removeClass("active selected"),a.checkbox_list=[],a.$set_batch_view());do{var r=e[n],d=0;e.length>0&&(i+="<tr>");for(var h=0;h<c.length;h++){var p=c[h];if($.isEmptyObject(p))d++;else{if(0===n&&!this.init){this.init||this.style_list.push(this.$dynamic_merge_style(p,h-d));var u="sort_"+this.random,f="checkbox_"+this.random,b=p.sortValue||"desc";s+="<th><span "+(p.sort?'class="not-select '+u+(p.sortValue?" sort-active":"")+' cursor-pointer"':"")+' data-index="'+h+'" '+(p.sort?'data-sort="'+b+'"':"")+">"+("checkbox"==p.type?'<label><i class="cust—checkbox cursor-pointer '+f+'" data-checkbox="all"></i><input type="checkbox" class="cust—checkbox-input"></label>':"<span>"+p.title+"</span>")+(p.sort?'<span class="glyphicon glyphicon-triangle-'+("desc"==b?"bottom":"top")+' ml5"></span>':"")+"</span></th>",0===n&&(!l[u]&&p.sort&&(l[u]={event:this.config.sortEvent,eventType:"click",type:"sort"}),l[f]||(l[f]={event:p.checked,eventType:"click",type:"checkbox"}))}if(void 0!==r){var v="",_="event_"+p.fid+"_"+this.random;p.template?v=a.$custom_template_render(p,r,h):(v=this.$reader_column_type(p,r),l=$.extend(l,v[1]),v=v[0]),i+="<td><span "+(p.fixed?'class="fixed" style="width:'+parseInt(p.width)+'px;"':"")+(p.class?'class="'+p.class+'"':"")+" "+(p.tips?'title="'+p.tips+'"':"")+">"+v+"</span></td>",0===n&&!l[_]&&p.event&&(l[_]={event:p.event,eventType:"click",type:"rows"})}}}e.length>0&&(i+="</tr>"),0==e.length&&(i+='<tr><td colspan="'+c.length+'" style="text-align:center;">'+(this.config.default||"数据为空")+"</td></tr>"),n++}while(n<e.length);this.init||this.$style_bind(this.style_list),this.$event_bind(l),this.init?($(this.config.el+" .divtable tbody").html(i),this.config.page&&$(this.config.el+" .page").replaceWith(this.$reader_page(this.config.page,t))):$(this.config.el+" .divtable").append('<table class="table table-hover"><thead>'+s+"</thead><tbody>"+i+"</tbody></table></div></div>"),this.init=!0,this.config.success&&this.config.success(this)},$custom_template_render:function(e,t,a){var s="event_"+e.fid+"_"+this.random,i=e.template(t,a),n=$(i);return n.length>0?template=n.addClass(s)[0].outerHTML:"text"===e.type?template='<span class="'+s+'">'+i+"</span>":template='<a href="javascript:;" class="btlink '+s+'">'+i+"</a>",template},$modify_row_data:function(e){this.event_rows_model.rows=$.extend(this.event_rows_model.rows,e);var t=this.event_rows_model,a=null;a=void 0!==t.model.template?$(this.$custom_template_render(t.model,t.rows,t.index)):$(this.$reader_column_type(t.model,t.rows)[0]),"group"==t.model.type?$(t.el).parent().empty().append(a):t.el.replaceWith(a),t.el=a},$batch_success_table:function(e){var t=this,a=$(e.html).length;bt.open({type:1,title:e.title,area:e.area||["350px","350px"],shadeClose:!1,closeBtn:2,content:e.content||'<div class="batch_title"><span class><span class="batch_icon"></span><span class="batch_text">'+e.title+'操作完成！</span></span></div><div class="'+(a>4?"fiexd_thead":"")+' batch_tabel divtable" style="margin: 15px 30px 15px 30px;overflow: auto;height: 200px;"><table class="table table-hover"><thead><tr><th>'+e.th+'</th><th style="text-align:right;width:120px;">操作结果</th></tr></thead><tbody>'+e.html+"</tbody></table></div>",success:function(){a>4&&t.$fixed_table_thead(".fiexd_thead")}})},$delete_table_row:function(e){this.data.splice(e,1),this.$reader_content(this.data)},$set_batch_view:function(){if(void 0!==this.config.batch){var e=$(this.config.el+" .set_batch_option");if(void 0!==this.config.batch.config)this.checkbox_list.length>0?e.removeClass("bt-disabled btn-default").addClass("btn-success").text("批量"+this.batch_active.title+"(已选中"+this.checkbox_list.length+")"):e.addClass("bt-disabled btn-default").removeClass("btn-success").text("批量"+this.batch_active.title);else{var t=$(this.config.el+" .bt_table_select_group .bt_select_value");this.checkbox_list.length>0?(e.removeClass("bt-disabled btn-default").addClass("btn-success").prev().removeClass("bt-disabled"),t.find("em").html("(已选中"+this.checkbox_list.length+")")):(e.addClass("bt-disabled btn-default").removeClass("btn-success").prev().addClass("bt-disabled"),t.children().eq(0).html("请选择批量操作<em></em>"),t.next().find("li").removeClass("active"),this.batch_active={})}}},$reader_column_type:function(e,t){var a=t[e.fid],s={},i="click_"+e.fid+"_"+this.random,n=[],c=this;switch(e.type){case"text":n=[a,s];break;case"checkbox":n=['<label><i class="cust—checkbox cursor-pointer checkbox_'+this.random+'"></i><input type="checkbox" class="cust—checkbox-input"></label>',s];break;case"password":i="ico_"+c.random+"_";var l='<span class="bt-table-password mr10"><i>**********</i></span>';e.eye_open&&(l+='<span class="glyphicon cursor pw-ico glyphicon-eye-open mr10 '+i+'eye_open" title="显示密码"></span>',s[i+"eye_open"]||(s[i+"eye_open"]={type:"eye_open_password"})),e.copy&&(l+='<span class="ico-copy cursor btcopy mr10 '+i+'copy" title="复制密码"></span>',s[i+"copy"]||(s[i+"copy"]={type:"copy_password"})),n=[l,s];break;case"link":!s[i]&&e.event&&(s[i]={event:e.event,type:"rows"}),n=['<a class="btlink '+i+'" href="'+(e.href?a:"javascript:;")+'" '+(e.href?'target="'+(e.target||"_blank")+'"':"")+' title="'+a+'">'+a+"</a>",s];break;case"input":blurName="blur_"+e.fid+"_"+this.random,keyupName="keyup_"+e.fid+"_"+this.random,!s[blurName]&&e.blur&&(s[blurName]={event:e.blur,eventType:"blur",type:"rows"}),!s[keyupName]&&e.keyup&&(s[keyupName]={event:e.keyup,eventType:"keyup",type:"rows"}),n=['<input type="text" title="点击编辑内容，按回车或失去焦点自动保存"  class="table-input '+blurName+" "+keyupName+'" data-value="'+a+'" value="'+a+'" />',s];break;case"status":var o="";$.each(e.config.list,function(e,t){t[0]===a&&(o=t)}),!s[i]&&e.event&&(s[i]={event:e.event,type:"rows"}),n=['<a class="btlink '+i+" "+(o[2].indexOf("#")>-1?"":o[2])+'" style="'+(o[2].indexOf("#")>-1?"color:"+o[2]+";":"")+'" href="javascript:;"><span>'+o[1]+"</span>"+(e.config.icon?'<span class="glyphicon '+o[3]+'"></span>':"")+"</a>",s];break;case"switch":o="";var r=bt.get_random(5);e.status.on==a&&(o="checked"),!s[i]&&e.event&&(s[i]={event:e.event,type:"rows"}),n=['<div class="switch_group"><input class="btswitch btswitch-ios '+i+'" id="'+r+'" type="checkbox" '+o+'><label class="btswitch-btn" for="'+r+'" data-index="0" bt-event-click="set_site_server_status"></label></div>',s];break;case"group":var d="";$.each(e.group,function(a,n){i=(e.fid?e.fid:"group")+"_"+a+"_"+c.random;var l=!1;if(n.template){var o=n.template(t,c),r=$(o);r.length>0?d+=r.addClass(i)[0].outerHTML:d+='<a href="javascript:;" class="btlink '+i+'" title="'+(n.title||"")+'">'+o+"</a>"}else{if(void 0!==n.hide&&(l="boolean"==typeof n.hide?n.hide:n.hide(t),"boolean"!=typeof l))return!1;d+='<a href="javascript:;" class="btlink '+i+'" '+(l?'style="display:none;"':"")+' title="'+(n.tips||n.title)+'">'+n.title+"</a>"}l||(d+=e.group.length==a+1?"":"&nbsp;&nbsp;|&nbsp;&nbsp;"),!s[i]&&n.event&&(s[i]={event:n.event,type:"rows"})}),n=[d,s];break;default:n=[a,s]}return n},$batch_success_table:function(e){a.$batch_success_table(e)},$reader_tootls:function(e){function t(e,t){var a=bt.load("正在执行批量"+e.title+"，请稍候..."),i={},n=s.$get_data_batch_list(e.paramId,t);e.beforeRequest?i[e.paramName]=e.beforeRequest(t):i[e.paramName]=n.join(","),bt_tools.send({url:e.url||s.config.batch.url,data:$.extend(e.param||{},i)},function(i){if(a.close(),!1===i.status&&void 0===i.success)return bt_tools.msg(i),!1;if(void 0===e.tips||e.tips){var n="";$.each(i.error,function(e,t){n+='<tr><td><span class="text-overflow" title="'+e+'">'+e+'</span/></td><td><div style="float:right;" class="size_ellipsis"><span style="color:red">'+t+"</span></div></td></tr>"}),$.each(i.success,function(e,t){n+='<tr><td><span class="text-overflow" title="'+t+'">'+t+'</span></td><td><div style="float:right;" class="size_ellipsis"><span style="color:#20a53a">操作成功</span></div></td></tr>'}),s.$batch_success_table({title:"批量"+e.title,th:e.theadName,html:n}),e.refresh&&s.$refresh_table_list(!0)}else if(!e.success){n="";$.each(t,function(t,a){n+='<tr><td><span class="text-overflow" title="'+a.name+'">'+a.name+'</span></td><td><div style="float:right;"><span style="color:'+(i.status?"#20a53a":"red")+'">'+((void 0!==e.theadValue?e.theadValue[i.status?0:1]:null)||i.msg)+"</span></div></td></tr>"}),s.$batch_success_table({title:"批量"+e.title+"完成",th:e.theadName,html:n}),e.refresh&&s.$refresh_table_list(!0)}e.success&&e.success(i,t,s)})}function a(e,a,i){var n={loadT:0,config:{},check_list:a,bacth_status:!0,start_batch:function(t,a){void 0===t&&(t={}),"function"==typeof t&&(a=t,t={}),e.load&&(this.loadT=layer.msg("正在执行批量"+e.title+'，<span class="batch_progress">进度:0/'+this.check_list.length+"</span>,请稍候...",{icon:16,skin:"batch_tips",shade:.3,time:0,area:"400px"})),this.config={param:t,url:e.url},this.bacth(a)},bacth:function(t,n){var c=this,l={};if("function"!=typeof t&&void 0!==t||(n=t,t=0),t<this.check_list.length){if(l="function"==typeof e.param?e.param(a[t]):e.param,this.config.param=$.extend(this.config.param,l),void 0!==e.paramId&&(c.config.param[e.paramName||e.paramId]=c.check_list[t][e.paramId]),void 0!==e.beforeBacth&&(this.config.param=$.extend(this.config.param,e.beforeBacth(c.check_list[t]))),this.config.param.bacth&&t==this.check_list.length-1&&delete this.config.param.bacth,!c.bacth_status)return!1;e.load&&$("#layui-layer"+c.loadT).find(".layui-layer-content").html('<i class="layui-layer-ico layui-layer-ico16"></i>正在执行批量'+e.title+'，<span class="batch_progress">进度:'+t+"/"+c.check_list.length+"</span>，请稍候..."+(e.clear?'<a href="javascript:;" class="btlink clear_batch" style="margin-left:20px;">取消</a>':"")),bt_tools.send({url:this.config.url,data:this.config.param,bacth:!0},function(e){$.extend(c.check_list[t],{request:{status:"boolean"==typeof e.status&&e.status,msg:e.msg||"请求网络错误"}}),t++,c.bacth(t,n)})}else{if(i&&i(),n&&n(this.check_list),e.automatic){for(var o="",r=0;r<this.check_list.length;r++){var d=this.check_list[r];o+="<tr><td>"+(void 0!==d[e.paramThead]?d[e.paramThead]:d.name)+'</td><td><div style="float:right;"><span style="color:'+(d.request.status?"#20a53a":"red")+'">'+d.request.msg+"</span></div></td></tr>"}s.$batch_success_table({title:"批量"+e.title,th:e.theadName,html:o}),e.refresh&&s.$refresh_table_list(!0),s.$clear_table_checkbox()}layer.close(this.loadT)}},clear_bacth:function(){this.bacth_status=!1,layer.close(this.loadT)}};e.callback?e.callback(n):!e.confirm||e.recursion?e.confirmVerify?bt.show_confirm("批量操作"+e.title+"已选中","批量"+e.title+"，该操作可能会存在风险，是否继续？",function(s){layer.close(s),e.recursion?n.start_batch():t(e,a)}):bt.confirm({title:"批量"+e.title,msg:"批量"+e.title+"，该操作可能会存在风险，是否继续？"},function(s){layer.close(s),e.recursion?n.start_batch():t(e,a)}):t(e,a)}for(var s=this,i={},n=0;n<e.length;n++){var c="",l=e[n];switch(l.type){case"group":$.each(l.list,function(e,t){var a=l.type+"_"+s.random+"_"+e;"division"==t.type?c+='<span class="mlr5"></span>':t.group?(c+='<div class="btn-group" style="vertical-align: top;">                                        <button type="button" class="btn btn-default '+a+' btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span style="margin-right:2px;">分类管理</span><span class="caret" style="position: relative;top: -1px;"></span></button>                                        <ul class="dropdown-menu"></ul>                                    </div>',l.list&&$.each(l.list,function(e,t){'<li><a href="javascript:;" NaN'+t[l.key]+"</a></li>"}),t.init&&setTimeout(function(){t.init(a)},400)):c+='<button type="button" title="'+(t.tips||t.title)+'" class="btn '+(t.active?"btn-success":"btn-default")+" "+a+' btn-sm mr5">'+(t.icon?'<span class="glyphicon glyphicon-'+t.icon+' mr5"></span>':"")+"<span>"+t.title+"</span></button>",i[a]||(i[a]={event:t.event,type:"button"})});break;case"search":this.config.search=l;var o="search_input_"+this.random,r="search_focus_"+this.random,d="search_btn_"+this.random;c='<div class="bt_search"><input type="text" class="search_input '+o+'" style="'+(l.width?"width:"+l.width:"")+'" placeholder="'+(l.placeholder||"")+'"/><span class="glyphicon glyphicon-search '+d+'" aria-hidden="true"></span></div>',i[o]||(i[o]={eventType:"keyup",type:"search_input"}),i[r]||(i[r]={type:"search_focus",eventType:"focus"}),i[d]||(i[d]={type:"search_btn"});break;case"batch":this.config.batch=l;var h=[],p="",u=l.config;void 0!==l.config?(s.batch_active=u,$(s.config.el).on("click",".set_batch_option",function(e){for(var i=[],n=0;n<s.checkbox_list.length;n++)i.push(s.data[s.checkbox_list[n]]);if($(this).hasClass("bt-disabled"))return layer.tips(s.config.batch.disabledTips||"请选择需要批量操作的数据",$(this),{tips:[1,"red"],time:2e3}),!1;switch(typeof u.confirm){case"function":u.confirm(u,function(e,t){u.param=$.extend(u.param,e),a(u,i,t)});break;case"undefined":a(u,i);break;case"object":var c=u.confirm;bt.open({title:c.title||"批量操作",area:c.area||"350px",btn:c.btn||["确认","取消"],content:c.content,success:function(e,t){c.success(e,t,u)},yes:function(e,a){c.yes(e,a,function(e,a){u.param=$.extend(u.param,e),t(u,i)})}})}})):($.each(l.selectList,function(e,t){t.group?($.each(t.group,function(e,a){h.push($.extend({},t,a)),p+='<li class="item">'+a.title+"</li>"}),delete t.group):(h.push(t),p+='<li class="item">'+t.title+"</li>")}),$(s.config.el).on("click",".bt_table_select_group .bt_select_value",function(e){var t=$(this).parent(),a=t.find(".bt_selects"),i=t.offset(),n=s.$get_win_area();return t.hasClass("bt-disabled")?(layer.tips(s.config.batch.disabledSelectValue,t,{tips:[1,"red"],time:2e3}),!1):(t.hasClass("active")?t.removeClass("active"):t.addClass("active"),a.height()>n[1]-i.top?a.addClass("top"):a.removeClass("top"),$(document).one("click",function(){return $(s.config.el).find(".bt_table_select_group").removeClass("active"),!1}),!1)}),$(s.config.el).on("click",".bt_table_select_group .item",function(e){var t=$(this).text(),a=$(this).index();$(this).addClass("active").siblings().removeClass("active"),$(s.config.el+" .bt_select_tips").html("批量"+t+"<em>(已选中"+s.checkbox_list.length+")</em>"),s.batch_active=h[a],s.checked||$(".bt_table_select_group").removeClass("active")}),$(s.config.el).on("click",".set_batch_option",function(e){var i=[],n=s.batch_active;if($(this).hasClass("bt-disabled"))return layer.tips(s.config.batch.disabledSelectValue,$(this),{tips:[1,"red"],time:2e3}),!1;for(var c=0;c<s.checkbox_list.length;c++)i.push(s.data[s.checkbox_list[c]]);if("{}"===JSON.stringify(n)){var l=$(s.config.el+" .bt_table_select_group");return layer.tips("请选择需要批量操作的类型",l,{tips:[1,"red"],time:2e3}),l.css("border","1px solid red"),setTimeout(function(){l.removeAttr("style")},2e3),!1}switch(typeof n.confirm){case"function":n.confirm(n,function(e,t){n.param=$.extend(n.param,e),a(n,i,t)});break;case"undefined":a(n,i);break;case"object":var o=n.confirm;bt.open({title:o.title||"批量操作",area:o.area||"350px",btn:o.btn||["确认","取消"],content:o.content,success:function(e,t){o.success(e,t,n)},yes:function(e,a){o.yes(e,a,function(e,a){n.param=$.extend(n.param,e),t(n,i)})}})}})),c='<div class="bt_batch"><label><i class="cust—checkbox cursor-pointer checkbox_'+this.random+'" data-checkbox="all"></i><input type="checkbox" lass="cust—checkbox-input" /></label>'+(void 0!==l.config?'<button class="btn btn-default btn-sm set_batch_option bt-disabled">批量'+l.config.title+"</button>":'<div class="bt_table_select_group bt-disabled not-select"><span class="bt_select_value"><span class="bt_select_tips">请选择批量操作<em></em></span><span class="glyphicon glyphicon-triangle-bottom ml5"></span></span><ul class="bt_selects ">'+p+'</ul></div><button class="btn btn-default btn-sm set_batch_option bt-disabled" >'+l.buttonValue+"</button>")+"</div>";break;case"page":this.config.page=l;var f=bt.get_cookie(this.config.cookiePrefix+"_"+this.config.page.numberParam);this.config.cookiePrefix&&f&&(this.config.page.number=f),c=this.$reader_page(this.config.page,'<div><span class="Pcurrent">1</span><span class="Pcount">共0条数据</span></div>')}if(c){var b=$(s.config.el+" .tootls_"+l.positon[1]);if(b.length){var v=b.find(".pull-"+l.positon[0]);v.append(c)}else{var _='<div class="tootls_group tootls_'+l.positon[1]+'"><div class="pull-left">'+("left"==l.positon[0]?c:"")+'</div><div class="pull-right">'+("right"==l.positon[0]?c:"")+"</div></div>";"top"===l.positon[1]?($(s.config.el).append(_),0===$(s.config.el+" .divtable").length&&$(s.config.el).append('<div class="divtable mtb10" style="max-height:'+parseInt(s.config.height)+'px"></div>')):(0===$(s.config.el+" .divtable").length&&$(s.config.el).append('<div class="divtable mtb10" style="max-height:'+parseInt(s.config.height)+'px"></div>'),$(s.config.el).append(_))}}}this.init||this.$event_bind(i)},$clear_table_checkbox:function(){$(this.config.el).find(".bt_table .cust—checkbox").removeClass("selected active")},$get_data_batch_list:function(e,t){var a=[];return $.each(t||this.data,function(t,s){a.push(s[e])}),a},$reader_page:function(e,t){"number"==typeof t&&(t=this.$custom_page(t));var a=this,s=$(t),i="",n={};if(s.find("a").addClass("page_link_"+this.random),i+=s.html(),e.numberStatus){var c="page_select_"+this.random,l=bt.get_cookie("page_number");i+='<select class="page_select_number '+c+'">',$.each(e.numberList,function(t,a){i+='<option value="'+a+'" '+((l||e.number)==a?"selected":"")+">"+a+"条/页</option>"}),i+="</select>",n[c]={eventType:"change",type:"page_select"}}if(e.jump){var o="page_jump_input_"+this.random,r="page_jump_btn_"+this.random;i+='<div class="page_jump_group"><span class="page_jump_title">跳转到</span><input type="number" class="page_jump_input '+o+'" value="'+e.page+'" /><span class="page_jump_title">页</span><button type="button" class="page_jump_btn '+r+'">确认</button></div>',n[o]={eventType:"keyup",type:"page_jump_input"},n[r]={type:"page_jump_btn"}}return n["page_link_"+this.random]={type:"cut_page_number"},a.config.page.total=0==s.length?0:"number"==typeof t?t:parseInt(s.find(".Pcount").html().match(/([0-9]*)/g)[1]),a.$event_bind(n),'<div class="page">'+i+"</div>"},$custom_page:function(e,t){void 0===t&&(t=5);var a='<div clas="page">',s=this.config.page,i=Math.ceil(e/s.number);s.page>1&&i>1&&(a+='<a class="Pstart" href="p=1">首页</a><a class="Pstart" href="p='+(s.page-1)+'">上一页</a>');for(var n=1;n<=i;n++)n==s.page?a+='<span class="Pcurrent">'+n+"</span>":a+='<a class="Pnum" href="p='+n+'">'+n+"</a>";return i>1&&s.page<i&&(a+='<a class="Pstart" href="p='+(s.page+1)+'">下一页</a><a class="Pstart" href="p='+i+'">尾页</a>'),a+='<span class="Pcount">共'+e+"条</span></div>",a},$dynamic_merge_style:function(e,t){var a="";return $.each(e,function(e,t){switch(e){case"align":a+="text-align:"+t+";";break;case"width":a+="width:"+("string"==typeof t?t:t+"px")+";";break;case"style":a+=t;break;case"minWidth":a+="min-width:"+("string"==typeof t?t:t+"px")+";";break;case"maxWidth":a+="max-width:"+("string"==typeof t?t:t+"px")+";"}}),{index:t,css:a}},$event_bind:function(e){var t=this;$.each(e,function(e,a){if(t.event_list[e]&&t.event_list[e].eventType===a.eventType)return!0;t.event_list[e]=a,$(t.config.el).on(a.eventType||"click","."+e,function(s){var i=$(this).parents("tr").index(),n=$(this).data(),c=[];switch(a.type){case"rows":t.event_rows_model={el:$(this),model:t.config.column[$(this).parents("td").index()],rows:t.data[i],index:i},c=[t.event_rows_model.rows,t.event_rows_model.index,s,e,t];break;case"sort":var l=t.config.column[n.index];$(this).hasClass("sort-active")&&$(".sort_"+t.random+" .sort-active").data({sort:"desc"}),$(".sort_"+t.random).removeClass("sort-active").find(".glyphicon").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom"),$(this).addClass("sort-active"),"asc"==n.sort?($(this).data({sort:"desc"}),$(this).find(".glyphicon").removeClass("glyphicon-triangle-top").addClass("glyphicon-triangle-bottom")):($(this).data({sort:"asc"}),$(this).find(".glyphicon").removeClass("glyphicon-triangle-bottom").addClass("glyphicon-triangle-top")),t.config.sort=t.config.sortParam({name:l.fid,sort:n.sort}),t.$refresh_table_list(!0);break;case"checkbox":var o=$(t.config.el+' [data-checkbox="all"]'),r=$(t.config.el+" tbody .checkbox_"+t.random);null==n.checkbox?$(this).hasClass("active")?($(this).removeClass("active"),t.checkbox_list.splice(t.checkbox_list.indexOf(i),1),t.checkbox_list.length>0?o.addClass("selected").removeClass("active"):o.removeClass("selected active")):($(this).addClass("active"),t.checkbox_list.push(i),t.data.length===t.checkbox_list.length?o.addClass("active").removeClass("selected"):t.checkbox_list.length>0&&o.addClass("selected")):t.checkbox_list.length===t.data.length?(t.checkbox_list=[],r.removeClass("active selected").next().prop("checked","checked"),o.removeClass("active")):(r.each(function(e,a){$(this).hasClass("active")||($(this).addClass("active").next().prop("checked","checked"),t.checkbox_list.push(e))}),o.removeClass("selected").addClass("active")),t.$set_batch_view();break;case"button":c.push(s,t);break;case"search_focus":var d=$(t.config.el+" .bt_search_tips");$(t.config.el+" .bt_search_tips").length>0&&d.remove();break;case"search_input":if(13==s.keyCode)return $(t.config.el+" .search_btn_"+t.random).click(),!1;break;case"search_btn":var h=$(t.config.el+" .search_input"),p=$(t.config.el+" .search_input").val();p=p.replace(/\s+/g,""),h.val(p),t.config.search.value=p,h.append('<div class="bt_search_tips"><span>'+p+'</span><i class="bt_search_close"></i></div>'),t.$refresh_table_list(!0);break;case"page_select":var u=parseInt($(this).val());return bt.set_cookie("page_number",u),t.config.page.number=u,t.config.page.page=1,t.$refresh_table_list(!0),!1;case"page_jump_input":return 13==s.keyCode&&($(t.config.el+" .page_jump_btn_"+t.random).click(),$(this).focus()),!1;case"page_jump_btn":var f=parseInt($(t.config.el+" .page_jump_input_"+t.random).val()),b=Math.ceil(t.config.page.total/t.config.page.number);f>b&&(f=t.config.page.page),t.config.page.page=f,t.$refresh_table_list(!0);break;case"cut_page_number":var v=parseInt($(this).attr("href").match(/([0-9]*)$/)[0]);return t.config.page.page=v,t.$refresh_table_list(!0),!1;case"eye_open_password":return $(this).hasClass("glyphicon-eye-open")?($(this).addClass("glyphicon-eye-close").removeClass("glyphicon-eye-open"),$(this).prev().text(t.data[i].password)):($(this).addClass("glyphicon-eye-open").removeClass("glyphicon-eye-close"),$(this).prev().html("<i>**********</i>")),!1;case"copy_password":return bt.pub.copy_pass(t.data[i].password),!1}a.event&&a.event.apply(this,c)})})},$style_bind:function(e,t){var a="",s=this;$.each(e,function(e,t){""!=t.css&&(t.className?a+=t.className+"{"+t.css+"}":a+=s.config.el+" thead th:nth-child("+(t.index+1)+"),"+s.config.el+" tbody tr td:nth-child"+(t.span?" span":"")+"("+(t.index+1)+"){"+t.css+"}")}),0==$("#bt_table_"+s.random).length&&$(s.config.el).append('<style type="text/css" id="bt_table_'+s.random+'">'+a+"</style>")},$get_win_area:function(){return[window.innerWidth,window.innerHeight]},$http:function(e,t){var a={},s=this.config,i=s.page,n=s.search,c=s.sort||{};i&&(a[i.numberParam]=i.number,a[i.pageParam]=i.page,this.config.cookiePrefix&&bt.set_cookie(this.config.cookiePrefix+"_"+i.numberParam,i.number)),n&&(a[n.searchParam]=n.value),this.config.beforeRequest&&(s.param=this.config.beforeRequest(s.param)),bt_tools.send({url:s.url,data:$.extend(s.param,a,c)},function(t){if(void 0!==s.dataFilter){var a=s.dataFilter(t);void 0!==a.tootls&&(a.tootls=parseInt(a.tootls)),e&&e(a)}else e&&e({data:t.data,page:t.page})},"boolean"==typeof t?"获取列表":t)}},new t(e)},form:function(e){function t(e){this.config=e,this.data=e.data||{},this.$load()}var a=this;return t.prototype={element:null,style_list:[],event_list:{},event_type:["click","event","focus","keyup","blur","change"],hide_list:[],form_element:{},form_config:{},random:bt.get_random(5),$load:function(){var e=this;e.el&&this.$reader_content(function(){e.$event_bind()})},$reader_content:function(e){var t=this,s="",i="";return $.each(t.config.form,function(e,a){s+=t.$reader_content_row(e,a)}),t.element=$('<form class="bt-form" data-form="'+t.random+'" onsubmit="return false">'+s+"</form>"),i=$('<div class="'+a.$verify(t.config.class)+'"></div>'),i.append(t.element),e&&e(),i[0].outerHTML},$reader_content_row:function(e,t){var s=this,i=t.help,n=this.config.formLabelWidth||t.formLabelWidth;return'<div class="line'+a.$verify(t.class)+a.$verify(t.hide,"hide",!0)+'"'+a.$verify(t.id,"id")+">"+(t.label?'<span class="tname" '+(n?'style="width:'+n+'"':"")+">"+t.label+"</span>":"")+'<div class="'+(t.label?"info-r":"")+a.$verify(t.line_class)+'"'+a.$verify(s.$reader_style($.extend(t.style,n?{"margin-left":n}:{})),"style")+">"+s.$reader_form_element(t.group,e)+(i?'<div class="c9 mt5 '+a.$verify(i.class,"class")+'" '+a.$verify(s.$reader_style(i.style),"style")+">"+i.list.join("</br>")+"</div>":"")+"</div></div>"},$reader_form_element:function(e,t){var a=this,s="";return Array.isArray(e)||(e=[e]),$.each(e,function(e,i){i.find_index=t,s+=a.$reader_form_find(i),a.form_config[i.name]=i}),s},$reader_form_find:function(e){var t=this,s="",i=t.$reader_style(e.style)+a.$verify(e.width,"width","style"),n=t.$verify_group(e,["name","value","placeholder","disabled","readonly","autofocus","autocomplete","min","max"]),c=t.$create_event_config(e),l="",o=e.find_index;switch(s+=e.label?'<span class="mr5">'+e.label+"</span>":"",void 0!==e.name&&(t.event_list[e.name]=c),s+='<div class="'+(e.dispaly||"inlineBlock")+'">',e.type){case"text":case"checkbox":case"password":case"radio":case"number":var r="event_"+e.name+"_"+t.random;switch(e.type){case"checkbox":s+='<label class="cursor-pointer form-checkbox-label"><i class="form-checkbox cursor-pointer mr5 '+r+'_label"></i><input type="checkbox" class="form—checkbox-input mr10 '+r+'" name="'+e.name+'" /><span class="vertical_middle">'+e.title+"</span></label>",t.event_list[r+"_label"]={click:{type:"checkbox_icon",config:e}},t.event_list[r]={input:{type:"checkbox",config:e}};break;default:s+='<input type="'+e.type+'"'+n+" "+(e.icon?'id="'+r+'"':"")+' class="bt-input-text mr10 '+(e.label?"vertical_middle":"")+a.$verify(e.class,"class")+'"'+a.$verify(i,"style")+' value="'+(t.data[e.name]||e.value||"")+'"/>'}e.icon&&(s+='<span class="glyphicon '+e.icon.type+" "+e.name+'_icon cursor" '+a.$verify(t.$reader_style(e.icon.style),"style")+"></span>",void 0!==e.icon.event&&(t.event_list[e.name+"_icon"]={click:{type:"select_path",config:e,event:e.icon.event}}));break;case"textarea":if(s+='<textarea class="bt-input-text"'+a.$verify(i,"style")+n+" >"+(t.data[e.name]||"")+"</textarea>",$.each(["blur","focus","input"],function(a,s){if(e.tips){var i=null;switch(s){case"blur":i=function(e,t,a){""===$(this).val()&&$(this).next().show(),layer.close(t.tips.loadT),$(e.target).data("layer","")};break;case"focus":i=function(e,t){$(this).next().hide(),t.tips.loadT=layer.tips(d,$(this),{tips:[1,"#20a53a"],time:0,area:$(this).width()})}}}t.event_list[e.name][s]?t.event_list[e.name][s].added=i:t.event_list[e.name][s]={type:e.type,cust:!1,event:e[s],added:i}}),e.tips){var d="";d=void 0===e.tips.list?e.tips.text:e.tips.list.join("</br>"),s+='<div class="placeholder c9 '+e.name+'_tips" '+a.$verify(t.$reader_style(e.tips.style),"style")+">"+d+"</div>",t.event_list[e.name+"_tips"]={click:{type:"textarea_tips",config:e}}}break;case"select":s+=t.$reader_select(e,i,n,o),t.event_list.custom_select={click:{type:"custom_select",children:".bt_select_value"}},t.event_list.custom_select_item={click:{type:"custom_select_item",children:"li.item"}};break;case"link":l="event_"+bt.get_random(6),s+='<a href="'+(e.href||"javascript:;")+'" class="btlink offsetY7'+a.$verify(e.class,"class")+" "+l+'" '+a.$verify(t.$reader_style(e.style),"style")+">"+e.title+"</a>",t.event_list[l]={click:{type:"link_event",event:e.event}};break;case"help":var h="";$.each(e.list,function(e,t){h+="<li>"+t+"</li>"}),s+='<ul class="help-info-text c7'+a.$verify(e.class)+'"'+a.$verify(t.$reader_style(e.style),"style")+">"+h+"</ul>"}return s+="</div>",s},$create_event_config:function(e){var t={};return void 0===e.name?{}:($.each(this.event_type,function(a,s){e[s]&&(t["event"===s?"click":s]={type:e.type,event:e[s],cust:["select","checkbox","radio"].indexOf(e.type)>-1,config:e})}),t)},$reader_style:function(e){var t="";return"string"==typeof e?e:void 0===e?"":($.each(e,function(e,a){t+=e+":"+a+";"}),t)},$local_refresh:function(e,t){this.element.find("[data-name="+e+"]").replaceWith(this.$reader_form_find(t))},$reader_select:function(e,t,s,i){var n=this,c="",l="",o={};if(!Array.isArray(e.list)){var r=e.list;bt_tools.send({url:r.url,data:r.param||{}},function(t){!1!==t.status?(e.list=e.list.dataFilter?e.list.dataFilter(t):t,n.$replace_render_content(i)):bt.msg(t)})}return $.each(e.list,function(t,s){try{o=s.value===e.value?s:e.list[0]}catch(e){}c+='<li class="item'+a.$verify(s.value===o.value?"active":"")+" "+(s.disabled?"disabled":"")+'">'+s.title+"</li>",l+='<option value="'+s.value+'"'+(s.disabled?"disabled":"")+" "+a.$verify(s.value===o.value?"selectd":"")+">"+s.title+"</option>"}),!o.title&&Array.isArray(e.list)&&(o=e.list[0]),'<div class="bt_select_updown mr10 '+(e.disabled?"bt-disabled":"")+" "+a.$verify(e.hide,"hide",!0)+a.$verify(e.class)+'" '+a.$verify(t,"style")+' data-name="'+e.name+'"><span class="bt_select_value"><span class="bt_select_content">'+(o.title||"获取数据中...")+'</span><span class="glyphicon glyphicon-triangle-bottom ml5"></span></span><ul class="bt_select_list">'+(c||"")+"</ul><select"+s+' class="hide" '+(e.disabled?"disabled":"")+">"+(l||"")+"</select></div>"},$replace_render_content:function(e){var t=this,a=this.config.form[e];$("[data-form="+t.random+"]").find(".line:eq("+e+")").replaceWith(t.$reader_content_row(e,a))},$event_bind:function(e,t){var a=this,s={};a.element=$("object"==typeof e?a.element:"[data-form="+a.random+"]"),void 0===e&&(s=a.event_list),$.each(s,function(e,t){if($.isEmptyObject(t))return!0;$.each(t,function(t,s){var i="";i="boolean"==typeof s.cust?"["+(s.cust?"data-":"")+"name="+e+"]":"."+e,function(e,s){if(!1===e.onEvent){switch(e.type){case"input_checked":$(i).on("event"!=t?t:"click",function(t){e.event.apply(this,[t,a])})}return!0}a.element.on("event"!=t?t:"click",e.children?e.children:i,function(t){var i=a.$get_form_element(!0),n=a.$get_form_value(),c=a.form_config[s];switch(e.type){case"textarea_tips":$(this).hide().prev().focus();break;case"custom_select":if($(this).parent().hasClass("bt-disabled"))return!1;var l=$(this).next();return l.hasClass("show")?l.removeClass("show"):($(".bt_select_list").removeClass("show"),l.addClass("show")),$(document).click(function(){return a.element.find(".bt_select_list").removeClass("show"),$(this).unbind("click"),!1}),!1;case"custom_select_item":if(c=a.form_config[$(this).parents(".bt_select_updown").attr("data-name")],
item_config=c.list[$(this).index()],$(this).hasClass("disabled"))return $(this).parent().removeClass("show"),item_config.tips&&layer.msg(item_config.tips,{icon:2}),!0;$(this).hasClass("active")||$(this).hasClass("disabled")||($(this).parent().prev().find(".bt_select_content").text($(this).text()),$(this).addClass("active").siblings().removeClass("active"),$(this).parent().next().val(item_config.value.toString()),$(this).parent().removeClass("show"),$(this).parent().next().trigger("change"));break;case"select_path":bt.select_path("event_"+$(this).prev().attr("name")+"_"+a.random);break;case"checkbox":var o=$(this).is(":checked");o?$(this).prev().addClass("active"):$(this).prev().removeClass("active")}e.event&&e.event.apply(this,[n,i,a,c,t]),e.added&&e.added.apply(this,[t,c,i])})}(s,e)})}),t&&t()},$get_form_value:function(){return this.element.serializeObject()},$set_find_value:function(e,t){var a={},s=this;"string"!=typeof e?a=e:a[e]=t,$.each(a,function(e,t){s.form_element[e].val(t)})},$get_form_element:function(e){var t={},a=this;return e||$.isEmptyObject(a.form_element)?(this.element.find(":input").each(function(e){t[$(this).attr("name")]=$(this)}),a.form_element=t,t):a.form_element},$verify_group:function(e,t){var a="";return $.each(t,function(t,s){if(void 0===e[s])return!0;["disabled","readonly"].indexOf(s)>-1?a+=" "+(e[s]?s+'="'+s+'"':""):a+=" "+s+'="'+e[s]+'"'}),a},$verify_bind_event:function(e,t,a){var s={};return $.each(a,function(a,i){var n=t[i];n&&("object"==typeof s[e]?(Array.isArray(s[e])||(s[e]=[s[e]]),s[e].push({event:n,eventType:i})):s[e]={event:n,eventType:i})}),s},$verify:function(e,t,a){return e?!0===a?e?" "+t:"":"style"===a?t?t+":"+e+";":e:t?" "+t+'="'+e+'"':" "+e:""},$verify_form:function(){for(var e={},t=this.config.form,a=this.$get_form_value(),s=this.$get_form_element(!0),i=0;i<t.length;i++){var n=t[i];Array.isArray(n.group)||(n.group=[n.group]);for(var c=0;c<n.group.length;c++){var l=n.group[c],o=l.name;if("help"!==l.type)if(void 0!==l.verify){var r=l.verify(a[o],s[o],l,!0);if(!1===r&&!1!==a[o])return!1;e[o]=r}else e[o]=a[o]}}return e},$submit:function(e,t,a){var s=this.$verify_form();return"function"==typeof e&&(a=t,t=e,e={}),!!s&&(s=$.extend(s,e),void 0===this.config.url?(bt_tools.msg("请求提交地址不能为空！",!1),!1):void bt_tools.send({url:this.config.url,data:s},function(e){t?t(e,s):bt_tools.msg(e)},a||"提交中"))}},new t(e)},tab:function(e){function t(e){this.config=e,this.theme=this.config.theme||{},this.$load()}var a=this;return t.prototype={type:1,theme_list:[{content:"tab-body",nav:"tab-nav",body:"tab-con",active:"on"},{content:"bt-w-body",nav:"bt-w-menu",body:"bt-w-con"}],random:bt.get_random(5),$init:function(){var e=this,t=(this.config.active,e.config.list);this.$event_bind(),t[e.active].success&&t[e.active].success(),t[e.active].init=!0},$load:function(){},$reader_content:function(){var e=this,t=e.config.list,s="",i="",n=e.theme,c=e.config;return void 0===e.active&&(e.active=0),$.isEmptyObject(c.theme)||(n=this.theme_list[e.active],$.each(c.theme,function(e,t){n[e]&&(n[e]+=" "+t)}),e.theme=n),c.type&&$.isEmptyObject(c.theme)&&(this.theme=this.theme_list[e.active]),$.each(t,function(t,a){var c=e.active===t,l=n.active||"active";s+='<span class="'+(c?l:"")+'">'+a.title+"</span>",i+='<div class="tab-block '+(c?l:"")+'">'+(c?a.content:"")+"</div>"}),e.element=$('<div id="tab_'+e.random+'" class="'+n.content+a.$verify(e.config.class)+'"><div class="'+n.nav+'" >'+s+'</div><div class="'+n.body+'">'+i+"</div></div>"),e.element[0].outerHTML},$event_bind:function(){var e=this,t=e.theme,a=t.active||"active";e.el||(e.element=$("#tab_"+e.random)),e.element.on("click","."+t.nav.replace(/\s+/g,".")+" span",function(){var s=$(this).index(),i=e.config.list[s];$(this).addClass(a).siblings().removeClass(a),$("."+t.body+">div:eq("+s+")").addClass(a).siblings().removeClass(a),e.active=s,i.init||($("."+t.body+">div:eq("+s+")").html(i.content),i.success&&i.success(),i.init=!0)})}},new t(e)},load:function(e){var t=bt.get_random(5),a=$('<div class="layui-layer layui-layer-dialog layui-layer-msg layer-anim" id="'+t+'" type="dialog" style="z-index: 99891031;display:none"><div class="layui-layer-content layui-layer-padding"><i class="layui-layer-ico layui-layer-ico16"></i>正在'+e+'，请稍候...</div><span class="layui-layer-setwin"></span></div><div class="layui-layer-shade" id="layer-mask-'+t+'" times="17" style="z-index:99891000; background-color:#000; opacity:0.3; filter:alpha(opacity=30);"></div>'),s="";$("body").append(a);var i=$(window);$(".layer-loading-mask"),a=$("#"+t);return setTimeout(function(){a.css({top:(i.height()-a.height())/2,left:(i.width()-a.width())/2,display:"block"})},100),!0===e&&(s=layer.load()),{close:function(){"number"==typeof s?layer.close(s):$("body").find("#"+t+",#layer-mask-"+t).remove()}}},open:function(e){var t={},a=null,s=null;if(t=$.extend({type:1,area:"640px",closeBtn:2,btn:["确认","取消"]},e),"object"==typeof t.content){var i=t.content;s=bt_tools.form(i),t.success=function(e,a){s.$event_bind(),void 0!==t.success&&void 0!==i.success&&i.success(e,a)},t.yes=function(t,a){var i=s.$verify_form();if(!i)return!1;if(void 0!==e.yes){var n=e.yes.apply(s,[i,t,a]);if(!n)return!1}},t.content=s.$reader_content()}return a=layer.open(t),{close:function(){layer.close(a)},form:s}},msg:function(e,t){var a=null,s="",i={};return"object"==typeof e&&"boolean"==typeof e.status&&(s=e.msg,i={icon:e.status?1:2},e.status||(i=$.extend(i,{time:t?3e3:0,closeBtn:2,shade:.3}))),"string"==typeof e&&(s=e,i={icon:void 0!==t?t:1}),a=layer.msg(s,i),{close:function(){layer.close(a)}}},send:function(e,t,a,s,i,n){function c(e){try{o="function"==d[e][1]?d[e][0]:null,r="function"==d[e+1][1]?d[e+1][0]:null}catch(e){}}var l={},o=null,r=null,d=[],h="";switch($.each(arguments,function(e,t){d.push([t,typeof t])}),h=d[0],h[1]){case"string":$.each(d,function(e,t){var a=t[0],s=t[1];if(e>1&&("boolean"==s||"string"==s||"object"==s)){var i=h[0].split("/");return l.url="/"+i[0]+"?action="+i[1],"object"==s?(l.load=a.load,l.verify=a.verify,a.plugin&&(l.url="/plugin?action=a&name="+i[0]+"&s="+i[1])):"string"==s&&(l.load=a),!1}l.url=h[0]}),"object"===d[1][1]?(l.data=d[1][0],c(2)):c(1);break;case"object":l.url=h[0].url,l.data=h[0].data||{},$.each(d,function(e,t){var a=t[0],s=t[1];if(e>1&&("boolean"==s||"string"==s||"object"==s))return"object"==s?(l.load=a.load,l.verify=a.verify):"string"==s&&(l.load=a),!0}),"object"===d[1][1]?(l.data=d[1][0],c(2)):c(1)}l.load&&(l.load=this.load(l.load)),$.ajax({type:l.type||"POST",url:l.url,data:l.data||{},dataType:l.dataType||"JSON",complete:function(){l.load&&l.load.close()},success:function(e){return"boolean"!=typeof l.verify||l.verify?"string"==typeof e?(layer.msg(e,{icon:2,time:0,closeBtn:2}),!1):l.batch?(o&&o(e),!1):!1===e.status?(layer.close(),bt_tools.msg(e),!1):(l.tips&&bt_tools.msg(e),void(o&&o(e))):(o&&o(e),!1)},error:function(e){r&&r(e),layer.closeAll("dialog"),layer.closeAll("loading"),layer.msg("服务响应状态码："+(0==e.status?"--":e.status)+"</br>错误信息："+e.statusText+"</br>接口信息："+l.url+"</br>接口参数："+JSON.stringify(l.data),{icon:2,time:0,closeBtn:2})}})},$clear_verify_tips:function(e){e.removeClass("bt-border-error bt-border-sucess"),layer.close("tips")},$verify_tips:function(e,t,a){void 0===a&&(a=!0),e.removeClass("bt-border-error bt-border-sucess").addClass(a?"bt-border-error":"bt-border-sucess"),e.focus(),layer.tips('<span class="inlineBlock">'+t+"</span>",e,{tips:[1,a?"red":"#20a53a"],time:3e3,area:e.width()})},$verify:function(e,t,a){return e?!0===a?e?" "+t:"":"style"===a?t?t+":"+e+";":e:t?" "+t+'="'+e+'"':" "+e:""},$batch_success_table:function(e){var t=this,a=$(e.html).length;bt.open({type:1,title:e.title,area:e.area||["350px","350px"],shadeClose:!1,closeBtn:2,content:e.content||'<div class="batch_title"><span class><span class="batch_icon"></span><span class="batch_text">'+e.title+'操作完成！</span></span></div><div class="'+(a>4?"fiexd_thead":"")+' batch_tabel divtable" style="margin: 15px 30px 15px 30px;overflow: auto;height: 200px;"><table class="table table-hover"><thead><tr><th>'+e.th+'</th><th style="text-align:right;width:120px;">操作结果</th></tr></thead><tbody>'+e.html+"</tbody></table></div>",success:function(){a>4&&t.$fixed_table_thead(".fiexd_thead")}})},$fixed_table_thead:function(e){$(e).scroll(function(){var e=this.scrollTop;this.querySelector("thead").style.transform="translateY("+e+"px)"})},$piugin_view_set:function(e,t){var a=$("string"==typeof e?"#layui-layer"+e:e).hide(),s=$(window);setTimeout(function(){var e=t.width||a.width(),i=t.height||a.height();a.css($.extend(t,{left:(s.width()-e)/2,top:(s.height()-i)/2})).addClass("custom_layer")},50),setTimeout(function(){a.show()},500)}};$.fn.serializeObject=function(){var e=Object.prototype.hasOwnProperty;return this.serializeArray().reduce(function(t,a){return e.call(t,a.name)||(t[a.name]=a.value),t},{})};
</script>
<script type="text/javascript">
	var element = $('#tencent_cosfs').parents('.layui-layer-page'),_id = parseInt(element.attr('times')),init = null,title = element.find('.layui-layer-title').text(),cosfs = null;
	add_config = {
		title:'腾讯云COSFS存储桶-关联腾讯云API密钥',
		area:'500px',
		skin:'custom_layer',
		btn:['保存','取消'],
		content:{
			url:'/plugin?action=a&name=cosfs&s=set_config',
			class:'pd20',
			form:[{
				label:'APPID',
				group:{
					type:'text',
					name:'appid',
					width:'320px',
					placeholder:'腾讯云密钥APPID,不可为空',
					verify:function(value,element,model,is_monitor){
						var tips = '';
						if(value == ''){
							tips = model.placeholder;
						}
						if(tips != ''){
							bt_tools.$verify_tips(element,tips);
							return false;
						}
						return value.replace(/ /g,'');
					}
				}
			},{
				label:'secretId',
				group:{
					type:'text',
					name:'secretId',
					width:'320px',
					placeholder:'腾讯云密钥secretId,不可为空',
					verify:function(value,element,model,is_monitor){
						var tips = '';
						if(value == ''){
							tips = model.placeholder;
						}
						if(tips != ''){
							bt_tools.$verify_tips(element,tips);
							return false;
						}
						return value.replace(/ /g,'');
					}
				}
			},{
				label:'secretKey',
				group:{
					type:'password',
					name:'secretKey',
					width:'320px',
					placeholder:'腾讯云密钥secretKey,不可为空',
					verify:function(value,element,model,is_monitor){
						var tips = '';
						if(value == ''){
							tips = model.placeholder;
						}
						if(tips != ''){
							bt_tools.$verify_tips(element,tips);
							return false;
						}
						return value.replace(/ /g,'');
					}
				}
			},{
				label:' ',
				group:{
					type:'help',
					style:'margin-top:0',
					list:['获取腾讯云API密钥信息，<a href="https://console.cloud.tencent.com/cam/capi" target="_blank" class="btlink">点击查看</a>']
				}
			}]
		},
		yes:function(form,indexs,layero){
			var that = this;
			this.$submit(form,function(res){
				if(res.status === false){
					bt_tools.msg(res);
					return false;
				}
				layer.close(indexs);
				if(init){
					element.show();
					cosfs.$refresh_table_list(true,function(){
                        bt_tools.msg(res);
                    });
				}else{
					bt.soft.set_lib_config('cosfs',title);
				}
			});
		},
		end:function(){
			if(!init) layer.close(_id);
		}
	}
    bt_tools.$piugin_view_set(element,{width:900,height:620});
    var cosfs_bucket = {
        files_path:'',                       //文件路径
        path_type:'dir',                     //文件类型
        input_regions: '',                   //本地文件选中后输入的地方
        is_checked_val:'',                   //本地文件选中
        file_list:[],                        //当前存储桶文件列表
        row_config: {},                      //当前存储桶配置信息
        bucket_file_path:'',
        isCos_file:true,                     //是否未远程文件
        files_view: null,                    //本地文件视图
        online_files_views:null,             //线上文件视图
        operation_type: '',                  //操作类型（拷贝，移动
        old_operation_path:'',               //旧路径（含文件名
        /** 
         * @descripttion 存储桶视图
         * @return: viod
         */
        open_bucket_files_view:function(){
            var that = this
            this.online_files_views = bt_tools.open({
                title:'【'+this.row_config.Name+'】文件管理',
                area:['700px','620px'],
                skin:'bucket_files_layer',
                btn:false,
                content:'<div class="bucket_files_view"></div>',
                success:function(){},
                cancel:function(index,layero){
                    layer.close(index);
                    that.online_files_views = null;
                }
            })
        },
        /** 
         * @descripttion 渲染存储桶列表
         * @return: viod
         */
        render_bucket_list:function(path){
            var that = this,listRir = '',listFile = '',is_operation = getCookie(this.operation_type);
            bt_tools.send({
                url:'/plugin?action=a&name=cosfs&s=get_list',
                data:{
                    region:this.row_config.Location,
                    bucket_name:this.row_config.Name,
                    path:path
                }
            },function(res){
                that.bucket_file_path = path;
                if(!that.online_files_views) that.open_bucket_files_view();
                if(res.list.length >=1){
                    var slist = []
                    $.each(res.list,function(index,item){
                        var last_str = item.name[item.name.length-1];
                        if(last_str == '/'){
                            listRir += '<tr><td class="cursor" onclick="cosfs_bucket.render_bucket_list(\''+(path+'/'+item.name).replace('//','/')+'\')"><span class="ico ico-folder"></span><span>'+item.name+'</span></td><td>-</td><td>-</td><td class="text-right"><a class="btlink hide" onclick="cosfs_bucket.file_copy_or_move(\''+path+'\',\''+item.name+'\',0)">拷贝</a><a class="btlink hide" onclick="cosfs_bucket.file_copy_or_move(\''+path+'\',\''+item.name+'\',1)">移动</a><a class="btlink" onclick="cosfs_bucket.delete_bucket_file(\''+item.name+'\')">删除</a></td></tr>'
                        }else{
                            listFile +='<tr><td class="cursor"><span class="ico ico-file"></span><span>'+item.name+'</span></td><td>'+ToSize(item.size)+'</td><td>'+getLocalTime(item.time)+'</td><td class="text-right"><a class="btlink" onclick="cosfs_bucket.file_copy_or_move(\''+path+'\',\''+item.name+'\',0)">拷贝</a>&nbsp;|&nbsp;<a class="btlink" onclick="cosfs_bucket.file_copy_or_move(\''+path+'\',\''+item.name+'\',1)">移动</a>&nbsp;|&nbsp;<a class="btlink" onclick="cosfs_bucket.delete_bucket_file(\''+item.name+'\')">删除</a></td></tr>'
                        }
                    })
                    listRir += listFile;
                }else{
                    listRir='<tr><td colspan="4" style="text-align: center;">目录为空</td></tr>'
                }
                var pathLi='',tmp = path.split('/'),pathname = '',n = 0;
                for(var i=0;i<tmp.length;i++){
                    if(n > 0 && tmp[i] == '') continue;
                    var dirname = tmp[i];
                    if(dirname == '' && tmp[0] == ''){
                        dirname = '根目录';
                        n++;
                    }
                    pathname += '/' + tmp[i];
                    pathname = pathname.replace('//','/');
                    pathLi += '<li><a title="'+pathname+'" onclick="cosfs_bucket.render_bucket_list(\''+pathname+'\')">'+dirname+'</a></li>';
                }
                var um = 1;
                if(tmp[tmp.length-1] == '') um = 2;
                var backPath = tmp.slice(0,tmp.length-um).join('/') || '/';
                if(getCookie(that.operation_type) != null && getCookie(that.operation_type) != undefined){
                    is_operation = true;
                }
                if(getCookie(that.operation_type) == 'null'){
                    is_operation = false;
                }
                var con='<div class="up-place pd15">\
                        <button id="backBtn" class="btn btn-default btn-sm glyphicon glyphicon-arrow-left pull-left" title="后退" onClick="cosfs_bucket.render_bucket_list(\''+backPath+'\')"></button>\
                        <input id="myPath" style="display:none;" type="text" value="'+path+'">\
                        <input type="text" style="display:none;" id="Upupload">\
                        <div class="place-input pull-left"><div style="width:1400px;height:28px"><ul>'+pathLi+'</ul></div></div>\
                        <button class="refreshBtn btn btn-default btn-sm glyphicon glyphicon-refresh pull-left mr10" title="刷新" onclick="cosfs_bucket.render_bucket_list(\''+path+'\')" style="margin-left:-1px;"></button>\
                        <button class="btn btn-default btn-sm pull-right btn-title" onclick="cosfs_bucket.uploadup()">上传</button>\
                        <button class="btn btn-default btn-sm pull-right mr10 btn-title" onclick="cosfs_bucket.createdir()">新建文件夹</button>\
                        <button class="btn btn-default btn-sm pull-right mr10 btn-title" id="file_paste" '+(is_operation?'':'style="display:none"')+' onclick="cosfs_bucket.set_file_paste()">粘贴</button>\
                    </div><div class="upyunlist pd15">\
                    <div class="divtable" style="margin-bottom:15px">\
                        <table class="table table-hover">\
                            <thead><tr><th>名称</th><th>大小</th><th>更新时间</th><th class="text-right">操作</th></tr></thead>\
                            <tbody class="list-list">'+listRir+'</tbody>\
                        </table>\
                    </div><div class=""></div>\
                </div>';
                $(".bucket_files_view").html(con);
                that.upPathLeft();
            },'获取文件列表')
        },
        //计算当前目录偏移
        upPathLeft:function(){
            var UlWidth = $(".place-input ul").width();
            var SpanPathWidth = $(".place-input").width() - 20;
            var Ml = UlWidth - SpanPathWidth;
            if(UlWidth > SpanPathWidth ){
                $(".place-input ul").css("left",-Ml)
            }else{
                $(".place-input ul").css("left",0)
            }
        },
        //删除存储桶文件
        delete_bucket_file:function(name){
            var that = this;
            SafeMessage('删除文件','删除后将无法恢复，真的要删除['+name+']吗?',function(){
                var path = $("#myPath").val();
                var filename = name;
                var function_name = "delete_file"
                bt_tools.send({
                    url:'/plugin?action=a&name=cosfs&s=delete_object',
                    data:{
                        region:that.row_config.Location,
                        bucket_name:that.row_config.Name,
                        filenames:(path+'/'+name).replace(/\/\//g, "/")
                    }
                },function(rdata){
                    if(rdata.status) that.render_bucket_list(path);
                    layer.msg(rdata.msg,{icon:rdata.status?1:2});
                },'删除文件['+name+']');
            });
        },
        //挂载跳转 
        mount_jump:function(path){
            openPath(path)
        },
        // 存储桶文件上传按钮
        uploadup: function(){
            var _this = this;
            $('#Upupload').val('');
            this.path_content('file','#Upupload');
        },
        // 上传文件到
        upload_files:function(){
            var that = this,path = $("#myPath").val(),load_path = $('#Upupload').val(),load_array = load_path.split('/'),last_name = load_array[load_array.length-1];
            bt_tools.send({
                url:'/plugin?action=a&name=cosfs&s=upload_file',
                data:{
                    region:that.row_config.Location,
                    bucket_name:that.row_config.Name,
                    filename:(path+'/'+last_name).replace(/\/\//g, "/"),
                    local_path:$('#Upupload').val()
                }
            },function(rdata){
                that.render_bucket_list(that.bucket_file_path);
                layer.msg(rdata.msg,{icon:rdata.status?1:2});
            },'上传文件');
        },
        // 文件复制/拷贝【 0 拷贝/1 移动】
        file_copy_or_move:function(oldPath,filename,type){
            this.operation_type = type?'is_move':'is_copy';
            this.old_operation_path = oldPath+'/'+filename
            setCookie(type?'is_move':'is_copy',filename)
            bt_tools.msg((type?'标记':'拷贝')+'成功,请到需要的位置粘贴');
            $('#file_paste').show();
        },
        // 存储桶文件粘贴
        set_file_paste:function(){
            var that = this;
            bt_tools.send({
                url:'/plugin?action=a&name=cosfs&s='+(this.operation_type == 'is_copy'?'copy':'move'),
                data:{
                    region:that.row_config.Location,
                    bucket_name:that.row_config.Name,
                    src: (this.old_operation_path).replace(/\/\//g, "/"),
                    filename: ($("#myPath").val()+'/'+getCookie(this.operation_type)).replace(/\/\//g, "/")
                }
            },function(res){
                if(res.status){
                    $('#file_paste').hide();
                    setCookie('is_copy',null);
                    setCookie('is_move',null);
                    that.render_bucket_list(that.bucket_file_path);
                } 
                layer.msg(res.msg,{icon:res.status?1:2})
            },'正在粘贴文件');
        },
        // 存储桶通目录创建
        createdir:function(){
            var that = this;
            layer.open({
                type: 1,
                area: "400px",
                title: "创建目录",
                closeBtn: 2,
                shift: 5,
                shadeClose: false,
                btn:['创建','取消'],
                content:'<div class=" pd20">\
                    <div class="line"><span class="tname">目录名称</span><div class="info-r"><div class="inlineBlock"><input type="text" name="path"  class="bt-input-text mr10 " style="width:200px;" value=""></div></div></div>\
                </div>',
                success:function(){},  
                yes:function(indexs){
                    if($('[name="path"]').val() == ''){
                        layer.msg('目录名称不能为空!',{icon:2});
                        return;
                    }
                    that.create_updir($('[name="path"]').val(),function(res){
                        layer.close(indexs);
                    });
                }
            });
            $("input[name='newPath']").focus().keyup(function(e){
                if(e.keyCode == 13) $(".createDir").click();
            });
        },
        //创建目录
        create_updir:function(name,callback){
            var that = this;
            bt_tools.send({
                url:'/plugin?action=a&name=cosfs&s=create_dir',
                data:{
                    region:this.row_config.Location,
                    bucket_name:this.row_config.Name,
                    dir_name:this.bucket_file_path+name
                }
            },function(res){
                if(callback) callback(res)
                bt_tools.msg(res);
                if(res.status) that.render_bucket_list(that.bucket_file_path);
            },'创建目录['+ name +']');
        },
        /**
         * @descripttion 挂载
         * @param name 存储桶名称
         * @param location 地区
         * @return: viod
         */    
        set_disk_mount:function(name,location){
            var regs = /([-][^-]+)$/, bucket_name = name.replace(regs,"");
            var mount_region_selected = bt_tools.open({
                title:'【'+ name +'】本地挂载',
                area:'400px',
                btn:['挂载','取消'],
                content:{
                    url:'/plugin?action=a&name=cosfs&s=mount_cosfs',
                    class:'pd20',
                    formLabelWidth:'80px',
                    form:[{
                        label:'挂载地址',
                        group:[{
                            type:'text',
                            name:'path',
                            width:'215px',
                            icon:{type:'glyphicon-folder-open',event:function(ev){
                                if($('#PathPlace span').text() == ''){
                                    var arry =  ev.path.split('/');
                                    arry.length = arry.length - 1
                                    GetDiskList(arry.join('/'))
                                }
                            }},
                            value:'/www/cosfs/' + bucket_name,
                            placeholder:'请选择文件目录',
                            verify:function(value,element){
                                if(value == ''){
                                    bt_tools.$verify_tips(element,'文件目录不能为空！');
                                    return false;
                                }
                                return value;
                            }
                        }]
                    }]
                },
                yes:function(form,indexs,layero){
                    this.$submit({region:location,bucket_name:name},function(res){
                        if(res.status) {
                            layer.close(indexs);
                            cosfs.$refresh_table_list(true,function(){
                                bt_tools.msg(res);
                            });
                        }
                    })
                }
            })
        },
        /**
         * @descripttion 卸载目录
         * @param name 存储桶名称
         * @param location 地区
         * @return: viod
         */    
        set_umount_cosfs:function(name,mounted){
            bt.confirm({ msg: "是否确定卸载【"+name+"】存储桶路径？", title: '删除存储桶' }, function () {
                bt_tools.send({
                    url:'/plugin?action=a&name=cosfs&s=umount_cosfs',
                    data:{bucket_name:name,path:mounted}
                }, function(res){
                    if(res.status) {
                        cosfs.$refresh_table_list(true,function(){
                            bt_tools.msg(res);
                        })
                    }
                },'卸载存储桶');
            })
        },
        /**
         * @descripttion 选择文件/目录路径
         * @param {String} isCheckFile （file、dir）只选择文件/目录
         * @param {String} d 输入到的位置
         * @return: 返回文件/目录路径
        */
        path_content:function(isCheckFile,d){
            var that =  this;
            that.path_type = isCheckFile;
            if(typeof d !== "undefined") this.input_regions = d;
            this.files_view = bt_tools.open({
                area: "750px",
                btn:false,
                title: isCheckFile == 'file' ? '选择上传文件' :lan.bt.dir,
                content: "<div class='changepath cosfs_path_style'>\
                    <div class='path-con'>\
                        <div class='path-con-left'>\
                            <dl style='max-height: 500px;overflow: auto;'><dt id='changecomlist'><span class='glyphicon glyphicon-hdd'></span>"+ lan.bt.comp  +"</dt></dl>\
                        </div>\
                        <div class='path-con-right'>\
                            <div class='pathCenStyle' style='height: 48px;'>\
                                <div class='pull-left' style='position: absolute;padding: 10px;'>\
                                    <button class='backBtn btn btn-default btn-sm glyphicon glyphicon-arrow-left pull-left btn-back-file'></button>\
                                    <button class='backBtn btn btn-default btn-sm glyphicon glyphicon-refresh pull-right' onclick='cosfs_bucket.get_flie_list()'  style='margin-left:-1px;'></button>\
                                    <span id='DirPathPlace' class='pull-left'><input id='fileInputPath' style='width:500px' type='text'></span>\
                                    <span id='PathPlaceBtn' class='pull-left' style='width:500px'></span>\
                                </div>\
                            </div>\
                            <div class='divtable'>\
                                <table class='table table-hover' id='table_thead' style='border:0 none'>\
                                    <thead></th>"+(isCheckFile != 'dir'? '<th width="5%"></th>': '')+"<th width='"+(isCheckFile == 'dir'? '45%':'40%')+"'>"+lan.bt.filename+"</th><th width='25%'>"+lan.bt.etime+"</th><th width='10%'>"+lan.bt.access+"</th><th width='10%'>"+lan.bt.own+"</th><th width='10%'></th></tr></thead>\
                                </table>\
                            </div>\
                            <div class='file-list divtable'>\
                                <table class='table table-hover' style='border:0 none;margin-top: -32px;'>\
                                    <thead></th>"+(isCheckFile != 'dir'? '<th width="5%"></th>': '')+"<th width='"+(isCheckFile == 'dir'? '45%':'40%')+"'>"+lan.bt.filename+"</th><th width='25%'>"+lan.bt.etime+"</th><th width='10%'>"+lan.bt.access+"</th><th width='10%'>"+lan.bt.own+"</th><th width='10%'></th></tr></thead>\
                                    <tbody id='dir_tbody' class='list-list'></tbody>\
                                </table>\
                            </div>\
                        </div>\
                    </div>\
                </div>\
                <div class='getfile-btn' style='margin-top:0;' >\
                    <button type='button' class='btn btn-default btn-sm pull-left btn_create_folder'>"+ lan.bt.adddir +"</button>\
                    <button type='button' class='btn btn-danger btn-sm mr5 btn_close'>"+ lan.public.close +"</button>\
                    <button type='button' class='btn btn-success btn-sm' onclick='cosfs_bucket.file_ok()'>"+ lan.bt.path_ok +"</button>\
                </div>",
                success:function(layero,index){
                    // 返回目录
                    $('.btn-back-file').click(function(){
                        that.files_path = that.back_file();
                        that.get_flie_list()
                    });
                    // 显示隐藏路径
                    $("#PathPlaceBtn").click(function(e){
                        if($("#DirPathPlace").is(":hidden")){
                            $("#DirPathPlace").css("display","inline");
                            $("#DirPathPlace input").focus();
                            $(this).hide();
                        }else{
                            $("#DirPathPlace").hide();
                            $(this).css("display","inline");
                        }
                        $(document).one("click", function(){
                            $("#DirPathPlace").hide();
                            $("#PathPlaceBtn").css("display","inline");
                        });
                        e.stopPropagation(); 
                    });
                    // 关闭layer
                    $('.btn_close').click(function(){
                        layer.close(index);
                    });
                    // 新建文件夹
                    $('.btn_create_folder').click(function(){
                        var isCreate = $('#dir_tbody tr:eq(0)').hasClass('table_add_dir');
                        if(isCreate) return false;
                        $('#dir_tbody').prepend('<tr class="table_add_dir">\
                                <td colspan="'+(isCheckFile != 'dir'? '6':'5')+'"><span class="glyphicon glyphicon-folder-open"></span><input class="newFolderName" type="text" value="" style="width: 300px;height: 30px;vertical-align: bottom;"></td>\
                            </td></tr>');
                        $('.newFolderName').keyup(function(e){
                            if(e.keyCode == 13) $(this).blur();
                        }).blur(function(e){
                            var _val = $(this).val();
                            if(_val == '') return layer.msg('文件名不能为空',{icon:2})
                            that.new_folder_event({name:_val},function(ress){
                                if(ress.status) that.get_flie_list();
                                layer.msg(ress.msg,{icon:ress.status?1:2})
                            });
                            $('.table_add_dir').remove();
                        }).focus();

                    });
                    // 点击目录或文件时
                    $('#dir_tbody').on('click','tr',function(e){
                        if(isCheckFile != 'dir'){
                            $(this).find('input[type="checkbox"]').click();
                            e.stopPropagation();
                        }
                    });
                    // 选择文件label时
                    $('#dir_tbody').on('click','tr input[type="checkbox"]',function(e){
                        var checked = $(this).prop('checked');
                        if(!checked){
                            $(this).parent().parent().removeClass('ui-selected');
                            if(e.target.name == 'file_input') that.is_checked_val = ''
                        }else{
                            switch(e.target.name){
                                case 'dir_input':
                                    that.is_checked_val = ''
                                break;
                                case 'file_input':
                                    that.is_checked_val = $(this).attr('data-name')
                                break;
                            }
                            $(this).parent().parent().addClass('ui-selected').siblings().removeClass('ui-selected').find('input').prop('checked',false);
                        }
                        e.stopPropagation();
                    });
                    // 目录跳转
                    $('#dir_tbody').on('click','.open_files_event',function(e){
                        var type = $(this).attr('data-type'),name = $(this).attr('data-name');
                        if(type == 'dir'){
                            if(name == 'Recycle_bin')return layer.msg('此为回收站目录，请在右上角按【回收站】按钮打开',{icon:2})
                            that.files_path = that.files_path + '/' + name
                            that.is_checked_val = ''
                            that.get_flie_list()
                        }else{
                            $(this).parent().siblings(".label_checkbox").find('input[type="checkbox"]').click();
                        }
                        e.stopPropagation();
                    })
                }
            })

            that.get_flie_list();

        },
        /**
         * @descripttion 获取文件列表
         * @return: viod
         */   
        get_flie_list:function(){
            var that = this;
            that.get_dirk_list(function(res){
                $('.path-con-right .file-list').show();
                var dir = res.DIR,files = res.FILES,disk = res.DISK,path = res.PATH,dir_html ='',files_html = '',disk_html = '';
                for(var i=0; i<dir.length; i++){
                    var dir_arry = dir[i].split(';');
                    dir_html += '<tr class="table_dir">'+(that.path_type != 'dir'? '<td class="label_checkbox"><input type="checkbox" name="dir_input" data-name="'+ dir_arry[0] +'"/></td>': '')+'<td><a href="javascript:;" data-name="'+ dir_arry[0] +'" data-type="dir" class="open_files_event"><span class="glyphicon glyphicon-folder-open"></span><span class="dir_block '+(that.path_type != 'dir'? 'fileWidthStyle': '')+'" title="'+ dir_arry[0] +'">'+ dir_arry[0] +'</span></td><td>'+ that.getLocalTime(dir_arry[2]) +'</td><td>'+ dir_arry[3] +'</td><td style="max-width: 50px;word-break: break-all;">'+ dir_arry[4] +'</td><td style="text-align: center;"><span><a class="btlink" href="javascript:;" onclick="cosfs_bucket.DeleteDir(\''+path +'/'+dir_arry[0]+'\')">删除</a></span></td></tr>'
                }
                if(files != null && files != ""){
                    for(var j=0;j<files.length;j++){
                        var files_arry = files[j].split(';');
                        files_html += '<tr class="table_files">'+(that.path_type != 'dir'? '<td class="label_checkbox"><input type="checkbox" name="file_input" data-name="'+ files_arry[0] +'"/></td>': '')+'<td><a href="javascript:;"  data-name="'+ files_arry[0] +'" data-type="file" class="open_files_event"><span class="ico-default ico-'+ that.obtain_suffix(files_arry[0]) +'"></span><span class="dir_block '+(that.path_type != 'dir'? 'fileWidthStyle': '')+'" title="'+ files_arry[0] +'">'+ files_arry[0] +'</span></a></td><td>'+ that.getLocalTime(files_arry[2]) +'</td><td>'+ files_arry[3] +'</td><td style="max-width: 50px;word-break: break-all;">'+ files_arry[4] +'</td><td></td></tr>'
                    }
                }
                if(disk != undefined){
                    for(var z=0;z<disk.length;z++){
                        var disk_info = disk[z];
                        var dir_list = disk_info.path.split('/');
                        dir_list = dir_list[dir_list.length -1];
                        disk_html += '<dt class="open_disk" data-dir="'+ disk_info.path +'" title="'+ disk_info.path +'"><span class="glyphicon glyphicon-hdd"></span>'+ (disk_info.path == '/'?'根目录 ('+ disk_info.size[2] +')':'<span class="table_self_conter" style="width:100px" title="'+ disk_info.path +' ('+ disk_info.size[2] +')">'+ dir_list +' ('+ disk_info.size[2] +')</span>') +'</dt>'
                    }
                }
                that.files_path = path
                $('.changepath .path-con-left dl').html(disk_html);
                $('#dir_tbody').html(dir_html+files_html);
                $('#DirPathPlace input').val(path);
                // 磁盘目录跳转
                $('.open_disk').click(function(){
                    var dir =  $(this).attr('data-dir');
                    that.files_path = dir
                    that.get_flie_list()
                });
                that.path_place(path);
            })
        },
        /**
         * @descripttion 路径显示,过滤
         * @param {String} path 路径
         * @return: viod
         */   
        path_place:function(path){
            var char = path.substr(path.length-1,1)
            if(char == '/') path = path.slice(0,path.length-1)
            var e, h, n=[],that = this,
            a = 8, //显示字符
            y = 4, //最高显示数量
            g = path.replace('//', '/').split("/");
            if(g[1] == '') g.splice(1,1)
            g.length <= 2 ? a = 30 : g.length <= 3 && (a = 15);   //根据数量显示字符
            var l = Math.max(g.length - y, 0),
            p = g;
            //文件夹数量超过，显示后四个，超出部分集合成一个li
            if(g.length > y){
                p = g.slice(l);
                var c = that.full_path(g, g.length -y);
                n[n.length] = '<li><a title="'+ c +'">...</a></li>';  
            }
            for(var d = 0, f = p.length; f > d; d++){
                e = p[d],
                h = e.length > a ? e.substring(0, a) + "...": e;
                var u = that.full_path(g, d + l);
                // 第一个值为空时,设置为根目录
                if(h === ''){
                    h = lan.files.path_root;
                    u = '/'
                }
                n[n.length] = d !== f - 1? '<li><a title="'+ u +'" data-deep="'+(d + l)+'">'+ h +'</a></li>' : '<li><span title="'+ u +'">'+ h +'</sapn></li>';
            }
            $("#PathPlaceBtn").html('<div style="height:26px"><ul>'+ n.join("") +'</ul></div>');
            $("#PathPlaceBtn ul li a").click(function(e){
                var Gopath = $(this).attr("title");
                if(Gopath.length>1){
                    if(Gopath.substr(Gopath.length-1,Gopath.length) =='/'){
                        Gopath = Gopath.substr(0,Gopath.length-1);
                    }
                }
                that.files_path = Gopath
                that.get_flie_list()
                e.stopPropagation();
            });
        },

        full_path:function(t,i){
            return i = Math.min(t.length, i),
            t.slice(0, i + 1).join("/")
        },
        /**
         * @descripttion 路径返回
         * @return: 返回上一步文件路径
         */   
        back_file:function() {
            var c = this.files_path;
            if(c == '/') return '/'
            if(c.substr(c.length - 1, 1) == "/") {
                c = c.substr(0, c.length - 1)
            }
            var d = c.split("/");
            var a = "";
            if(d.length > 1) {
                var e = d.length - 1;
                for(var b = 0; b < e; b++) {
                    a += d[b] + "/"
                }
                return a.replace("//", "/")
            } else {
                a = d[0]
            }
            if(d.length == 1) {}
        },
        /**
         * @descripttion 选择按钮
         * @return: viod
         */
        file_ok:function(){
            var that = this,inpautVal = $("#DirPathPlace input").val(),fileData = this.is_checked_val;
            if(that.path_type == 'file'){
                if(fileData == '')return layer.msg('请选择文件',{icon:2})
            }else if(that.path_type == 'dir'){
                fileData = ''
            }else{
                if(fileData == 'Recycle_bin') return layer.msg('不能选择此目录',{icon:2})
            }
            $(this.input_regions).val(that.path_type != 'dir'? inpautVal +'/'+ fileData: inpautVal);
            this.files_view.close()
            if($('#Upupload').val() != '') that.upload_files()
        },
        /**
         * @descripttion 获取后缀
         * @return: viod
         */ 
        obtain_suffix:function(fileName){
            var extArr = fileName.split(".");	
            var exts = ["folder", "folder-unempty", "sql", "c", "cpp", "cs", "flv", "css", "js", "htm", "html", "java", "log", "mht", "php", "url", "xml", "ai", "bmp", "cdr", "gif", "ico", "jpeg", "jpg", "JPG", "png", "psd", "webp", "ape", "avi", "mkv", "mov", "mp3", "mp4", "mpeg", "mpg", "rm", "rmvb", "swf", "wav", "webm", "wma", "wmv", "rtf", "docx", "fdf", "potm", "pptx", "txt", "xlsb", "xlsx", "7z", "cab", "iso", "rar", "zip", "gz", "bt", "file", "apk", "bookfolder", "folder-empty", "fromchromefolder", "documentfolder", "fromphonefolder", "mix", "musicfolder", "picturefolder", "videofolder", "sefolder", "access", "mdb", "accdb", "fla", "doc", "docm", "dotx", "dotm", "dot", "pdf", "ppt", "pptm", "pot", "xls", "csv", "xlsm"];
            var extLastName = extArr[extArr.length - 1];
            for(var i=0; i<exts.length; i++){
                if(exts[i]==extLastName){
                    return exts[i];
                }
            }
            return 'file';
        },
        /**
         * @descripttion 修改时间格式
         * @return: viod
         */ 
        getLocalTime:function(a) {
            a = a.toString();
            if(a.length > 10) {
                a = a.substring(0, 10)
            }
            return new Date(parseInt(a) * 1000).format("yyyy/MM/dd hh:mm:ss")
        },
        /**
         * @descripttion 文件删除
         * @return: viod
         */
        DeleteDir:function(path){
            var that = this;
            layer.confirm('是否删除&nbsp;['+ path  +']&nbsp;？', {title:'删除',btn: ['确定','取消'],icon:0,closeBtn:2}, function(){
                $.post("/files?action=DeleteDir", "&path="+path, function(res) {
                    if(res.status) that.get_flie_list();
                    layer.msg(res.msg,{icon:res.status?1:2});
                });
            });
        },
        // 新建文件请求
        new_folder_event:function(path,callback){
            bt_tools.send({
                url:'/files?action=CreateDir',
                data:{path:($('#fileInputPath').val()+'/'+path.name).replace(/\/\//g,'/')
            }},function(res){
                if(callback)callback(res);
            },'新建文件');
        },
        // 获取文件列表请求
        get_dirk_list:function(callback){
            var dir = this.files_path;
            dir = dir.replace(/\/\//g, "/");
            bt_tools.send({url:'/files?action=GetDir',data:{path:dir,disk:'True'}},function(res){
                if(callback)callback(res);
            },'文件列表')
        }
    }
	bt_tools.send('cosfs/get_config',function(res){
        var config = res;
		if($.isEmptyObject(res)){
			init = false;
			bt_tools.open(add_config);
			layer.close(_id);
		}else{
            init = true;
            element.show();
            cosfs = bt_tools.table({
                el:'#tencent_cosfs',
                fid:'cosfs',
                load:'获取存储桶列表',
                url:'/plugin?action=a&name=cosfs&s=get_buckets',
                default:"存储桶列表为空", //数据为空时的默认提示
                height:'520px',
                dataFilter:function(res){
                    return {data:res.list,total:res.total}
                },
                column:[
                    {fid:'Name',title:'存储桶名称', type:'link',fixed:true,width:150,event:function(row){
                        cosfs_bucket.row_config = row
                        cosfs_bucket.bucket_file_path ='/'
                        cosfs_bucket.isCos_file = true;
                        cosfs_bucket.render_bucket_list(cosfs_bucket.bucket_file_path);
                    }},
                    {fid:'mounted',title:'挂载目录',width:200,fixed:true,template:function(row){
                        if(!row.mounted) return '<div class="bt_warning btlink" onclick="cosfs_bucket.set_disk_mount(\'' + row.Name + '\',\'' + row.Location + '\')">点击挂载</div>';
                        return '<div><a class="btlink" style="max-width: 150px;display:inline-block;overflow: hidden;vertical-align: middle;word-break: break-word;text-overflow: ellipsis;" onclick="cosfs_bucket.mount_jump(\''+ row.mounted +'\')">'+ row.mounted +'</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a class="btlink" style="color:red" onclick="cosfs_bucket.set_umount_cosfs(\'' + row.Name + '\',\'' + row.mounted + '\')">卸载</a></div>'
                    }},
                    {fid:'Location',title:'所属大区',width:180,fixed:true,template:function(row){
                        return '<span>'+ row.Location + '&nbsp;( '+ row.region_name +' )</span>'
                    }},
                    {fid:'CreationDate',title:'创建时间',width:130,template:function(row){
                        return '<span>' + bt.format_data(new Date(row.CreationDate).getTime()) + '</span>';
                    }},
                    {title:'操作',type:'group',width:70,align:'right',
                        group:[{
                            title:'删除',
                            tips:'删除存储桶',
                            event:function(row,index,ev,key,that){
                                if(row.mounted == "true"){
                                    bt_tools.msg('当前存储桶已挂载，请手动卸载当前存储桶，然后在删除！',{msg,icon:0});
                                    return false;
                                }
                                var msg = '是否确定删除存储桶，删除前请确保存储桶内容已全部删除，否则删除将会失败？';
                                if(row.mounted)  msg = '当前存储桶已挂载到【'+ row.mounted +'】目录，删除后可能影响网站运行，是否确定删除存储桶？';
                                bt.confirm({ msg:msg, title: '删除【'+ row.Name +'】' }, function () {
                                    bt_tools.send('cosfs/delete_bucket',{region:row.Location,bucket_name:row.Name},function(res){
                                        if(res.status) that.$refresh_table_list(true,function(){
                                            bt_tools.msg(res);
                                        });
                                    },{load:'删除存储库',plugin:true});
                                });
                            }
                        }]
                    }
                ],
                tootls:[{
                    type:'group',
                    positon:['left','top'],
                    list:[{
                        title:'创建存储桶',
                        active:true,
                        event:function(ev,_that){
                            var region = [],_node=[],_all = [];
                            bt_tools.send('cosfs/get_regions',function(list){
                                $.each(list,function(index,item){
                                    region.push({value:index,title:item.value});
                                })
                                _node = list[0].data;
                                var add_bucket_layer = bt_tools.open({
                                    title:'创建存储桶',
                                    area:'480px',
                                    skin:'custom_layer',
                                    btn:['创建','取消'],
                                    content:{
                                        url:'/plugin?action=a&name=cosfs&s=create_bucket',
                                        class:'pd20',
                                        form:[{
                                            label:'所属大区',
                                            group:[{
                                                type:'select',
                                                name:'bucket_region',
                                                width:'120px',
                                                list:region,
                                                value:'',
                                                change:function(value,form,that,config,ev){
                                                    var _node = list[value['bucket_region']]['data'],_config = that.form_config['region'];
                                                    _config.list = _node;
                                                    that.$local_refresh('region',_config);
                                                }
                                            },{
                                                type:'select',
                                                name:'region',
                                                width:'170px',
                                                value:'',
                                                list:_node
                                            }]
                                        },{
                                            label:'存储桶名称',
                                            group:{
                                                type:'text',
                                                name:'bucket_name',
                                                width:'300px',
                                                placeholder:'请输入存储桶名称,只能包含英文字母、数字',
                                                verify:function(value,element){
                                                    if(value == ''){
                                                        bt_tools.$verify_tips(element,'存储桶名称不能为空！');
                                                        return false;
                                                    }
                                                    if(!/[0-9A-z\-]/g.test(value)){
                                                        bt_tools.$verify_tips(element,'存储桶名称不能包含中文和符号！');
                                                        return false;
                                                    }
                                                    return value;
                                                }
                                            }
                                        },{
                                            label:'',
                                            group:{
                                                type:'help',
                                                style:'margin-top:0;margin-left:10px;',
                                                list:['提示：推荐选择服务器相邻的区域，这样有助于提升服务器访问存储桶速度。']
                                            }
                                        }]
                                    },
                                    yes:function(form,indexs,layero){
                                        var that = this;
                                        this.$submit(form,function(res){
                                            if(res.status) {
                                                layer.close(indexs);
                                                _that.$refresh_table_list(true,function(){
                                                    bt_tools.msg(res);
                                                });
                                            }
                                        });
                                    }
                                })
                            },{load:'创建存储桶',plugin:true});
                        }
                    },{
                        title:'设置关联密钥',
                        event:function(ev){
                            add_config.content.data = config;
                            add_config.end = function(){}
                            bt_tools.open(add_config);
                        }
                    }]
                },{ // 搜索内容
                    type:'search',
                    positon:['right','top'],
                    placeholder:'请输入存储桶名称',
                    searchParam:'search', //搜索请求字段，默认为 search
                    width:'300px',
                    value:'',// 当前内容,默认为空
                },{ //分页显示
                    type:'page',
                    positon:['right','bottom'], // 默认在右下角
                    pageParam:'offset', //分页请求字段,默认为 : p
                    page:1, //当前分页 默认：1
                    numberParam:'length',　//分页数量请求字段默认为 : limit
                    number:10,　//分页数量默认 : 10条
                    render:true //是否渲染，默认后端渲染
                }]
            });
            $('#tencent_cosfs').append("<ul class='help-info-text c7' style='position: absolute;'>\
                <li>腾讯云COSFS工具可以将存储对象挂载到本地，像使用本地文件系统一样直接操作腾讯云对象存储。</li>\
                <li>腾讯云COS针对新用户提供免费50GB存储，有效期6个月。<a class='btlink' target='_blank' href='https://cloud.tencent.com/document/product/436/16871' >查看详情</a></li>\
            </ul>");
        }
    },{load:'获取腾讯云关联信息',plugin:true});
</script>