<style> 
.changepath {
	height: 500px
}
.changepath .path-con-left {
	width: 150px;
	height: 500px;
	float: left;
	border-right: #e4e3e3 1px solid;
	padding-top: 10px;
}
.changepath .path-con-left .open_disk span{
	padding-right: 7px;
}
.changepath .path-con-left dl dt {
	height: 30px;
	line-height: 30px;
	font-size: 13px;
	font-weight: normal;
	margin-left: 20px;
	cursor: pointer;
}
.changepath .path-con-left dl::-webkit-scrollbar{
	width: 4px;
}
.changepath .path-con-left dl dd span {
	color: #666
}
.changepath .path-con-right {
	float: left;
	height: 500px;
	overflow: hidden;
	width: 600px
}
.changepath .file-list{
	overflow: auto;
	height: 416px;
    top: -2px;
}
.changepath .file-list .table-hover>tbody>tr {
    height: 50px;
    cursor: pointer;
}
.changepath .file-list .table>tbody>tr>td {
    vertical-align: middle;
}
.changepath .path-con-right .list-list td {
    cursor: auto;
}
.changepath .file-list .list-list span.glyphicon-folder-open {
    margin-right: 15px;
    font-size: 23px;
    margin-left: 4px;
}

.changepath .list-list span.glyphicon {
	color: #666;
	margin-right: 10px;
	font-size: 18px
}
.changepath .list-list span.glyphicon-folder-open {
	color: #edca5c
}
.changepath .file-list .dir_block {
    display: inline-block;
    vertical-align: top;
    height: 25px;
    line-height: 25px;
}
.changepath .table_dir .dir_block, .table_files .dir_block {
    height: 28px;
	line-height: 28px;
	width: 200px;
    display: inline-block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.changepath .table_dir .dir_block.fileWidthStyle, .table_files .dir_block.fileWidthStyle{
	width: 175px;
}
.changepath .list-list .ico-default {
    background-position: center center;
    background-repeat: no-repeat;
    display: inline-block;
    height: 30px;
    margin-right: 10px;
    width: 33px;
    z-index: 1;
    float: left;
}

.getfile-btn {
	background: #f6f8f8 none repeat scroll 0 0;
	border-top: 1px solid #edf1f2;
	padding: 8px 20px 10px;
	text-align: right;
	width: 100%
}
</style>
<style>
    .plugin_body .box_conter {
        display: none;
    }
    .plugin_body .box_conter.active {
        display: block;
    }
    .install_log,
    .tomcat_log {
        margin: 0px;
        width: 610px;
        height: 470px;
        background-color: #424251;
        overflow: auto;
        line-height: 22px;
        color: #fff;
        padding-left: 10px;
        font-family: arial;
        margin-top: 10px;
        outline: none;
    }
    .bt-form .bt_tab_list{
        border:1px solid #ccc;
        border-bottom: 0;
        background-color: #ececec;
    }
    .box_item{
        height: 150px;
        padding: 15px;
    }
    .box_item .status{
        height: 30px;
    }
    .btn_item_block{
        display: inline-block;
        margin-right: 50px;
    }
    .box_item .btn{
        margin-right: 15px;
    }
    .box_item .box_title{
        height: 35px;
        line-height: 35px;
        font-size: 14px;
        border-bottom: 1px solid #f0f0f1;
        margin-bottom: 15px;
    }
    .CodeMirror{
        height: 400px;
    }
    .tomcat_list .path,
    .tomcat_path_list .path{
        width: 150px;
    }
    .tomcat_list tr td span,
    .tomcat_path_list tr td i{
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-style: normal;
    }
    .select_list{
        width: 180px;
        height: 35px;
        line-height: 35px;
        border:1px solid #888;
        border-radius: 2px;
        display: inline-block;
        cursor: pointer;
        position: relative;
        margin-left: 15px;
        background: #fff url(data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAICAgICAgICAgIDAgICBAUEAgIEBQYFBQUFBQYHBgYGBgYGBwcICAkICAcKCgsLCgoODg4ODg4ODg4ODg4ODg7/2wBDAQMDAwYFBgsHBwsODAoMDhEQEBAQEREODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg7/wAARCAAHABQDAREAAhEBAxEB/8QAFgAAAwAAAAAAAAAAAAAAAAAABQcJ/8QAJBAAAQMCBAcAAAAAAAAAAAAAAQMEBQIRAAYHQRITITJRYXH/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8Ar9nrS5SSnWj+E5bdOWVtJpmwCdVialaRvcAm3n70BywcKxy/GN4yPT4G7cd29R3qPs4AzgP/2Q==) no-repeat right center;
    }
    .select_list .select_item{
        width: 100%;
        display:block;
        /* text-align: center; */
        padding-left: 10px;
    }
    .select_list .select{
        width: 180px;
        position: absolute;
        left: -1px;
        top: 33px;
        border:1px solid #999;
        background: #fff;
    }
    .select_list .select li{
        height: 35px;
        line-height: 35px;
        padding:0 10px; 
    }
    .select_list .select li.active{
        background: #e6e6e6;
        /* cursor: no-drop; */
    }
    .select_list .select li:hover{
        background: #e6e6e6;
    }
    .install_version_box .btn-danger {
        color: #fff;
        background-color: #d9534f;
        border-color: #d43f3a;
    }
    /*添加项目单选框样式 start*/
    .port_check_style .box-group,
    .project_auto_start .box-group {
        display: inline-block;
        margin-right: 15px;
        vertical-align: middle;
        height: 32px;
        line-height: 32px;
    }
    .port_check_style .bt_checkbox_groups,
    .project_auto_start .bt_checkbox_groups {
        display: inline-block;
        height: 16px;
        width: 16px;
        border-radius: 1px;
        cursor: pointer;
        border: 1px solid #c2c2c2;
        position: relative;
        text-align: center;
        line-height: 20px;
        margin: 0;
        vertical-align: top;
    }
    .port_check_style .bt_checkbox_groups.active,
    .project_auto_start .bt_checkbox_groups.active {
        border: none;
        position: relative;
        top: 1px;
        display: inline-block;
        font-family: 'Glyphicons Halflings';
        font-style: normal;
        font-weight: 400;
        line-height: 1;
        -webkit-font-smoothing: antialiased;
        background: #20a53a;
        color: #fff;
    }
    .port_check_style .bt_checkbox_groups.active:after,
    .project_auto_start .bt_checkbox_groups.active:after {
        content: "\e013";
        font-size: 12px;
        transform: scale(.85);
        position: absolute;
        left: 2px;
        top: 2px;
    }
    .port_check_style .box-group .bt_checkbox_groups,
    .project_auto_start .box-group .bt_checkbox_groups {
        vertical-align: -2px;
        margin-right: 5px;
    }
    /*单选框 end*/
    .overflow_style{
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
</style>
<div class="bt-form">
    <div class="bt-w-main">
        <!--菜单部分-->
        <div class="bt-w-menu">
            <p class="bgw">Web项目管理</p>
            <p>Web容器服务</p>
            <p>容器配置文件</p>
            <p>容器管理</p>
            <p>Web项目日志</p>
            <p>Springboot</p>
        </div>
        <!--内容部分-->
        <div class="bt-w-con pd15 java_deploy">
            <div class="plugin_body">
                <div class="box_conter active">
                    <button class="btn btn-success btn-sm va0 mb15 add_project">添加项目</button>
                    <div class="bt-table" style="height: 345px;">
                        <div class="divtable">
                            <table class="table table-hover">
                                <thead><tr><th>项目域名</th><th>项目路径</th><th>项目类型</th><th>Web容器</th><th style="text-align: right;">操作</th></tr></thead>
                                <tbody class="project_list"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="page project_pages"></div>
                    <ul class="help-info-text c7">
                        <li>项目映射之后可以直接通过域名访问</li>
                        <li>tomcat7、8、9 的默认端口依次是8081、8082、8083 </li>
                        <li>如果碰到问题可以发帖到此处<a href="https://www.bt.cn/bbs/thread-21974-1-1.html" target="_blank" class="btlink">查看详情</a></li>
                    </ul>
                </div>
                <div class="box_conter version_box" style="max-height: 520px;overflow: auto;">
                    <div class="soft-man-con bt-form"></div>
                </div>
                <div class="box_conter config_box">
                    <div class="bt-form">
                        <p style="color: #666; margin-bottom: 7px">提示：Ctrl+F 搜索关键字，Ctrl+G 查找下一个，Ctrl+S 保存，Ctrl+Shift+R 查找替换!</p>
                        <span style="margin-right: 10px;">配置文件:</span><select class="bt-input-text mr5 bt_tab_list" name="tomcat_file_config" style="width:180px"></select>
                        <button id="textBodyBtn" class="btn btn-success btn-sm">保存</button>
                        <textarea class="bt-input-text" style="height: 300px; line-height: 18px; display: none;margin-top: 10px;" id="textBody"></textarea>
                    </div>
                </div>
                <div class="box_conter install_version_box">
                    <span>容器版本:</span><div class="select_list"><span class="select_item">Tomcat7 <i style="font-style: normal;color: #20a53a;">[ 已安装 ]</i></span>
                        <ul class="select" style="display:none"></ul>
                    </div>
                    <button class="btn btn-success btn-sm va0 mlr15 install_tomcat" style="display: none;">安装版本</button>
                    <button class="btn btn-danger btn-sm va0 mlr15 uninstall_tomcat" style="display: inline-block;">卸载版本</button>
                    <textarea class="install_log"></textarea>
                </div>
                <div class="box_conter">
                    <div style="margin-bottom:4px;"><span style="margin-right: 10px;">项目日志:</span><select class="bt-input-text mr5 tomcat_version" name="tomcat_version" style="width:180px"></select></div>
                    <textarea class="tomcat_log"></textarea>
                </div>
                <div class="box_conter">
                    <button class="btn btn-success btn-sm va0 mb15 add_springboot">添加项目</button>
                    <div class="bt-table" style="height: 310px;">
                        <div class="divtable">
                            <table class="table table-hover">
                                <thead><tr><th>项目域名</th><th>项目路径</th><th>命令</th><th width="50">端口</th><th>状态</th><th style="text-align: right;">操作</th></tr></thead>
                                <tbody class="springboot_list"></tbody>
                            </table>
                        </div>
                        
                    </div>
                    <div class="page springboot_pages" style="margin-top: 90px;"></div>
                    <ul class="help-info-text c7">
                      <li>spring boot部署教程<a href="https://www.bt.cn/bbs/thread-66448-1-1.html" target="_blank" class="btlink">查看详情</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!--JS脚本部分，不要将JS脚本写在其它地方-->
<script>
var java_deploy = {
    plugin_name: 'java_manager',
    path_type:'other', //默认可选择文件或目录
    version_list: {},
    config_file_data: [],
    service_data_log: [],
    jdk_version_list: [],
    springboot_list: [],
    springboot_return_cmd: {},
    edit_codeMirror: '',
    add_project_layer: '',
    ajaxList:{
        'get_installed_webserver': "获取服务状态",
        'get_project_list':'获取项目列表',
        'get_services':'获取Web容器列表',
        'get_springboot_list':'获取项目列表',
        'service_status_manage':'设置容器状态',
        'get_service_log': '获取日志',
        'add_project': '添加项目',
        'get_config_jdk_version': '获取JDK版本',
        'return_cmd': '返回cmd信息',
        'add_springboot_projects': '添加Springboot项目',
        'modify_port':'更改服务端口',
        'mapping_project':'映射项目',
        'springboot_services_manage':'设置Springboot状态',
        'delete_project':'删除项目',
        'delete_springboot_project':'删除Springboot项目'
    },
    init:function(){
        var that = this;
        $('.layui-layer-page').css({'width':'780px'});
        $(".bt-w-menu p").click(function () {
            var _offnum = 0,_total = 0,index = $(this).index();
            $.each(that.version_list,function(index,itm){
                _total++
                if(!that.version_list[index]) _offnum++
            })
            if(_total === _offnum){
                $('.bt-w-menu p:eq(3)').addClass('bgw').siblings().removeClass('bgw');
                $('.bt-w-con .plugin_body .install_version_box').addClass('active').siblings().removeClass('active');
                that.get_version_management();
                return layer.msg('未安装web容器服务',{icon:2});
            }
            $('.plugin_body .box_conter').eq(index).addClass('active').siblings().removeClass('active');
            $(this).addClass('bgw').siblings().removeClass('bgw');
            switch(index){
                case 0:
                    that.get_project_list();
                    break;
                case 1:
                case 2:
                    that.ajaxTask('get_services',function(ress){
                        that.config_file_data = ress;
                        if(index == 1){
                            that.get_container_server();
                        }else{
                            that.get_config_file();
                        }
                    })
                    break;
                case 3:
                    that.get_version_management();
                    break;
                case 4:
                    that.get_container_log();
                    break;
                case 5:
                    that.get_jdk_version();
                    that.get_springboot_list();
                    break;
            }
        });
        // 添加项目
        $('.add_project').click(function(){
            that.create_project_config()
        })
        // 添加springboot项目
        $('.add_springboot').click(function(){
            that.create_project_springboot()
        })
        // 配置文件切换
        $('.bt_tab_list').on('change',function(){
            $('#textBody').parent().find('.CodeMirror').remove();
            $('#textBody').val(that.config_file_data[$(this).val()]['conf']);
            that.edit_codeMirror = CodeMirror.fromTextArea(document.getElementById("textBody"), {
                extraKeys: { "Ctrl-Space": "autocomplete" },
                lineNumbers: true,
                matchBrackets: true,
            });
            $('#textBody').parent().find('.CodeMirror').css({"height":"460px","margin-top":"10px"})
        });
        // 日志服务切换
        $('.tomcat_version').change(function(){
            $('.tomcat_log').val(that.service_data_log[$(this).val()]['log'] == ''?'暂无日志': that.service_data_log[$(this).val()]['log']);
            var ele = document.getElementsByClassName('tomcat_log')[0];
            ele.scrollTop = ele.scrollHeight;
        });
        // 版本管理下拉开启关闭
        $('.select_list .select_item').click(function (e) {
            e.stopPropagation();
            if($('.select_list .select').attr('style').indexOf('block') > -1){
                $('.select_list .select').hide();
            }else{
                $('.select_list .select').show();
            }
            $(document).click(function(e){
                e.stopPropagation();
                $('.select_list .select').hide();
            });
        });
        // 版本管理下拉内的li事件
        $('.select_list').on('click','.select li',function(){
            $(this).addClass('active').siblings().removeClass('active');
            $('.select_list .select_item').html($(this).html());
            $('.select_list .select').hide();
            if($(this).html().indexOf('已安装') == -1){
                $('.install_tomcat').show().next().hide();
            }else{
                $('.uninstall_tomcat').show().prev().hide();
            }
        });
        // 版本管理安装、卸载按钮
        $('.install_version_box').on('click','.install_tomcat',function(){
            var active_val = $('.select .active').attr('data-value');
            that.set_version_status({version:active_val,type:'install'})
        });
        $('.install_version_box').on('click','.uninstall_tomcat',function(){
            var active_val = $('.select .active').attr('data-value');
            layer.confirm('是否卸载【'+ active_val +'】程序',{title:'卸载Web容器',icon:0,closeBtn: 2,shift: 5},function(){
                that.set_version_status({version:active_val,type:'uninstall'})
            });
        });
        this.ajaxTask('get_installed_webserver',function(res){
            var _off = 0,_ind = 0;
            that.version_list = res.webserver
            $.each(res.webserver,function(index,item){
                _ind++;
                if(!index) _off++; // 获取版本未安装的数量
            })
            if(_ind === _off){  //判断未安装的数量与版本数量是否相等
                $('.bt-w-menu p:eq(3)').click();
                return layer.msg("未安装web容器服务", {icon: 0,time:0,scrollbar:true,shade:0.3,shadeClose:true});
            }
            that.get_project_list();
        })
    },
    /**
     * @descripttion: 获取项目列表
     * @author: Lifu
     * @Date: 2020-07-30
     * @return: 无返回值
     */
    get_project_list:function(page){
        var that = this,_tbody = '';
        that.ajaxTask('get_project_list',{p:page == undefined ?1:page},function(res){
            if(res.data.length > 0){
                $.each(res.data,function(index,item){
                    _tbody += '<tr>'
                        +'<td><span class="overflow_style" style="width:130px" title="'+item['domain']+'">'+item['domain']+'</span></td>'
                        +'<td><a class="btlink" href="javascript:java_deploy.openPath(\''+item['path']+'\')"><span class="overflow_style" style="width:170px">'+item['path']+'</span></a></td>'
                        +'<td>'+(item['stype'] == 'independent'?'独立环境':'内置环境')+'</td>'
                        +'<td>'+item['webserver']+'</td>'
                        +'<td style="text-align: right;">'
                            +'<a href="javascript:;" class="btlink" onclick="java_deploy.set_mapping({id:\''+ item['id'] +'\',domain:\''+ item['domain'] +'\'})">映射</a>&nbsp;|&nbsp;'
                            +'<a href="javascript:;" class="btlink" onclick="java_deploy.remove_project({id:\''+ item['id'] +'\',domain:\''+ item['domain'] +'\'})">删除</a>'
                        +'</td></tr>'
                })
            }else{
                _tbody = '<tr><td colspan="5">暂无数据</td></tr>'
            }
            $('.project_list').html(_tbody);
            $('.project_pages').html(res.page);
            // 分页
            $('.project_pages a').click(function(e){
                var page = $(this).attr('href');
                page = page.match(/p=([0-9])$/)[1]
                that.get_project_list(page)
                e.stopPropagation();
                e.preventDefault();
            })
        })
    },
    
    /**
     * @descripttion:管理容器 
     * @author: Lifu
     * @Date: 2020-07-31
     * @return: 无返回值
     */
    get_container_server:function(){
        var _list = '';
        $.each(this.config_file_data,function(index,item){
            _list += '<div class="box_item">'
                    +'<div class="box_title">'+ item['service_name'] +'服务</div>'
                    +'<div class="status">'
                        +'<div class="btn_item_block">'
                            +'<span>当前状态：'+ (item['status']?'开启':'停止') +'</span>'
                            +'<span style="color: '+ (item['status']?'#20a53a':'red') +'; margin-left: 3px;" class="glyphicon '+ (item['status']?'glyphicon-play':'glyphicon-pause') +'"></span>'
                        +'</div>'
                        +'<div class="btn_item_block">'
                            +'<span>端口：</span><span>'+ item['port'] +'<a href="javascript:;" class="btlink ml5" data-version="'+ item['service_name'] +'" onclick="java_deploy.set_port_view({service_name:\''+ item['service_name'] +'\',port:\''+ item['port'] +'\',webserver:\''+ item['webserver'] +'\',stype:\''+ item['stype'] +'\'})">更改</a></span>'
                        +'</div>'
                        +'<div class="btn_item_block">'
                            +'<span>JDK版本：</span><span>'+item['jdk'] +'</span>'
                        +'</div>'
                    +'</div>'
                    +'<button type="button" class="btn btn-default btn-sm" onclick="java_deploy.set_project_switch_config({name:\''+ item['service_name'] +'\',type:\''+ (item['status']?'stop':'start') +'\',webserver:\''+item['webserver']+'\'})">'+ (item['status']?'停止':'启动') +'</button>'
                    +'<button type="button" class="btn btn-default btn-sm" onclick="java_deploy.set_project_switch_config({name:\''+ item['service_name'] +'\',type:\'reload\',webserver:\''+item['webserver']+'\'})">重载配置</button>'
                +'</div>'
        })
        $('.version_box .soft-man-con').html(_list)
    },
    /**
     * @descripttion: 获取springboot列表
     * @author: Lifu
     * @Date: 2020-08-10
     * @return: 无返回值
     */
    get_springboot_list:function(page){
        var that = this,_tbody = '';
        that.ajaxTask('get_springboot_list',{p:page == undefined ?1:page},function(res){
            that.springboot_list = res.data
            if(res.data.length > 0){
                $.each(res.data,function(index,item){
                    _tbody += '<tr>'
                        +'<td><span class="overflow_style" style="width:70px" title="'+item['domain']+'">'+(!item['domain']?item['project_name']:item['domain'])+'</span></td>'
                        +'<td><a class="btlink" href="javascript:java_deploy.openPath(\''+item['path']+'\')"><span class="overflow_style" style="width:145px" title="'+item['path']+'">'+item['path']+'</span></a></td>'
                        +'<td><span class="overflow_style" style="width:150px" title="'+item['service_order']+'">'+item['service_order']+'</span></td>'
                        +'<td>'+item['port']+'</td>'
                        +'<td>'+(item['status']?'<a class="btlink" onclick="java_deploy.set_springboot_switch({name:\''+item['project_name']+'\',version:\''+item['project_version']+'\',type:\'stop\'})">已开启<i class="glyphicon glyphicon-play"></i></a>':'<a style="color:red;cursor: pointer;" onclick="java_deploy.set_springboot_switch({name:\''+item['project_name']+'\',version:\''+item['project_version']+'\',type:\'start\'})">已关闭<i class="glyphicon glyphicon-pause"></i></a>')+'</td>'
                        +'<td style="text-align: right;">'
                            +'<a href="javascript:;" class="btlink" onclick="java_deploy.set_springboot_mapping({id:\''+ item['id'] +'\',domain:\''+ item['domain'] +'\'})">映射</a>&nbsp;|&nbsp;'
                            +'<a href="javascript:;" class="btlink" onclick="java_deploy.springboot_project_log('+index+')">日志</a>&nbsp;|&nbsp;'
                            +'<a href="javascript:;" class="btlink" onclick="java_deploy.remove_springboot({id:\''+ item['id'] +'\',name:\''+ item['project_name'] +'\'})">删除</a>'
                        +'</td></tr>'
                })
            }else{
                _tbody = '<tr><td colspan="6">暂无数据</td></tr>'
            }
            $('.springboot_list').html(_tbody);
            $('.springboot_pages').html(res.page);
            // 分页
            $('.springboot_pages a').click(function(e){
                var page = $(this).attr('href');
                page = page.match(/p=([0-9])$/)[1]
                that.get_springboot_list(page)
                e.stopPropagation();
                e.preventDefault();
            })
        })
    },
    /**
     * @descripttion:配置文件视图 
     * @author: Lifu
     * @Date: 2020-07-31
     * @return: 无返回值
     */
    get_config_file:function(){
        var _opt = '',that = this;
        $.each(this.config_file_data,function(index,files){
            _opt += '<option value="'+index+'">'+files['service_name']+'</option>'
        })
        $('.config_box .bt_tab_list').html(_opt);
        
        // 配置文件 保存按钮
        $('#textBodyBtn').unbind('click').click(function(){
            var index = $('.bt_tab_list').val();
            that.ajaxTask('modify_conf',{
                service_name:that.config_file_data[index]['service_name'],
                webserver:that.config_file_data[index]['webserver'],
                data:that.edit_codeMirror.getValue()
            },function(ress){
                if(ress.status) $('.bt-w-menu p:eq(2)').click();
                layer.msg(ress.msg,{icon:ress.status?1:2})
            })
        })
        $('#textBody').parent().find('.CodeMirror').remove();
        $('#textBody').val(this.config_file_data[0]['conf']);
        this.edit_codeMirror = CodeMirror.fromTextArea(document.getElementById("textBody"), {
            extraKeys: { "Ctrl-Space": "autocomplete" },
            lineNumbers: true,
            matchBrackets: true,
        });
        $('#textBody').parent().find('.CodeMirror').css({"height":"460px","margin-top":"10px"})
    },
    /**
     * @descripttion: 获取版本管理 
     * @author: Lifu
     * @Date: 2020-07-30
     * @return: 无返回值
     */
    get_version_management:function(callback){
        var that = this,_li = '';
        this.ajaxTask('get_installed_webserver',function(res){
            that.version_list = res.webserver;
            $.each(res.webserver,function(index,it){
                _li +='<li data-value="'+ index +'">'+ index +'&nbsp;<i style="font-style: normal;'+ (!res['webserver'][index]?'':'color: #20a53a;') +'">[ '+ (res['webserver'][index]?'已安装':'未安装')+' ]</i></li>'
            })
            $('.select_list .select').html(_li);
            var _index = $('.select_list .select li').eq(0).html();
            $('.select_item').html(_index);
            $('.select_list .select li').eq(0).addClass('active');
            if(_index.indexOf('未安装') > -1){
                $('.install_tomcat').show().next().hide();
            }else{
                $('.uninstall_tomcat').show().prev().hide();
            }
            
            $('.install_log').text(res['install_log'] == ''? '暂无日志' : res['install_log']);
            var ele = document.getElementsByClassName('install_log')[0];
            ele.scrollTop = ele.scrollHeight;
            if(callback) callback(res)
        })
    },
    /**
     * @descripttion: 容器日志
     * @author: Lifu
     * @Date: 2020-07-31
     * @return: 无返回值
     */
    get_container_log:function(){
        var _opt = '',that = this;
        this.ajaxTask('get_services',function(res){
            that.service_data_log = res
            $.each(res,function(index,item){
                _opt += '<option value="'+index+'">'+item['service_name']+'</option>'
            })
            $('.tomcat_log').val(res[0]['log'] == '' ?'暂无日志':res[0]['log']);
            $('.tomcat_version').html(_opt);
            var ele = document.getElementsByClassName('tomcat_log')[0];
            ele.scrollTop = ele.scrollHeight;
        })
    },
    /**
     * @descripttion: 创建新项目配置
     * @author: Lifu
     * @Date: 2020-08-01
     * @return: 无返回值
     */
    create_project_config:function(){
        var that = this;
        this.add_project_layer = layer.open({
            type: 1,
            closeBtn:2,
            title:'添加项目',
            btn: ['确定', '取消'],
            area: ['470px','520px'], //宽高
            content: '<div class="bt_conter bt-form pd15">\
                    <div class="line"><span class="tname">项目类型</span>\
                        <div class="info-r c4">\
                            <select class="bt-input-text mr5 projevt_type" name="type" style="width:270px">\
                                <option value="independent">独立环境</option>\
                                <option value="built">内置环境</option>\
                            </select>\
                        </div>\
                    </div>\
                    <div class="line"><span class="tname">项目版本</span>\
                        <div class="info-r c4">\
                        <select class="bt-input-text mr5 project_version" name="version" style="width:270px"></select></div>\
                    </div>\
                    <div class="line"><span class="tname">项目域名</span>\
                        <div class="info-r c4"><input class="bt-input-text" type="text" name="domain" placeholder="请输入项目域名" autocomplete="off" value="" style="width:270px"></div>\
                    </div>\
                    <div class="line"><span class="tname">项目路径</span>\
                        <div class="info-r c4"><input class="bt-input-text" id="server_path" type="text" name="path" placeholder="请输入项目路径" value="/www/server/tomcat_site" style="width:270px">\
                        <span data-id="path" class="glyphicon cursor ml5 glyphicon-folder-open open_select_item" onclick="java_deploy.path_content(\'server_path\')"></span></div>\
                    </div>\
                    <div class="line project_port"><span class="tname">项目端口</span>\
                        <div class="info-r c4"><input class="bt-input-text" type="number" name="port" placeholder="请输入项目端口" autocomplete="off" value="" style="width:270px"></div>\
                    </div>\
                    <div class="line project_auto_start"><span class="tname">开机自启动</span>\
                        <div class="info-r c4">\
                            <div class="box-group">\
                                <input type="checkbox" style="display:none;" name="auto_start" checked>\
                                <div class="bt_checkbox_groups active"></div>\
                            </div>\
                        </div>\
                    </div>\
                    <ul class="help-info-text c7" style="padding-left: 29px;margin-top:5px;">\
                        <li>【独立环境】独立创建一个Tomcat进程，与其他进程不产生影响和冲突（优点：进程间相互不影响，缺点：性能消耗大）</li>\
                        <li>【内置环境】依赖于当前Tomcat版本，重启时会影响环境中的所有网站（优点：性能消耗低，缺点：存在部分冲突问题）</li>\
                        <li>项目版本:如需添加其它项目版本，请在<a href="javascript:java_deploy.return_version();" class="btlink">版本管理</a>中安装</li>\
                    </ul>\
                </div>',
            success:function(){
                var _opt = '';
                $.each(that.version_list,function(index,item){
                    if(that.version_list[index]){
                        _opt += '<option value="'+index+'">'+index+'</option>'
                    }
                })
                $('.project_version').html(_opt);
                $('.projevt_type').change(function(){
                    if($(this).val() == 'built'){
                        $('.project_auto_start').hide();
                        $('.project_port').hide();
                    }else{
                        $('.project_auto_start').show();
                        $('.project_port').show();
                    }
                })
                // 单选框事件
                $('.box-group').on('click','.bt_checkbox_groups',function(){
        			if($(this).hasClass('active')){
        				$(this).removeClass('active').siblings('input').attr('checked', false);
        			}else{
        			    $(this).addClass('active').siblings('input').attr('checked', true);
        			}
        		})
                $('[name="domain"]').keyup(function(){
                    var val = $(this).val();
                    if($('[name="path"]').val().indexOf('/www/server/tomcat_site') > -1){
                        $('[name="path"]').val('/www/server/tomcat_site'+'/' +val);
                    }
                });
            },
            yes:function(index, layero){
                var type = $('[name="type"]').val(),
                    domain = $('[name="domain"]').val(),
                    path = $('[name="path"]').val(),
                    version = $('[name="version"]').val(),
                    port = $('[name="port"]').val(),
                    start = $('[name="auto_start"]').prop("checked"),
                    obj = {}
                if(domain == '') return layer.msg('请输入项目域名',{icon:2});
                if(path == '') return layer.msg('请输入项目路径',{icon:2});
                obj = {
                    stype: type,
                    domain:domain,
                    path:path,
                    webserver:version
                }
                if(type == 'independent'){
                    if(port == '') return layer.msg('请输入端口号',{icon:2});
                    obj['port'] = port;
                    obj['auto_start'] = start?1:0
                }
                that.ajaxTask('add_project',obj,function(res){
                    if(res.status){
                        that.get_project_list()
                        layer.close(index);
                    }
                    layer.msg(res.msg,{icon:res.status?1:2});
                })
            },
            btn2:function(index, layero){
                layer.close(index);
            }
        })
    },
    /**
     * @descripttion: JDK版本
     * @author: Lifu
     * @Date: 2020-07-31
     * @return: 无返回值
     */
    get_jdk_version:function(){
        var _opt = '',that = this;
        this.ajaxTask('get_config_jdk_version',function(res){
            that.jdk_version_list = res
        })
    },
    /**
     * @descripttion: 创建springboot项目
     * @author: Lifu
     * @Date: 2020-08-10
     * @return: 无返回值
     */
    create_project_springboot:function(){
        var that = this;
        this.add_project_layer = layer.open({
            type: 1,
            closeBtn:2,
            title:'添加Springboot项目',
            btn: ['确定', '取消'],
            area: ['500px','600px'], //宽高
            content: '<div class="bt_conter bt-form create_springboot pd15">\
                    <div class="line"><span class="tname">项目名称</span>\
                        <div class="info-r c4"><input class="bt-input-text" type="text" disabled="disabled" id="springboot_name" name="springboot_name" placeholder="请选择项目" autocomplete="off" value="" style="width:270px"></div>\
                    </div>\
                    <div class="line"><span class="tname">项目路径</span>\
                        <div class="info-r c4"><input class="bt-input-text" disabled="disabled" id="springboot_path" type="text" name="springboot_path" placeholder="请选择项目路径" value="/www/wwwroot" style="width:270px">\
                        <span data-id="path" class="glyphicon cursor ml5 glyphicon-folder-open open_select_item" onclick="java_deploy.path_content(\'springboot_path\',\'file\', \'java_deploy.callback_springboot_select_file()\')"></span></div>\
                    </div>\
                    <div class="line"><span class="tname">JDK版本</span>\
                        <div class="info-r c4">\
                        <select class="bt-input-text mr5 spr1ngboot_version" id="springboot_version" name="springboot_version" style="width:60px"></select><input class="bt-input-text" type="text"  id="springboot_jdk_path" name="springboot_jdk_path" placeholder="请选择JDK版本" value="" style="width:205px"></div>\
                    </div>\
                    <div class="line springboot_port"><span class="tname">项目域名</span>\
                        <div class="info-r c4"><input class="bt-input-text" type="text" id="springboot_domain" name="springboot_domain" placeholder="请输入项目域名" value="" style="width:270px"></div>\
                    </div>\
                    <div class="line springboot_port"><span class="tname">项目端口</span>\
                        <div class="info-r c4"><input class="bt-input-text" type="number" id="springboot_port" name="springboot_port" placeholder="请输入项目端口" autocomplete="off" value="" style="width:270px"></div>\
                    </div>\
                    <div class="line"><span class="tname">自定义参数</span>\
                        <div class="info-r c4"><textarea class="bt-input-textarea" id="springboot_args" name="springboot_args" onchange="java_deploy.change_springboot_cmd()" style="width:270px"></textarea></div>\
                    </div>\
                    <div class="line"><span class="tname">执行命令</span>\
                        <div class="info-r c4"><textarea class="bt-input-textarea" rows="3" disabled="disabled" id="springboot_cmd" name="springboot_cmd" placeholder="请选择项目" style="width:270px"></textarea>\
                        </div>\
                    </div>\
                    <div class="line"><span class="tname">高级模式</span>\
                        <div class="info-r c4" style="margin-top:5px">\
                         <input class="btswitch btswitch-ios" name="cmd_shell" id="cmd_shell" type="checkbox" >\
                          <label class="btswitch-btn" for="cmd_shell"></label>\
                        </div>\
                    </div>\
                    <div class="line project_auto_start"><span class="tname" style="margin-top:5px">root运行</span>\
                        <div class="info-r c4">\
                            <div class="box-group" style="margin-top:5px">\
                                <input type="checkbox" style="display:none;" id="springboot_is_root" name="springboot_is_root">\
                                <div class="bt_checkbox_groups"></div>\
                            </div>\
                            <div class="line project_auto_start" style="float:none;display:inline-block"><span class="tname">开机自启动</span>\
                                <div class="info-r c4">\
                                    <div class="box-group">\
                                        <input type="checkbox" style="display:none;" id="auto" name="auto" checked="checked">\
                                        <div class="bt_checkbox_groups active"></div>\
                                    </div>\
                                </div>\
                            </div>\
                        </div>\
                    </div>\
                    <ul class="mtl0 c7" style="font-size: 12px;position:absolute;bottom:15px;padding-right: 40px;">\
            		    <li style="list-style:inside disc">springboot教程<a href="https://www.bt.cn/bbs/thread-66448-1-1.html" target="_blank" class="btlink"> &gt;查看教程</a></li>\
            	    </ul>\
                </div>',
            success:function(){
                $('#springboot_cmd').empty()
                var _opt = '';
                $.each(that.jdk_version_list,function(index,item){
                    _opt += '<option value="'+index+'">'+item[0]+'</option>'
                })
                if(_opt != ''){
                    $('#springboot_version').html(_opt);
                    $('#springboot_version').change(function(){
                        var path = that.jdk_version_list[$(this).val()][1];
                        $("#springboot_jdk_path").val(path);
                        that.change_springboot_cmd();
                    }).change();
                } else {
                    $("#springboot_jdk_path").val("请输入JDK绝对路径例如:/usr/local/java/bin/java");
                }
                // 单选框事件
                $('.box-group').on('click','.bt_checkbox_groups',function(){
        			if($(this).hasClass('active')){
        				$(this).removeClass('active').siblings('input').attr('checked', false);
        			}else{
        			    $(this).addClass('active').siblings('input').attr('checked', true);
        			}
        			that.change_springboot_cmd();
        		})
        		$('#cmd_shell').on('click',function(e){
        		    var _check = $(this).prop('checked');
        		    if(_check){
        		        layer.confirm('是否开启高级模式,高级模式可以编辑生成的启动命令,如果你对这些不清楚建议不要更改。', {icon: 3, title:'开启高级模式',
                            closeBtn:2,
                            btn: ['确认','取消']
                        },function(index,layers){
                            layer.close(index);
                            $('#cmd_shell').prop('checked','checked');
                            $('#springboot_cmd').prop('disabled',false)
                        },function(index,layers){
                           $('#cmd_shell').prop('checked',false)
                        });
        		    }else{
        		         $('#springboot_cmd').empty().prop('disabled','disabled')
        		    }
        		})
            },
            yes:function(index, layero){
                var name = $('#springboot_name').val(),
                    path = $('#springboot_path').val(),
                    domain = $('#springboot_domain').val(),
                    port = $('#springboot_port').val(),
                    auto = $('#auto').siblings().hasClass('active')?1:0,
                    cmd_check = $('#cmd_shell').prop('checked'),
                    project_name = '',
                    obj = {};
                if(name == '') return layer.msg('请选择项目',{icon:2});
                project_name = name.split(".");
                if(project_name[project_name.length -1] != 'jar' && project_name[project_name.length -1] != 'war')  return layer.msg('请选择JAR格式的项目',{icon:2});
                if(path == '') return layer.msg('请选择项目路径',{icon:2});
                if(domain == '') return layer.msg('请输入项目域名',{icon:2});
                if(port == '') return layer.msg('请输入端口号',{icon:2});
                obj = {
                    project_name:name,
                    project_version: "springboot",
                    path:path,
                    domain:domain,
                    port:port,
                    log_path:that.springboot_return_cmd.log,
                    cmd_shell:(cmd_check?$('#springboot_cmd').val():that.springboot_return_cmd.qian+that.springboot_return_cmd.args+that.springboot_return_cmd.zui),
                    qian:that.springboot_return_cmd.qian,
                    args:' ' + that.springboot_return_cmd.args,
                    zui:that.springboot_return_cmd.zui,
                    auto:auto
                }
                console.log(obj)
                that.ajaxTask('add_springboot_projects',obj,function(res){
                    if(res.status){
                        that.get_springboot_list()
                        layer.close(index);
                    }
                    layer.msg(res.msg,{icon:res.status?1:2});
                })
            },
            btn2:function(index, layero){
                layer.close(index);
            }
        })
    },
    /**
     * @descripttion: 选择文件后回调
     * @author: Lifu
     * @Date: 2020-07-31
     * @return: 无返回值
     */
    callback_springboot_select_file:function(){
        var _opt = '',that = this,param = {};
        var fileData = getCookie("SetName");
        param = {
                    project_name:fileData,
                    project_version:"springboot",
                    path:getCookie("path_dir_change"),
                    port:$("#springboot_port").val(),
                    jdk_path:$("#springboot_jdk_path").val(),
                    log_path:"",
                    is_root:$("#springboot_is_root").prop("checked")?"1":"2"
                }
        this.ajaxTask('return_cmd',param,function(res){
            if(res.status){
                that.springboot_return_cmd = res.msg;
                $("#springboot_name").val(fileData);
                $("#springboot_port").val(that.springboot_return_cmd.port);
                $("#springboot_args").val(that.springboot_return_cmd.args);
                $("#springboot_cmd").val(that.springboot_return_cmd.cmd);
            }
        })
    },
    /**
     * @descripttion: 改变springboot的cmd
     * @author: Lifu
     * @Date: 2020-07-31
     * @return: 无返回值
     */
    change_springboot_cmd:function(){
        var that = this, cmd = "";
        var sb_cmd = that.springboot_return_cmd;
        if($.isEmptyObject(sb_cmd)){
            return;
        }
        var jdk_path = $("#springboot_jdk_path").val();
        var args = $("#springboot_args").val();
        if($("#springboot_is_root").prop("checked")){
            that.springboot_return_cmd.qian = sb_cmd.qian.replace(" springboot ", " root ");
        } else {
            that.springboot_return_cmd.qian = sb_cmd.qian.replace(" root ", " springboot ");
        }
        that.springboot_return_cmd.qian = sb_cmd.qian.replace(sb_cmd.jdk_path, jdk_path);
        that.springboot_return_cmd.jdk_path = jdk_path;
        that.springboot_return_cmd.args = args;
        cmd += sb_cmd.qian;
        cmd += " " + sb_cmd.args;
        cmd += " " + sb_cmd.zui;
        $("#springboot_cmd").val(cmd);
    },
    /**
     * @descripttion: 安装、卸载Web容器
     * @author: Lifu
     * @Date: 2020-07-31
     * @param {Object} obj.type   安装或卸载
     * @param {Object} obj.version  Web容器
     * @return: 无返回值
     */
    set_version_status:function(obj){
        var that = this;
        $(obj.type == 'install'?'.install_tomcat':'.uninstall_tomcat').html((obj.type == 'install'?'正在安装':'正在卸载')).attr('disabled','disabled');
        var load = layer.msg((obj.type == 'install'?'正在安装':'正在卸载') +'【'+ obj.version +'】'+'服务，请耐心等待&nbsp;<img src="/static/img/ing.gif">',{icon:16,time:0,shade: [0.3, '#000']})
        $.post('/plugin?action=a&name=java_manager&s=install_webserver',{type:obj.type,webserver:obj.version},function(res){
            if(res.status){
                $('.install_version_box '+ (obj.type == 'install'?'.btn-success':'.btn-danger')).html(obj.type == 'install'?'安装版本':'卸载版本').removeAttr('disabled');
                that.get_version_management()
            }
            layer.msg(res.msg,{icon:res.status?1:2})
        }).error(function(error){
            layer.msg('请求失败，请选择容器重新安装',{icon:2})
            $('.install_version_box '+ (obj.type == 'install'?'.btn-success':'.btn-danger')).html(obj.type == 'install'?'安装版本':'卸载版本').removeAttr('disabled');
        })
    },
    /**
     * @descripttion:项目映射 
     * @author: Lifu
     * @Date: 2020-07-31
     * @param {String} obj.domain 项目域名
     * @param {String} obj.id 项目ID
     * @return: 无返回值
     */
    set_mapping:function(obj){
        var that = this;
        if(obj.domain == 'localhost') return layer.msg('默认项目不支持映射',{icon:2});
        layer.confirm('是否映射【'+ obj.domain +'】项目',{title:'映射项目',icon:0,closeBtn: 2,shift: 5},function(){
            that.ajaxTask('mapping_project',{id:obj.id},function(res){
                layer.msg(res.msg,{icon:res.status?1:2})
            })
        })
    },
    
    /**
     * @descripttion:项目映射 
     * @author: Lifu
     * @Date: 2020-07-31
     * @param {String} obj.domain 项目域名
     * @param {String} obj.id 项目ID
     * @return: 无返回值
     */
    set_springboot_mapping:function(obj){
        var that = this;
        if(obj.domain == '') return layer.msg('域名为空不支持映射,建议重新建立项目映射',{icon:2});
        layer.confirm('是否映射【'+ obj.domain +'】项目',{title:'映射项目',icon:0,closeBtn: 2,shift: 5},function(){
            that.ajaxTask('springboot_mapping',{id:obj.id},function(res){
                layer.msg(res.msg,{icon:res.status?1:2})
            })
        })
    },
    /**
     * @descripttion:修改服务端口
     * @author: Lifu
     * @Date: 2020-07-31
     * @param {Object} obj.service_name 服务名称
     * @param {Object} obj.port 服务端口
     * @param {Object} obj.webserver 容器名称
     * @return: 无返回值
     */
    set_port_view:function(obj){
        var that = this;
        layer.open({
            type: 1,
            closeBtn:2,
            title:'修改【'+ obj.service_name +'】端口',
            area: '400px', //宽高
            content:'<div class="bt_conter bt-form pd15">\
                    <div class="line"><span class="tname">端口</span>\
                        <div class="info-r c4"><input class="bt-input-text" type="text" name="port" placeholder="请输入项目域名" value="'+ obj.port +'" style="width:200px"></div>\
                    </div>\
                    <div class="line port_check_style" style="display:'+(obj.stype == 'built'?'block':'none')+'"><span class="tname">是否映射</span>\
                    	<div class="info-r c4">\
                        	<div class="box-group">\
                                <input type="checkbox" style="display:none;" name="sumbit_check" checked>\
                                <div class="bt_checkbox_groups active"></div>\
                            </div>\
                        </div>\
                    </div>\
                </div>',
            btn:['确定','取消'],
            success:function(){
                // 单选框事件
                $('.box-group').on('click','.bt_checkbox_groups',function(){
        			if($(this).hasClass('active')){
        				$(this).removeClass('active').siblings('input').attr('checked', false);
        			}else{
        			    $(this).addClass('active').siblings('input').attr('checked', true);
        			}
        		})
            },
            yes:function(index,layero){
        		var port = $('[name="port"]').val(),objs = {service_name:obj.service_name,port:port,webserver:obj.webserver};
        		if(obj.stype == 'built') objs['check'] = $('[name=sumbit_check]').prop('checked')?1:0
        		if(port == '') return layer.msg('请输入端口号',{icon:2});
        		if(obj.port == port) return layer.msg('端口号未修改，无需提交',{icon:0})
                that.ajaxTask('modify_port',objs,function(res){
                    if(res.status){
                        layer.close(index);
                        $('.bt-w-menu p:eq(1)').click();
                    }
                    layer.msg(res.msg,{icon:res.status?1:2})
                })
            }
        })
    },
    /**
     * @descripttion: 开启、关闭、重载容器 
     * @author: Lifu
     * @Date: 2020-07-31
     * @param {Object} obj.version 容器名称
     * @param {Object} obj.type 执行操作
     * @return: 无返回值
     */
    set_project_switch_config:function(obj){
        var that = this,objs = {}
        switch(obj.type){
            case 'stop':
                objs = {title:'停止服务【'+ obj.name +'】',msg:'是否停止【'+ obj.name +'】服务',tips:'正在停止【'+ obj.name +'】服务，请稍后<img src="/static/img/ing.gif">'}
            break;
            case 'start':
                objs = {title:'启动服务【'+ obj.name +'】',msg:'是否启动【'+ obj.name +'】服务',tips:'正在启动【'+ obj.name +'】服务，请稍后<img src="/static/img/ing.gif">'}
            break;
            case 'reload':
                objs = {title:'重载服务【'+ obj.name +'】',msg:'是否重载【'+ obj.name +'】服务',tips:'正在重载【'+ obj.name +'】服务，请稍后<img src="/static/img/ing.gif">'}
            break;
        }
        layer.confirm(objs.msg,{title:objs.title,icon:0,closeBtn: 2,shift: 5},function(){
            that.ajaxTask('service_status_manage',{service_name:obj.name,type:obj.type,webserver:obj.webserver},function(res){
                if(res.status) $('.bt-w-menu p:eq(1)').click();
                layer.msg(res.msg,{icon:res.status?1:2})
            })
        })
    },
    /**
     * @descripttion: 设置springboot服务状态 
     * @author: Lifu
     * @Date: 2020-08-10
     * @param {Object} obj.name 项目名称
     * @param {Object} obj.version 项目版本
     * @param {Object} obj.type 状态 【start、stop】
     * @return: 无返回值
     */
    set_springboot_switch:function(obj){
        var that = this;
        layer.confirm('是否'+ (obj.type == 'start'?'启动':'停止') +'【'+obj.name+'】项目',{title:'设置'+obj.name+'',icon:0,closeBtn: 2,shift: 5},function(){
            that.ajaxTask('springboot_services_manage',{project_name:obj.name,project_version:obj.version,type:obj.type},function(res){
                if(res.status) that.get_springboot_list();
                layer.msg(res.msg,{icon:res.status?1:2});
            })
        });
    },
    /**
     * @descripttion: 删除项目
     * @author: Lifu
     * @Date: 2020-07-31
     * @param {Object} obj.domian 项目域名
     * @param {Object} obj.id 项目ID
     * @return: 无返回值
     */
    remove_project:function(obj){
        var that = this;
        if(obj.domain == 'localhost') return layer.msg('默认项目不支持删除',{icon:2});
        SafeMessage('删除项目','<font style="color:red">此操作将删除源文件</font>,是否删除该【 '+ obj.domain +' 】项目,是否继续?',function () {
            that.ajaxTask('delete_project',{id:obj.id},function(res){
                if(res.status) that.get_project_list();
                layer.msg(res.msg,{icon:res.status?1:2})
            })
        })
    },
    /**
     * @descripttion: 删除springboot项目
     * @author: Lifu
     * @Date: 2020-08-10
     * @param {Object} obj.name 项目名称
     * @param {Object} obj.id 项目ID
     * @return: 无返回值
     */
    remove_springboot:function(obj){
        var that = this;
        SafeMessage('删除Springboot项目','是否删除该【 '+ obj.name +' 】项目,是否继续?',function () {
            that.ajaxTask('delete_springboot_project',{id:obj.id},function(res){
                if(res.status) that.get_springboot_list();
                layer.msg(res.msg,{icon:res.status?1:2})
            })
        })
    },
    /**
     * @descripttion: 跳转到安装容器界面
     * @author: Lifu
     * @Date: 2020-08-05
     * @return: 无返回值
     */
    return_version:function(){
        $('.bt-w-menu p:eq(3)').click();
        layer.close(this.add_project_layer);
    },
    /**
     * @descripttion: springboot项目日志
     * @author: Lifu
     * @Date: 2020-08-11
     * @param {Number} num 项目索引
     * @return: 无返回值
     */
    springboot_project_log:function(num){
        var that = this;
        layer.open({
            type: 1,
			area: "610px",
			title: '【'+that.springboot_list[num]['project_name']+'】日志',
			content: '<textarea id="springboot_log" class="install_log"></textarea>',
			success:function(layero,index){
			    $.post("/plugin?action=a&name=java_manager&s=get_logs", "&path="+that.springboot_list[num]['log_path'], function(res) {
                    if(res.status){
                        $("#springboot_log").text(res.msg);
                    }
                })
			}
        })
    },
    /**
     * @descripttion: 打开文件路径【新窗口】
     * @author: Lifu
     * @Date: 2020-07-31
     * @param {String} obj 路径
     * @return: 无返回值
     */
    openPath:function(obj){
        window.open('/files')
        setCookie("Path", obj);
    },
    /**
     * @descripttion: 选择文件/目录/文件或目录选择窗
     * @author: Lifu
     * @Date: 2020-08-11
     * @param {String} d 输入框id
     * @param {String} type （file、dir、other）只选择文件/目录/文件或目录
     * @return: 返回文件/目录路径
     */
    path_content:function(d,type,callback){
		var that = this;
		setCookie("SetId", d);
		setCookie("SetName", "");
		that.path_type = type;
		var c = layer.open({
			type: 1,
			area: "770px",
			title: that.path_type == 'file' ? '选择文件' :(that.path_type == 'dir'? lan.bt.dir: '选择文件或目录'),
			closeBtn: 2,
			shift: 5,
			shadeClose: false,
			content: "<div class='changepath'>\
				<div class='path-con'>\
					<div class='path-con-left'>\
						<dl style='max-height: 500px;overflow: auto;'><dt id='changecomlist'><span class='glyphicon glyphicon-hdd'></span>"+ lan.bt.comp  +"</dt></dl>\
					</div>\
					<div class='path-con-right'>\
						<div class='pathCenStyle' style='height: 48px;'>\
							<div class='pull-left' style='position: absolute;padding: 10px;'>\
								<button class='backBtn btn btn-default btn-sm glyphicon glyphicon-arrow-left pull-left btn-back-file'></button>\
								<button class='backBtn btn btn-default btn-sm glyphicon glyphicon-refresh pull-right' onclick='bt.ChangePath.get_flie_list()'  style='margin-left:-1px;'></button>\
								<span id='DirPathPlace' class='pull-left'><input id='fileInputPath' style='width:500px' type='text'></span>\
								<span id='PathPlaceBtn' class='pull-left' style='width:500px'></span>\
							</div>\
						</div>\
						<div class='divtable'>\
							<table class='table table-hover' id='table_thead' style='border:0 none'>\
								<thead></th>"+(that.path_type != 'dir'? '<th width="5%"></th>': '')+"<th width='"+(that.path_type == 'dir'? '45%':'40%')+"'>"+lan.bt.filename+"</th><th width='25%'>"+lan.bt.etime+"</th><th width='10%'>"+lan.bt.access+"</th><th width='10%'>"+lan.bt.own+"</th><th width='10%'></th></tr></thead>\
							</table>\
						</div>\
						<div class='file-list divtable'>\
							<table class='table table-hover' style='border:0 none;margin-top: -32px;'>\
								<thead></th>"+(that.path_type != 'dir'? '<th width="5%"></th>': '')+"<th width='"+(that.path_type == 'dir'? '45%':'40%')+"'>"+lan.bt.filename+"</th><th width='25%'>"+lan.bt.etime+"</th><th width='10%'>"+lan.bt.access+"</th><th width='10%'>"+lan.bt.own+"</th><th width='10%'></th></tr></thead>\
								<tbody id='dir_tbody' class='list-list'></tbody>\
							</table>\
						</div>\
					</div>\
				</div>\
			</div>\
			<div class='getfile-btn' style='margin-top:0'>\
				<button type='button' class='btn btn-default btn-sm pull-left btn_create_folder'>"+ lan.bt.adddir +"</button>\
				<button type='button' class='btn btn-danger btn-sm mr5 btn_close'>"+ lan.public.close +"</button>\
				<button type='button' class='btn btn-success btn-sm' onclick='java_deploy.file_ok("+ callback +")'>"+ lan.bt.path_ok +"</button>\
			</div>",
			success:function(layero,index){
				// 返回目录
				$('.btn-back-file').click(function(){
					setCookie('file_paths',that.back_file());
					var str = $("#DirPathPlace input").val().replace('//','/');
					if(str.substr(str.length-1,1) == '/'){
							str = str.substr(0,str.length-1);
					}
					var Path = str.split("/");
					var back = '/';
					if (Path.length > 2) {
						var count = Path.length - 1;
						for (var i = 0; i < count; i++) {
							back += Path[i] + '/';
						}
						if(back.substr(back.length-1,1) == '/'){
							back = back.substr(0,back.length-1);
						}
						setCookie('file_paths',back);
						that.get_flie_list()
					} else {
						back += Path[0];
						setCookie('file_paths',back);
						that.get_flie_list()
					}
				});
				// 显示隐藏路径
				$("#PathPlaceBtn").click(function(e){
					if($("#DirPathPlace").is(":hidden")){
						$("#DirPathPlace").css("display","inline");
						$("#DirPathPlace input").focus();
						$(this).hide();
					}else{
						$("#DirPathPlace").hide();
						$(this).css("display","inline");
					}
					$(document).one("click", function(){
						$("#DirPathPlace").hide();
						$("#PathPlaceBtn").css("display","inline");
					});
					e.stopPropagation(); 
				});
				// 关闭layer
				$('.btn_close').click(function(){
					layer.close(index);
				});
				// 新建文件夹
				$('.btn_create_folder').click(function(){
					var isCreate = $('#dir_tbody tr:eq(0)').hasClass('table_add_dir');
					if(isCreate) return false;
					$('#dir_tbody').prepend('<tr class="table_add_dir">\
							<td colspan="'+(that.path_type != 'dir'? '3':'2')+'"><span class="glyphicon glyphicon-folder-open"></span><input class="newFolderName" type="text" value="" style="width: 300px;height: 30px;vertical-align: bottom;">\
							<td colspan="3"><button type="button" class="btn btn-success btn-sm newFolderEvent">'+lan.public.ok+'</button>&nbsp;&nbsp;<button type="button" class="btn btn-default btn-sm newFolderClaer">'+lan.public.cancel+'</button></td>\
						</td></tr>');
					document.getElementsByClassName('file-list')[0].scrollTop = 0;
					$(".newFolderName").focus();
					setTimeout(function(){
						$('.table_add_dir').on('click','.newFolderEvent',function(e){
							var fileName = $('.newFolderName').val();
							if(fileName == ''){
								layer.msg('请输入新建文件名称',{icon:0});
								return false;
                            }
                            that.new_folder_event(getCookie('file_paths') + '/' + fileName,function(res){
								$(this).parent().parent().remove();
								that.get_flie_list()
							})
							e.stopPropagation();
						});
						$('.table_add_dir').on('click','.newFolderClaer',function(e){
							$(this).parent().parent().remove();
							e.stopPropagation();
						});
					},500);
				});
				// 点击目录或文件时
				$('#dir_tbody').on('click','tr',function(e){
					if(that.path_type != 'dir'){
						$(this).find('input[type="checkbox"]').click();
                        e.stopPropagation();
					}
				});
				// 选择文件label时
				$('#dir_tbody').on('click','tr input[type="checkbox"]',function(e){
					var checked = $(this).prop('checked');
					if(!checked){
						$(this).parent().parent().removeClass('ui-selected');
						if(e.target.name == 'file_input') setCookie('SetName','')
					}else{
						switch(e.target.name){
							case 'dir_input':
								setCookie('SetName','');
							break;
							case 'file_input':
								setCookie('SetName',$(this).attr('data-name'));
							break;
						}
						if(that.path_type == 'other') setCookie('SetName',$(this).attr('data-name'))
						$(this).parent().parent().addClass('ui-selected').siblings().removeClass('ui-selected').find('input').prop('checked',false);
					}
					e.stopPropagation();
				});
				// 目录跳转
				$('#dir_tbody').on('click','.open_files_event',function(e){
					var type = $(this).attr('data-type');
					var name = $(this).attr('data-name');
					var path = getCookie('file_paths');
					if(type == 'dir'){
						if(name == 'Recycle_bin')return layer.msg('此为回收站目录，请在右上角按【回收站】按钮打开',{icon:2})
						setCookie('file_paths',path + '/' + name);
						setCookie('SetName','')
						that.get_flie_list()
					}else{
						$(this).parent().siblings(".label_checkbox").find('input[type="checkbox"]').click();
					}
					e.stopPropagation();
				})
			}
		});
		setCookie("ChangePath", c);
		var b = $("#" + d).val();
		tmp = b.split(".");
		if(tmp[tmp.length - 1] == "gz") {
			tmp = b.split("/");
			b = "";
			for(var a = 0; a < tmp.length - 1; a++) {
				b += "/" + tmp[a]
			}
			setCookie("SetName", tmp[tmp.length - 1])
		}
		setCookie('file_paths',b = b.replace(/\/\//g, "/"));
		that.get_flie_list();
	},
    /**
     * @descripttion: 获取文件列表
     * @author: Lifu
     * @Date: 2020-08-11
     * @return: 无返回值
     */   
	get_flie_list:function(){
		var that = this;
		var getPath = getCookie('file_paths')
        that.get_dirk_list(function(res){
			$('.path-con-right .file-list').show();
			var dir = res.DIR,files = res.FILES,disk = res.DISK,path = res.PATH,dir_html ='',files_html = '',disk_html = '';
			for(var i=0; i<dir.length; i++){
				var dir_arry = dir[i].split(';');
				dir_html += '<tr class="table_dir">'+(that.path_type != 'dir'? '<td class="label_checkbox"><input type="checkbox" name="dir_input" data-name="'+ dir_arry[0] +'"/></td>': '')+'<td><a href="javascript:;" data-name="'+ dir_arry[0] +'" data-type="dir" class="open_files_event"><span class="glyphicon glyphicon-folder-open"></span><span class="dir_block '+(that.path_type != 'dir'? 'fileWidthStyle': '')+'" title="'+ dir_arry[0] +'">'+ dir_arry[0] +'</span></td><td>'+ that.getLocalTime(dir_arry[2]) +'</td><td>'+ dir_arry[3] +'</td><td style="max-width: 50px;word-break: break-all;">'+ dir_arry[4] +'</td><td style="text-align: center;"><span><a class="btlink" href="javascript:;" onclick="bt.ChangePath.DeleteDir(\''+path +'/'+dir_arry[0]+'\')">删除</a></span></td></tr>'
			}
			if(files != null && files != ""){
				for(var j=0;j<files.length;j++){
					var files_arry = files[j].split(';');
					files_html += '<tr class="table_files">'+(that.path_type != 'dir'? '<td class="label_checkbox"><input type="checkbox" name="file_input" data-name="'+ files_arry[0] +'"/></td>': '')+'<td><a href="javascript:;"  data-name="'+ files_arry[0] +'" data-type="file" class="open_files_event"><span class="ico-default ico-'+ that.obtain_suffix(files_arry[0]) +'"></span><span class="dir_block '+(that.path_type != 'dir'? 'fileWidthStyle': '')+'" title="'+ files_arry[0] +'">'+ files_arry[0] +'</span></a></td><td>'+ that.getLocalTime(files_arry[2]) +'</td><td>'+ files_arry[3] +'</td><td style="max-width: 50px;word-break: break-all;">'+ files_arry[4] +'</td><td></td></tr>'
				}
			}
			if(disk != undefined){
				for(var z=0;z<disk.length;z++){
					var disk_info = disk[z];
					var dir_list = disk_info.path.split('/');
					dir_list = dir_list[dir_list.length -1];
					disk_html += '<dt class="open_disk" data-dir="'+ disk_info.path +'" title="'+ disk_info.path +'"><span class="glyphicon glyphicon-hdd"></span>'+ (disk_info.path == '/'?'根目录 ('+ disk_info.size[2] +')':'<span class="table_self_conter" style="width:100px" title="'+ disk_info.path +' ('+ disk_info.size[2] +')">'+ dir_list +' ('+ disk_info.size[2] +')</span>') +'</dt>'
				}
			}
			setCookie('file_paths',path);
			$('.changepath .path-con-left dl').html(disk_html);
			$('#dir_tbody').html(dir_html+files_html);
			$('#DirPathPlace input').val(path);
			// 磁盘目录跳转
			$('.open_disk').click(function(){
				var dir =  $(this).attr('data-dir');
				setCookie('file_paths',dir)
				that.get_flie_list()
			});
			that.path_place(path);
			return
		})
	},
    /**
     * @descripttion: 路径显示,过滤
     * @author: Lifu
     * @Date: 2020-08-11
     * @param {String} path 路径
     * @return: 无返回值
     */   
	path_place:function(path){
		var e, h, n=[],that = this,
		a = 8, //显示字符
		y = 4, //最高显示数量
		g = path.replace('//', '/').split("/");
		if(g[1] == '') g.splice(1,1)
		g.length <= 2 ? a = 30 : g.length <= 3 && (a = 15);   //根据数量显示字符
		var l = Math.max(g.length - y, 0),
		p = g;
		//文件夹数量超过，显示后四个，超出部分集合成一个li
		if(g.length > y){
			p = g.slice(l);
			var c = that.full_path(g, g.length -y);
			n[n.length] = '<li><a title="'+ c +'">...</a></li>';  
		}
		for(var d = 0, f = p.length; f > d; d++){
			e = p[d],
			h = e.length > a ? e.substring(0, a) + "...": e;
			var u = that.full_path(g, d + l);
			// 第一个值为空时,设置为根目录
			if(h === ''){
				h = lan.files.path_root;
				u = '/'
			}
			n[n.length] = d !== f - 1? '<li><a title="'+ u +'" data-deep="'+(d + l)+'">'+ h +'</a></li>' : '<li><span title="'+ u +'">'+ h +'</sapn></li>';
		}
		$("#PathPlaceBtn").html('<div style="height:26px"><ul>'+ n.join("") +'</ul></div>');
		$("#PathPlaceBtn ul li a").click(function(e){
			var Gopath = $(this).attr("title");
			if(Gopath.length>1){
				if(Gopath.substr(Gopath.length-1,Gopath.length) =='/'){
					Gopath = Gopath.substr(0,Gopath.length-1);
				}
			}
			setCookie('file_paths',Gopath)
			that.get_flie_list()
			e.stopPropagation();
		});
    },
	full_path:function(t,i){
		return i = Math.min(t.length, i),
		t.slice(0, i + 1).join("/")
    },
    /**
     * @descripttion: 路径返回
     * @author: Lifu
     * @Date: 2020-08-11
     * @return: 返回上一步文件路径
     */   
	back_file:function() {
		var c = getCookie('file_paths');
		if(c == '/') return '/'
		if(c.substr(c.length - 1, 1) == "/") {
			c = c.substr(0, c.length - 1)
		}
		var d = c.split("/");
		var a = "";
		if(d.length > 1) {
			var e = d.length - 1;
			for(var b = 0; b < e; b++) {
				a += d[b] + "/"
			}
			return a.replace("//", "/")
		} else {
			a = d[0]
		}
		if(d.length == 1) {}
	},
	/**
     * @descripttion: 选择按钮
     * @author: Lifu
     * @Date: 2020-08-11
     * @return: 无返回值
     */
	file_ok:function(callback){
		var that = this,inpautVal = $("#DirPathPlace input").val(),fileData = getCookie("SetName");
		if(that.path_type == 'file'){
			if(fileData == '')return layer.msg('请选择文件',{icon:2})
		}else if(that.path_type == 'dir'){
			fileData = ''
		}else{
			if(fileData == 'Recycle_bin') return layer.msg('不能选择此目录',{icon:2})
		}
		setCookie('path_dir_change',inpautVal);
		// $("#" + getCookie("SetId")).val(that.path_type != 'dir'? inpautVal +'/'+ fileData: inpautVal);
		$("#" + getCookie("SetId")).val(inpautVal);
        if(typeof callback == "function")callback();
        layer.close(getCookie("ChangePath"))
	},
	/**
     * @descripttion: 获取后缀
     * @author: Lifu
     * @Date: 2020-08-11
     * @return: 无返回值
     */ 
	obtain_suffix:function(fileName){
		var extArr = fileName.split(".");	
		var exts = ['folder','folder-unempty','sql','c','cpp','cs','flv','css','js','htm','html','java','log','mht','php','url','xml','ai','bmp','cdr','gif','ico','jpeg','jpg','JPG','png','psd','webp','ape','avi','flv','mkv','mov','mp3','mp4','mpeg','mpg','rm','rmvb','swf','wav','webm','wma','wmv','rtf','docx','fdf','potm','pptx','txt','xlsb','xlsx','7z','cab','iso','rar','zip','gz','bt','file','apk','bookfolder','folder','folder-empty','folder-unempty','fromchromefolder','documentfolder','fromphonefolder','mix','musicfolder','picturefolder','videofolder','sefolder','access','mdb','accdb','sql','c','cpp','cs','js','fla','flv','htm','html','java','log','mht','php','url','xml','ai','bmp','cdr','gif','ico','jpeg','jpg','JPG','png','psd','webp','ape','avi','flv','mkv','mov','mp3','mp4','mpeg','mpg','rm','rmvb','swf','wav','webm','wma','wmv','doc','docm','dotx','dotm','dot','rtf','docx','pdf','fdf','ppt','pptm','pot','potm','pptx','txt','xls','csv','xlsm','xlsb','xlsx','7z','gz','cab','iso','rar','zip','bt','file','apk','css'];
		var extLastName = extArr[extArr.length - 1];
		for(var i=0; i<exts.length; i++){
			if(exts[i]==extLastName){
				return exts[i];
			}
		}
		return 'file';
	},
	/**
     * @descripttion: 修改时间格式
     * @author: Lifu
     * @Date: 2020-08-11
     * @return: 无返回值
     */ 
	getLocalTime:function(a) {
		a = a.toString();
		if(a.length > 10) {
			a = a.substring(0, 10)
		}
		return new Date(parseInt(a) * 1000).format("yyyy/MM/dd hh:mm:ss")
	},
	/**
     * @descripttion: 文件删除
     * @author: Lifu
     * @Date: 2020-08-11
     * @return: 无返回值
     */
	DeleteDir:function(path){
		var that = this;
		layer.confirm('是否删除&nbsp;['+ path  +']&nbsp;？', {title:'删除',btn: ['确定','取消'],icon:0,closeBtn:2}, function(){
			$.post("/files?action=DeleteDir", "&path="+path, function(res) {
				if(res.status){
					layer.msg(res.msg,{icon:1});
					that.get_flie_list();
				}else{
					layer.msg(res.msg,{icon:2});
				}
			});
		});
	},
    // 新建文件请求
    new_folder_event:function(path,callback){
        this.http({
            url:'/files?action=CreateDir',
            tips:'正在新建文件，请稍后...',
            data:{path:path},
            success:function(res){
                if(callback)callback(res);
            }
        })
    },
    // 获取文件列表请求
    get_dirk_list:function(callback){
        var dir = getCookie('file_paths');
        dir = dir.replace(/\/\//g, "/");
        this.http({
            url:'/files?action=GetDir',
            tips:'正在获取文件列表，请稍后...',
            data:{path:dir,disk:'True'},
            success:function(res){
                if(callback)callback(res);
            }
        })
    },
    /**
     * @descripttion: 动态处理请求，设置全局ajaxList，api和提示语，遍历请求返回成功值
     * @param {String} config 需要请求的api
     * @param {Function} data 请求参数
     * @param {Function} success 成功值
     * @param {Function} error 失败值
     */
     ajaxTask: function (config, data, success, error) {
        if (typeof config == "string") {
            if (typeof data == "object") {
                config = { method: config, data: data, success: success, error: error }
            } else if (typeof data == "function") {
                config = { method: config, success: data }
                if (typeof success == "function") {
                    config.error = success
                }
            }
        }
        if (config.middle === false) { config.success(); return false }
        this.http({
            tips: '正在' + this.ajaxList[config.method] + ',请稍候...',
            method: config.method,
            data: config.data || {},
            success: function (rdata) {
                if (config.success) config.success(rdata);
            },
            error: function (rdata) {
                if (config.error) config.error(rdata);
            }
        });
    },
    /**
     * @descripttion: 请求方法封装
     * @param {Object} obj 请求配置参数
     * @param {String} obj.url 请求配置，url地址
     * @param {Number} obj.load 请求配置，提示类型
     * @param {String} obj.type 请求配置，请求类型，默认为POST
     * @param {String} obj.plugin_name 请求配置，插件类名称
     * @param {String} obj.method 请求配置，插件方法
     * @param {String} obj.type 请求配置，请求类型，默认为POST
     * @param {Function} obj.success 请求配置，请求成功回调
     * @param {Function} obj.error 请求配置，请求成功失败
     * @return 无返回值
     */
    http: function (obj) {
        var loadT = '';
        if (obj.load == undefined) obj.load = 0;
        if (obj.url == undefined) {
            if (obj.plugin_name === undefined && this.plugin_name !== undefined) obj.plugin_name ? obj.plugin_name : obj.plugin_name = this.plugin_name
            if (!obj.plugin_name || !obj.method) {
                layer.msg('插件类名称，或插件方法名称缺失!', { icon: 2 });
                return false;
            }
        }
        if (obj.load === 0 || obj.tips != undefined) {
            loadT = layer.msg(obj.tips, { icon: 16, time: 0, shade: 0.1 });
        } else if (obj.load === 1 || (obj.tips == undefined && obj.load == undefined)) {
            loadT = layer.load();
        }
        $.ajax({
            type: obj.type === undefined ? 'POST' : obj.type,
            url: obj.url != undefined ? obj.url : ('/plugin?action=a&name=' + obj.plugin_name + '&s=' + obj.method),
            data: obj.data || {},
            timeout: obj.timeout || 99999999,
            complete: function (res) {
                if (obj.load === 0 || obj.load === 1) layer.close(loadT);
            },
            success: function (rdata) {
                if (obj.check) {
                    obj.success(rdata);
                    return
                }
                if (typeof rdata.status !== 'undefined' && rdata.status === false) {
                    layer.msg(rdata.msg, { icon: 2 });
                    return false;
                }
                obj.success(rdata);
            },
            error: function (ex) {
                if (!obj.error) {
                    obj.msg || obj.msg == undefined ? layer.msg('请求过程发现错误!', { icon: 2 }) : '';
                    return;
                }
                return obj.error(ex);
            }
        });
    }
}
java_deploy.init()
</script>