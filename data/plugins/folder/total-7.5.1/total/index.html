<style>
    .site_monitoring_statistics .bt-w-menu{
        height: 658px;
    }
    .site_monitoring_statistics .bt-w-main{height: 100%;}
    .site_monitoring_statistics input,
    .site_monitoring_statistics select{
        outline: none;
        height: 28px;
        border: 1px solid #ddd;
        
    }
    .site_monitoring_statistics .btn-sm{
        padding: 4px 10px;
    }
    .siteSelected.mt_select {
        width: auto;
        min-width: 120px;
        padding-right: 20px;
        vertical-align:inherit;
        border: 1px solid #20a53a;
    }
    .siteSelected.mt_select .mt_select_value{
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        display: inline-block;
        vertical-align: bottom;
        max-width: 100px;
    }
    .checked_time{
        display: inline-flex;
        align-items: center;
        margin-left: 10px;
        cursor: pointer;
    }
    .time_contrast{
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 12px;
    }
    .time_contrast i{
        display: inline-block;
        margin-right: 10px;
        width: 14px;
        height: 14px;
        border: 1px solid #ccc;
        background-color: #fff;
        vertical-align: bottom;
        position: relative;
        border-radius: 2px;
    }
    .time_contrast .active i{
        background-color: #20a53a;
        border-color: #20a53a;
    }
    .time_contrast .active i::after {
        content: '';
        position: absolute;
        display: block;
        left: 50%;
        top: 50%;
        margin-left: -1.5px;
        margin-top: -5px;
        width: 4px;
        height: 8px;
        border: solid #fff;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }
    .selected_list{margin-right:10px}
    .total_head{margin-bottom: 15px;}
    .search-day {
        height: 28px;
        display: inline-block;
        vertical-align: top;
        cursor: pointer;
        margin-right: 10px;
    }
    
    .search-day span {
        float: left;
        border: #ddd 1px solid;
        border-left: none;
        padding: 5px 10px;
        position: relative;
        height: 28px;
    }

    .search-day span:first-of-type {
        border-left: #ddd 1px solid;
    }
    
    .search-day span.cur {
        border-right: none;
        border-color: #20a53a;
        background-color: #20a53a;
        color: #fff;
    }
    
    .search-day span.cur input, .search-day span.cur em {
        color: #666;
    }
    
    .search-day span.last-span:last-child {
        padding: 0;
    }
    
    .search-day span input {
        border: 0 none;
        height: 26px;
        padding: 0 10px;
        width: 180px;
        background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAHBAMAAADOnLEXAAAAA3NCSVQICAjb4U/gAAAAElBMVEX////v7++oqKiSkpJgYGAzMzNVUvUKAAAABnRSTlMA//////96eeD+AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAFnRFWHRDcmVhdGlvbiBUaW1lADA3LzEzLzE442/mwwAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAApSURBVAiZYxBiAAJFBhEDBgZmRwbmYAYGUwMQBrGAXBAHyAVxgFwgBwBYpgOoNMjLNgAAAABJRU5ErkJggg==");
        background-repeat: no-repeat;
        background-position: 160px center;
    }
    
    .search-day span input:active {
        border: 0 none;
    }
    
    .search-day span.cur input {
        color: #fff;
        background-color: #20a53a;
        background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAHBAMAAADOnLEXAAAAA3NCSVQICAjb4U/gAAAAElBMVEX////f8+Pg8+Sx2LghpTsgpTp3yIRgAAAACXBIWXMAAA6cAAAOnAEHlFPdAAAAFnRFWHRDcmVhdGlvbiBUaW1lADA3LzEzLzE442/mwwAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAxSURBVAiZY1B2DQ0NNWJQMA0NDWZkCGYODTUwZQBiIIshNJjZwBRIhRoAhYFUMFARAPlECn96zZKZAAAAAElFTkSuQmCC");
    }
    .total_num_len{
        background-color: #FAFAFA;
        border: #ddd 1px solid;
        width: 100%;
        font-size:0;
        color:#78797D;
    }
    .total_num_len .total_num_box{
        width: 14.2%;
        display: inline-block;
        font-size: 12px;
        padding: 15px 0 15px 15px;
        vertical-align: top;
    }
    .total_num_len .total_num_box .tn_num{
        font-size:20px;
        margin-top: 7px;
        color:#333;
    }
    .total_num_len .total_num_box .tn_compare {
        margin-top: 5px;
        font-size: 13px;
    }
    .tn_compare.compare_hide{
        display: none;
    }
    .search-day.bt-disabled,
    .time_contrast.bt-disabled span{
        opacity: .65;
        box-shadow: none;
        color: #777;
        background-color: #ffffff;
        cursor: no-drop !important;
    }
    /* 概览 */
    #md_table .total_tips,
    #zz_table .total_tips,
    .total_num_len .total_tips {
        border: 1px solid #cbcbcb;
        border-radius: 8px;
        color: #cbcbcb;
        cursor: pointer;
        display: inline-block;
        font-family: arial;
        font-size: 12px;
        font-style: normal;
        height: 14px;
        line-height: 14px;
        margin-left: 5px;
        text-align: center;
        width: 14px;
    }
    .traffic-unit{
        position: absolute;
        top: 33px;
        z-index: 999;
        line-height: 22px;
    }
    .traffic-unit .tu-name{
        width: 56px;
        display: inline-block;
        color: #787a7d;
        text-align: right;
    }
    .traffic-unit-content{
        display: inline-block;
        position: relative;
        border: 1px solid #ccc;
        border-radius: 2px;
        font-size: 12px;
        vertical-align: middle;
        margin-left: 10px;
    }
    .traffic-unit .tu-box{
        height: 20px;
        line-height: 20px;
        border: none;
        outline: none;
    }
    .traffic-unit .tu-box:hover {
        background: #ebf1f5;
        cursor: pointer;
    }
    .traffic-unit .tu-box .tu-text{
        margin-right: 25px;
        padding-left: 10px;
    }
    .traffic-unit .tu-box .down-select-full{
        width: 0;
        height: 0;
        border-width: 5px;
        border-style: solid;
        border-color: #777 transparent transparent transparent;
        position: absolute;
        top: 8px;
        right: 8px;
    }
    .traffic-unit .tu-list{
        transition: all 500ms;
        background: #fff;
        position: absolute;
        top: 24px;
        display: none;
        box-shadow: 0 1px 5px rgb(0 0 0 / 20%);
        border-radius: 4px;
        z-index: 9999;
    }
    .tu-list li {
        padding: 0 23px 0 10px;
        height: 30px;
        line-height: 30px;
        cursor: pointer;
    }
    .tu-list li:hover,
    .tu-list li.active{
        background-color: #20a53a;
        color: #fff;
    }
    /* 网站列表 */
    #site_table .bt_table_select_group .bt_selects{
        top: -87px;
    }
    #site_table .btswitch+.btswitch-btn{
        width: 2.4em;
        height: 1.4em;
    }
    /* 分页样式 */
    .site_monitoring_statistics .page span,
    .site_monitoring_statistics .page a{
        font-size: 12px;
    }
    
    /* 指标 */
    .indicators{
        margin-top: 15px;
        position: relative;
    }
    .indicators-container{
        padding: 5px;
    }
    .indicators-container>span{
        color:#787a7d;
        margin-right: 10px;
    }
    .indicators-label {
        display: inline-block;
        width: 100px;
        height: 26px;
        line-height: 26px;
        cursor: pointer;
    }
    .indicators-label input {
        height: 13px;
        margin: 0 5px 0 0;
        vertical-align: -2px;
    }
    /* zhizhu、客户端通用 */
    .lr_echart_container .total_left_box,
    .lr_echart_container .total_right_box{
        display: inline-block;
        position: relative;
    }
    /* zhizhu */
    .zz_left_container .total_left_box{
        width: 150px;
        display: inline-block;
        text-align: center;
        background-color: #FAFAFA;
        border: #ddd 1px solid;
        color: #78797D;
        vertical-align: top;
    }
    .zz_left_container .total_left_box .total_num_box{
        padding: 20px 0;
    }
    .zz_left_container .total_left_box .tn_num{
        font-size: 20px;
        margin-top: 7px;
        color: #333;
    }
    .zz_left_container .total_right_box .time_contrast{
        position: absolute;
        margin-top: 0;
        left: 270px;
        top: 250px;
    }
    /* 客户端 */
    .total_right_box .time_contrast{
        position: absolute;
        left: 180px;
        top: 250px;
    }
    
    /* 网站日志 */
    .mt_select {
        width: 90px;
        display: inline-block;
        height: 28px;
        line-height: 28px;
        padding: 0 10px;
        border: 1px solid #ddd;
        position: relative;
        vertical-align: top;
        cursor: pointer;
        margin-right: 10px;
        color: #333;
    }
    .mt_select .glyphicon-triangle-bottom {
        position: absolute;
        right: 5px;
        top: 50%;
        margin-top: -6px;
    }
    .mt_select_list {
        transition: all 500ms;
        background: #fff;
        position: absolute;
        top: 30px;
        left: 0;
        display: none;
        box-shadow: 0 1px 5px rgb(0 0 0 / 50%);
        border-radius: 1px;
        width: 100%;
        z-index: 999;
        background-color: #fff;
        max-height: 200px;
        overflow: auto;
    }
    .mt_select_list li {
        height: 28px;
        line-height: 28px;
        padding: 0 10px;
        white-space: nowrap;
    }
    .mt_select_list li:hover {
        background-color: #F5F7FA;
    }
    .mt_select_list li.active,
    .mt_select_list li.active input{
        color: #fff;
        background-color: #20a53a;
    }
    .mt_search{
        display: inline-block;
    }
    .mt_search input{
        border-color:#ddd;
        vertical-align: top;
        margin-right:10px;
        width:250px;
        padding-left: 5px;
    }
    /* 迁移 */
    .migrateDiv{
        padding: 10px 15px 20px;
        font-size: 14px;
        word-break: break-all;
    }
    .migrateName{
        margin-bottom: 15px;
    }
    .migrateDiv span {
        margin-left: 20px;
        display: block;
        font-weight: 600;
    }
    .migrateDiv div{
        text-align: center;
        margin-top: 10px;
        margin-bottom: 10px;
    }
    .overflow_hide {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        display: inline-block;
        vertical-align: middle;
    }
    /*网站日志*/
    .overflow_hide.sitelog_uri{
        width: 184px;
    }
    .overflow_hide.sitelog_domain{
        width: 110px;
    }
    .overflow_hide.sitelog_ip{
        width: 100px;
    }
    .set_site_config .tab-con{
        padding:0;
    }
    .site_table span.t_website_status{
        vertical-align:middle;
    }
    .tab-con .site-setting-item{
        display: none;
    }
    .tab-con .site-setting-item span.tips{
        color:#777;
        margin: 10px 0;
        display: block;
    }
    .tab-con .site-setting-item.active{
        display: block;
    }
    .log_uri_box span:nth-child(2){
        float:right;
    }
    .log_uri_box i{
        width: 4px;
        height: 4px;
        background-color: #ccc;
        border-radius: 50%;
        position: absolute;
        left: -8px;
        top: 6px;
    }
    /* 排序样式 */
    .site_monitoring_statistics .bt_table thead .sort-active span{
        font-weight: 600;
    }
    
    .overflow_hide.detail_ip{
        max-width: 110px;
    }
    /* 设置页 */
    .setting_container input{padding-left: 7px;}
    .setting_container textarea{
        border-color: #ddd;
        display: block;
        margin-top: 3px;
        font-size: 13px;
    }
    .setting-exclude-url input,
    .setting-exclude-url select{
        height: inherit;
    }
    .setting_container .setting_box {
        margin: 15px 0;
    }
    .setting_container .setting_box:last-of-type{
        margin-bottom: 0;
    }
    .setting_container .setting_left_title {
        display: inline-block;
        width: 100px;
        vertical-align: top;
        margin: 6px 15px 0 0;
    }
    .setting_container .setting_rigth_content {
        display: inline-block;
    }
    .setting_container .setting_rigth_content .item-line{
        display: block;
        padding-bottom: 10px;
    }
    .setting_container .line_border{
        margin-top: 15px;
        padding-top: 15px;
        border-top: #ccc 1px dashed;
    }
    .setting_refresh_site {
        display: inline-block;
        margin-left: 20px;
    }
    .setting_switch_title {
        width: 110px;
    }
    .setting_rigth_content div{
        display: inline-block;
    }
    .setting_rigth_content .tab-nav,
    .setting_rigth_content .tab-con div{
        display: block;
    }
    .setting_rigth_content .tab-con{
        padding: 0;
        margin-top: 10px;
        width: 100%;
    }
    .setting_rigth_content .tab-con .tips{
        margin:0
    }
    .setting_footer{
        margin-left: 100px;
    }
    .set_rodio_switch label::after {
        box-shadow: 0 0 0 1px rgb(0 0 0 / 10%), 0 2px 0 rgb(0 0 0 / 8%) !important;
    }
    .set_rodio_switch label.btswitch-btn {
        margin: 0;
        width: 35px;
        height: 20px;
    }
    .setting_rigth_content .set_rodio_switch span{
        vertical-align: middle;
        display: inline-block;
    }
    .setting_rigth_content .set_rodio_switch {
        vertical-align: middle;
    }
    .setting_rigth_content .tips {
        color: #777;
        margin-left: 20px;
        vertical-align: middle;
    }
    .config_info_table .tips{
        color:#777
    }
    .site_log_export_view .mtcheckbox,
    .set_site_config .mtcheckbox,
    .site_monitoring_statistics .mtcheckbox{
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 1px solid #ccc;
        background-color: #fff;
        vertical-align: top;
        border-radius: 1px;
        position: relative;
        border-radius: 2px;
        cursor: pointer;
    }
    .site_log_export_view .mtcheckbox.active,
    .set_site_config .mtcheckbox.active,
    .site_monitoring_statistics .mtcheckbox.active{
        background-color: #20a53a;
        border-color: #20a53a;
    }
    .site_log_export_view .mtcheckbox.active::after,
    .set_site_config .mtcheckbox.active::after,
    .site_monitoring_statistics .mtcheckbox.active::after {
        content: '';
        position: absolute;
        display: block;
        left: 50%;
        top: 50%;
        margin-left: -2.5px;
        margin-top: -6px;
        width: 5px;
        height: 10px;
        border: solid #fff;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
    }
    .l_export_type {
        margin: 20px 5px 0 5px;
    }
    .site_log_export .l_export_radio{
        font-size: 14px;
        width: 110px;
        margin-bottom: 10px;
        cursor: pointer;
        display: inline-block;
    }
    .l_export_radio .mtcheckbox {
        margin-right: 5px;
    }
    
    /* 日志详情 */
    .lib-con {
        margin-bottom: 10px;
        width: 100%;
    }
    .divpre {
        padding: 9.5px;
        margin: 0 0 10px;
        font-size: 13px;
        line-height: 1.42857143;
        color: #333;
        word-break: break-all;
        word-wrap: break-word;
        background-color: #f6f6f6;
        border: 1px solid #ddd;
        border-radius: 4px;
        max-height: 100px;
        overflow: auto;
    }
    /* 流量占比 */
    .uri_echart_box {
        height: 25px;
    }
    .fr_bg_color{
        background-color: #ff7e0e;
        box-sizing: border-box;
        height: 25px;
        display: inline-block;
        vertical-align: bottom;
    }
		.sp_bg_color{
        background-color: #4885ff;
        box-sizing: border-box;
        height: 25px;
        display: inline-block;
        vertical-align: bottom;
    }
    .fr_bg_color,.sp_bg_color{
        position: absolute;
    }
    .access_total_table.valid tbody tr td:last-child{
        padding:2px 8px;
    }
    #error_log_table thead th:nth-child(8), #error_log_table tbody tr td:nth-child(8),
    #sitelog_table thead th:nth-child(8), #sitelog_table tbody tr td:nth-child(8){
        padding-left: 0;
    }
    /* 流量占比 end */
    /* 页码跳转样式 */
    .page .page_jump_box span{
        border:none;
    }
    .page .page_jump_btn{
        height: 28px;
        line-height: 25px;
        border-radius: 0;
        outline: none;
        border-radius: 2px;
        color: #555;
        background-color: #fff;
        border: 1px solid #ccc;
    }
    .page .page_jump_btn:hover {
        color: #fff;
        background-color: #20a53a;
        border-color: #20a53a;
    }
    /* 页码跳转样式 end*/
    
    
    /* 统计报告轮播图 */
    .total_report_content .swiper {
        width: 900px;
        height: 515px;
        margin: 15px auto;
        position: relative;
    }
    
    .total_report_content .swiper .pic {
        width: 100%;
        height: 100%;
        position: relative;
    }
    
    .total_report_content .swiper .pic li {
        -webkit-transition: all 0.8s;
        -moz-transition: all 0.8s;
        -o-transition: all 0.8s;
        -ms-transition: all 0.8s;
        transition: all 0.8s;
        width: 260px;
        height: 355px;
        position: absolute;
        top: 40px;
        left: 52%;
        margin-left: -147px;
        border-radius: 6px;
        overflow: hidden;
        box-shadow: 2px 2px 6px 1px rgba(0, 0, 0, 0.5);
        text-align: center;
    }
    .total_report_content .swiper .pic li span{
        position: absolute;
        top: 45%;
        left: 0;
        right: 0;
        font-size: 18px;
        color: #fff;
    }
    .total_report_content .swiper .pic li.Cweek {
        background: linear-gradient(180deg,#00d9b1,#3977c6);}
    .total_report_content .swiper .pic li.Cmonth {
        background: linear-gradient(180deg,#EF948A,#8b6c93);
    }
    
    .total_report_content .swiper .now {
        z-index: 999;
        -webkit-transform: scale(1.2);
        -moz-transform: scale(1.2);
        -o-transform: scale(1.2);
        -ms-transform: scale(1.2);
        transform: scale(1.2);
        cursor: pointer;
    }
    .total_report_content .swiper .now::after{
        content: "点击预览";
        position: absolute;
        bottom: 20px;
        left: 32%;
        right: 0;
        color: #fff;
        width: 90px;
        font-size: 14px;
    }
    .total_report_content .swiper .next {
        z-index: 6;
        -webkit-transform: translateX(300px);
        -moz-transform: translateX(300px);
        -o-transform: translateX(300px);
        -ms-transform: translateX(300px);
        transform: translateX(300px);
    }
    
    .total_report_content .swiper .prev {
        z-index: 6;
        -webkit-transform: translateX(-300px);
        -moz-transform: translateX(-300px);
        -o-transform: translateX(-300px);
        -ms-transform: translateX(-300px);
        transform: translateX(-300px);
    }
    
    .total_report_content .swiper ._bg {
        background-color: #007aff !important;
    }
    
    .total_report_content .swiper .cricle {
        height: 16px;
        position: absolute;
        bottom: 45px;
        left: 50%;
        -webkit-transform: translateX(-50%);
        -moz-transform: translateX(-50%);
        -o-transform: translateX(-50%);
        -ms-transform: translateX(-50%);
        transform: translateX(-50%);
    }
    
    .total_report_content .swiper .cricle li {
        float: left;
        width: 10px;
        height: 10px;
        background-color: #cccccc;
        margin-right: 6px;
        border-radius: 50%;
        box-shadow: 1px 1px 4px rgba(0, 0, 0, 0.5);
        cursor: pointer;
    }
    
    .total_report_content .swiper .btns {
        display: none;
        position: absolute;
        left: 0;
        top: 44%;
        -webkit-transform: translateY(-50%);
        -moz-transform: translateY(-50%);
        -o-transform: translateY(-50%);
        -ms-transform: translateY(-50%);
        transform: translateY(-50%);
        width: 100%;
        height: 38px;
        z-index: 99;
    }
    
    .total_report_content .swiper .btns .leftbtn,
    .total_report_content .swiper .btns .rightbtn {
        height: 100%;
        width: 38px;
        border-radius: 50%;
        background-color: rgba(0, 0, 0, 0.5);
    }
    
    
    .total_report_content .swiper .btns .leftbtn::after,
    .total_report_content .swiper .btns .rightbtn::after {
        content: "";
        display: block;
        width: 17px;
        height: 17px;
        border-left: 3px solid #ffffff;
        border-top: 3px solid #ffffff;
        cursor: pointer;
    }
    
    .total_report_content .swiper .btns .leftbtn::after {
        -webkit-transform: translate(12px, 11px) rotate(-45deg);
        -moz-transform: translate(12px, 11px) rotate(-45deg);
        -o-transform: translate(12px, 11px) rotate(-45deg);
        -ms-transform: translate(12px, 11px) rotate(-45deg);
        transform: translate(12px, 11px) rotate(-45deg);
    }
    
    .total_report_content .swiper .btns .rightbtn::after {
        -webkit-transform: translate(8px, 11px) rotate(135deg);
        -moz-transform: translate(8px, 11px) rotate(135deg);
        -o-transform: translate(8px, 11px) rotate(135deg);
        -ms-transform: translate(8px, 11px) rotate(135deg);
        transform: translate(8px, 11px) rotate(135deg);
    }
    
    .total_report_content .swiper .leftBox,
    .total_report_content .swiper .rightBox {
        height: 355px;
        position: absolute;
        top: 40px;
        z-index: 99;
    }
    
    .total_report_content .swiper .leftBox {
        width: 260px;
        left: 21px;
    }
    
    .total_report_content .swiper .rightBox {
        width: 260px;
        right: 19px;
    }
    /* 统计报告轮播图 end */
    /* 高级搜索 */
    .complete_search_view .tname{
        width: 93px;
        padding-right: 5px;
    }
    .complete_search_view{
        position: absolute;
        background: #fff;
        z-index: 999;
        width: 486px;
        box-shadow: 0 0 5px 2px #ececec;
        border:1px solid #ddd;
        top: 94px;
        right:12px;
        padding: 15px 10px 5px 10px;
    }
    .complete_search_view input{ width:248px}
    .complete_search_view:before,.complete_search_view:after{
        position: absolute;
        content: '';
        top: -12px;
        right: 37px;
        border-top: 6px transparent dashed;
        border-left: 6px transparent dashed;
        border-right: 6px transparent dashed;
        border-bottom: 6px #fff solid;
    }
    .complete_search_view:before{
        border-bottom: 6px #ddd  solid;
    }
    .complete_search_view:after{
        top: -11px; /*覆盖并错开1px*/
    }
    /* 高级搜索 end */
    /* ip/uri统计 */
    .total_num_submit{
        height: 28px;
        line-height: 25px;
        color: #555;
        background-color: #fff;
        border: 1px solid #ccc;
    }
    .total_num_submit:hover {
        color: #fff;
        background-color: #20a53a;
        border-color: #20a53a;
    }
    .site_monitoring_statistics .open_service,
    .site_ip_layer .open_service{
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAApNJREFUWEfFl81rE1EUxc9tqhVRi9SuRDINRXEpgjRTK/4DfoIVZmIFF4qCLly4UCkVFRcuughURESqSbUVROtaBGteuqkuBZF0RpetiEXFismVN5mMMWYyM8mUmWVy7jk/3tx35z2Czydxe2cnr+vYXwIOEJAAsAlAl13+GcAiA4U24Bl9W54unJr76seavETx+33bKdZ2FoAGoNNLb/8vwye4WEqbQ7PvGtU0BOjJqNeYIMM3+AyulS0RIz2fEpfd6l0BlGz/FMBHmgyuKaPHhp4brOdVF0DJqvMAlHDCHRfD0EVPred/APGsukDlBgv9YWDR1EV3tfE/AEpGfQXCQOjJ1YaMGSMl9lR+cgDshru0ouG2OTGuVxrTArC32mwL3R6Ue4mLpT65RS0AJauOATgd1MVbT88BngMwUkd7y9DFGdp2t3/98ho2AWz0NgygIDw0NKH1Tg10//5VfAqCWlP9peMnxSmeSR4ioicBrD2lDDwwdTFUXl33ecLMh0nJqo8AHPV09S+4Z+jihFe4bTcpAd4A2OHf313JhDumJk76DJeytxLgI4AtIQBYTRUgXEo/SYDvANbWAyDGGJO1OslGgMxImylxLmC4lP9wB2CI9tWxgx8GZxaUieRLMO2tD8Gjhp4/30S4A+D6CpiRMVPimGVeB4KZb5qp/IUmw51X0LAJmZA2NXt5qyGIbhha7mIL4U4Tem5DBl819fzw5vFdXati7S+YaNrUc8MthsvyySCDaMTQxZXE+O6theOv34cQDmsQBRzFFkQY4QDKo7hsFuRjxKNAWy/A+1qcHeWPkTSJ/HMsISI9kFSWMtIjWQUi0kOpsxJRHsv/QkR4MalARHo1c3oiystp9aBZqev5H7bmQ3TKQD4JAAAAAElFTkSuQmCC');
        width: 16px;
        height: 16px;
        background-size: 100%;
        background-repeat: no-repeat;
        display: inline-block;
        vertical-align: sub;
    }
    /* ip/uri统计 end */
    .text_dec{
        text-decoration: line-through;
    }
    button[name=site_log],button[name=error_log]{
        position: absolute;
        right: 15px;
    }
    .search-type{
        position: absolute;
        right: 5px;
    }
    .search-type-title{
        position: relative;
        right: -10px;
    }
    /* 匹配输入框 */
    .bt-matching-input {
        display: inline-flex;
        width: 248px;
    }
    .bt-matching-input select {
        width: 50px;
        margin-right: 10px;
    }
    .bt-matching-input input {
        flex: 1;
        width: auto;
        margin-right: 0;
    }
    /* end */
    /* uri独立统计 */
    .access_total_table .tab-con {
        padding: 0;
    }
    .alone_stat--block{
        cursor:pointer;
    }
    .alone_stat_tips{
        position: fixed;
        width: 400px;
        box-shadow: 0 0 5px 2px #ececec;
        border: 1px solid #ddd;
        background-color: #fff;
        z-index: 999;
        padding:20px;
    }
    .alone_stat_tips .ft-transform{
        transform: scale(0.9,0.9);
        display: inline-block;
        padding-bottom: 2px;
        font-size: 12px;
        white-space: pre;/*   不换行 */
    }
    .alone_stat_tips--header{
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
    }
    .alone_stat_tips--header--div{
        width:80px;
        text-align: center;
        border: 1px solid #DCDFE6;
        padding: 8px 0;
        border-radius: 2px;
    }
    .alone_stat_tips--header--title {
        font-size: 0px;
    }
    .alone_stat_tips--header--div:last-child{
        margin-right: 0;
    }
    .alone_stat_tips--header--num{
        color:#333;
    }
    .alone_stat_tips--content{
        border: 1px solid #DCDFE6;
        border-radius: 2px;
        color:#666;
    }
    .alone_stat_tips--header--div i{
        background-image: url(/total/static/alone_uri/apparatus.png);
        display: inline-block;
        width: 16px;
        height: 16px;
        vertical-align: -2px;
    }
    .alone_stat_tips--header--div.ms-tips-android i{
        background-position: 0 0;
    }
    .alone_stat_tips--header--div.ms-tips-iphone i{
        background-position: 0 77px;
    }
    .alone_stat_tips--header--div.ms-tips-linux i{
        background-position: 0 56px;
    }
    .alone_stat_tips--header--div.ms-tips-mac i{
        background-position: 0 16px;
    }
    .alone_stat_tips--header--div.ms-tips-windows i{
        background-position: 0 35px;
    }

    .alone_stat_tips--content--item{
        display: inline-block;
        width: 16.66%;
        height: 56px;
        padding-top: 12px;
        text-align: center;
    }
    .alone_stat_tips--content--line{
        border-bottom: 1px solid #DCDFE6;
    }
    .alone_stat_tips_radius{
        position: absolute;
        content: '';
        top: 115px;
        right: -12px;
        border-top: 6px transparent dashed;
        border-left: 6px #fff dashed;
        border-right: 6px transparent dashed;
        border-bottom: 6px transparent solid;
    }
    /* uri独立统计 end */
    
    /*问卷调查样式*/
	.waf_qa_box{
	    width:100px;
        cursor: pointer;
        display: inherit;
        -webkit-animation: bounce-down 2s linear infinite;
        animation: bounce-down 2s linear infinite;
        position: absolute;
        bottom: 8px;
	}
	.waf_qa_box:hover{animation-play-state:paused;}
	.waf_qa_box .qa_close_btn{
	    position: absolute;
	    background:url('/total/static/feedback/QA_close.png');
	    left: 90px;
	    bottom: 112px;
	    width: 13px;
        height: 13px;
	}
	.waf_qa_logo{
	    width:100px;
	    position: absolute;
        bottom: 15px;
        left: 4px;
	}
	@-webkit-keyframes bounce-down {
       25% {
            -webkit-transform: translateY(-4px);
       }
       50%, 100% {
            -webkit-transform: translateY(0);
       }
       75% {
            -webkit-transform: translateY(4px);
       }
    }
     
    @keyframes bounce-down {
        25% {
             transform: translateY(-4px);
        }
        50%, 100% {
             transform: translateY(0);
        }
        75% {
             transform: translateY(4px);
        }
    }
	/*问卷调查样式 end*/
    </style>
    
    <div class="bt-table site_monitoring_statistics" id="site_monitoring_statistics">
        <div class="bt-w-main">
            <!--菜单部分-->
            <div class="bt-w-menu">
                <p class="bgw" data-funname="overview">概览</p>
                <p data-funname="site_list">网站列表</p>
                <p data-funname="zhizhu_total">蜘蛛统计</p>
                <p data-funname="client_total">客户端统计</p>
                <p data-funname="ip_total">IP统计</p>
                <p data-funname="uri_total">URI统计</p>
                <!-- <p data-funname="uri_alone_stat">URI独立统计</p> -->
                <p data-funname="referer_stat">来源统计</p>
                <p data-funname="error_log">错误日志</p>
                <p data-funname="site_log">网站日志</p>
                <p data-funname="total_report">统计报告</p>
                <p data-funname="setting">全局设置</p>
            </div>
            <!--内容部分-->
            <div class="bt-w-con pd15">
                <div class="plugin_body">
                    <div class="conter_box"></div>
                </div>
            </div>
            <span class="waf_qa_box hide">
                <img src="/total/static/feedback/QA_logo.png" class="waf_qa_logo" onclick="open_waf_qa_view()">
                <i class="qa_close_btn" onclick="close_qa_dialog()"></i>
            </span>
        </div>
    </div>
    <script type="text/html" id="template_html">
        <div class="total_head">
            网站：<div class="mt_select siteSelected" bt-event-click="selectSwitch">
                    <span class="mt_select_value">
                        <span class="mt_select_content"><% this.site_name %></span>
                        <span class="glyphicon glyphicon-triangle-bottom ml5"></span>
                    </span>
                    <ul class="mt_select_list" bt-event-click="siteSelected|li">
                        <% for(var item in this.site_list){%>
                            <% if(this.site_list.hasOwnProperty(item)){ %>
                                <li <% this.site_name == this.site_list[item]? 'class="active"':''%>><%this.site_list[item]%></li>
                            <%}%>
                        <%}%>
                    </ul>
                </div>
            <% if(this.menu_type == 'error_log'){%>
                状态码：<div class="mt_select error_code_type" bt-event-click="selectSwitch" style="width: 70px;">
                    <span class="mt_select_value">
                        <span class="mt_select_content"><% this.default_error_type == 'all'?'所有':this.default_error_type%></span>
                        <span class="glyphicon glyphicon-triangle-bottom ml5"></span>
                    </span>
                    <ul class="mt_select_list" bt-event-click="siteErrorCodeType|li" style="max-height: inherit;">
                        <% for(var item in this.error_type_list){%>
                            <% if(this.error_type_list.hasOwnProperty(item)){ %>
                                <li name="code" <% this.error_type_list[item] == this.default_error_type?'class="active"':''%>><% this.error_type_list[item] == 'all'?'所有':this.error_type_list[item]%></li>
                            <%}%>
                        <%}%>
                        <li style="padding: 0;text-align: center;"><input type="text" name="code_custom" value="<% $.inArray(this.default_error_type,this.error_type_list) == -1?this.default_error_type:''%>" style="width: 68px;padding-left: 10px;border: none;" placeholder="自定义" autocomplete="off"></li>
                    </ul>
                </div>
            <%}%>
            时间：
            <div class="search-day" bt-event-click="TimeChoose|span">
                <% for(var ke in this.time_cycle){%>
                    <span data-name="<% ke %>" <% ke == this.query_text?'class="cur"':''%>><% this.time_cycle[ke]%></span>
                <%}%>
                <span class="last-span">
                    <input id="time_choose" autocomplete="off" placeholder="自定义时间" type="text" value="" lay-key="100001" <% this.menu_type == 'error_log' ? 'style="width: 240px; padding-right: 30px; background-position: 220px center;"':''%>> 
                </span>
            </div>
            <!-- <% if(this.menu_type == 'overview' && !this.return_data.autorefesh){%>
            <button type="button" class="btn btn-default btn-sm pull-right" bt-event-click="manuallyRefresh"><span><i class="glyphicon glyphicon-repeat"></i> 刷新</span></button> 
            <%}%> -->
            <% if(this.menu_type == 'site_log' || this.menu_type == 'error_log'){%>
                <button type="button" class="btn btn-default btn-sm" name="<%this.menu_type%>" bt-event-click="siteLogExport">导出</button>
            <%}%>
            <% if(this.menu_type == 'overview'){%>
                时段：
                <div class="search-day" bt-event-click="switchingPeriod|span">
                    <span <% this.period_time == 'hour'?'class="cur"':'' %> data-name="hour">按时</span>
                    <span <% this.period_time == 'day'?'class="cur"':'' %> data-name="day">按天</span>
                </div>
                <div class="search-day search-type" bt-event-click="switchingChartList|span">
                    <span <% this.chart_list == 'chart'?'class="cur"':'' %> data-name="chart">图表</span>
                    <span <% this.chart_list == 'list'?'class="cur"':'' %> data-name="list">列表</span>
                </div>
            <%}%>
        </div>
        <% if(this.menu_type == 'overview'){%>
            <% if(this.chart_list == 'chart'){%>
            <div class="total_num_len">
                <div class="total_num_box">
                    <p class="tn_title">浏览量(PV)<i class="total_tips">?</i></p>
                    <p class="tn_num"><% this.return_data.sum_data.pv %></p>
                    <p class="tn_compare compare_hide"></p>
                </div>
                <div class="total_num_box">
                    <p class="tn_title">访客量(UV)<i class="total_tips">?</i></p>
                    <p class="tn_num"><% this.return_data.sum_data.uv %></p>
                    <p class="tn_compare compare_hide"></p>
                </div>
                <div class="total_num_box">
                    <p class="tn_title">IP数<i class="total_tips">?</i></p>
                    <p class="tn_num"><% this.return_data.sum_data.ip %></p>
                    <p class="tn_compare compare_hide"></p>
                </div>
                <div class="total_num_box">
                    <p class="tn_title">流量<i class="total_tips">?</i></p>
                    <p class="tn_num"><% ToSize(this.return_data.sum_data.length) %></p>
                    <p class="tn_compare compare_hide"></p>
                </div>
                <div class="total_num_box">
                    <p class="tn_title">请求<i class="total_tips">?</i></p>
                    <p class="tn_num"><% this.return_data.sum_data.req%></p>
                    <p class="tn_compare compare_hide"></p>
                </div>
                <div class="total_num_box">
                    <p class="tn_title">实时流量<i class="total_tips">?</i></p>
                    <p class="tn_num"><% ToSize(this.return_data.realtime_traffic) %></p>
                </div>
                <div class="total_num_box">
                    <p class="tn_title">每秒请求<i class="total_tips">?</i></p>
                    <p class="tn_num"><% this.return_data.realtime_request %></p>
                </div>
            </div>
                <div class="indicators">
                    <div class="indicators-container">
                        <span>趋势指标: </span>
                        <% for(var lab in this.ov_indicators_label){%>
                            <% if(this.ov_indicators_label.hasOwnProperty(lab)){ %>
                                <div class="indicators-label" bt-event-click="indicatorsType" data-name="<% lab %>">
                                    <input type="radio" id="check_<%lab%>" name="check_<%lab%>" <% lab == this.ov_trend_type ?'checked':'' %>>
                                    <span class="check_<%lab%>" style="font-weight:normal"><% this.ov_indicators_label[lab] %></span>
                                </div>
                            <%}%>
                        <%}%>
                    </div>
                    <div class="traffic-unit"></div>
                </div>
        
                <div class="total_num_echart" id="total_num_echart" style="height:330px;z-index:99"></div>
                <div class="time_contrast" bt-event-click="contrastDay|span">对比: 
                    <span class="checked_time active" name="yesterday"><i></i>前一天</span>
                    <span class="checked_time" name="topweek"><i></i>上周同期</span>
                </div>
                <ul class="help-info-text c7 ptb15 mlr20">
                    <li>趋势指标：网站数据在每个时间段内的总汇。【实时流量/每秒请求 不支持时间比对以及日期选择】</li>
                </ul>
            <%}else{%>
                <div class="md_table bt_table" id="overview_table"></div>
            <%}%>
        <%}%>
        <% if(this.menu_type == 'zhizhu_total'){ %>
            <div class="lr_echart_container zz_left_container">
                <div class="total_left_box">
                    <div class="total_num_box">
                        <p class="tn_title">总蜘蛛</p>
                        <p class="tn_num"><% this.return_data.sum_data.spider_total %></p>
                    </div>
                    <div class="total_num_box">
                        <p class="tn_title">假蜘蛛</p>
                        <p class="tn_num"><% this.return_data.sum_data.fake_spider %></p>
                    </div>
                    <div class="total_num_box">
                        <p class="tn_title">总请求</p>
                        <p class="tn_num"><% this.return_data.sum_data.total_req %></p>
                    </div>
                </div>
                <div class='total_right_box'>
                    <div id="zz_echart" style="height:280px; width:730px;"></div>
                    <div class="time_contrast" bt-event-click="contrastDay|span">对比: 
                        <span class="checked_time" name="yesterday"><i></i>前一天</span>
                        <span class="checked_time" name="topweek"><i></i>上周同期</span>
                    </div>
                </div>
            </div>
            <div class="zz_table" id="zz_table"></div>
        <%}%>
        <% if(this.menu_type == 'client_total'){ %>
            <div class="lr_echart_container">
                <div class="total_left_box">
                    <div id="md_total_echart" style="height:280px; width:350px;"></div>
                </div>
                <div class='total_right_box'>
                    <div id="md_echart" style="height:280px; width:535px;"></div>
                    <div class="time_contrast" bt-event-click="contrastDay|span">对比: 
                        <span class="checked_time" name="yesterday"><i></i>前一天</span>
                        <span class="checked_time" name="topweek"><i></i>上周同期</span>
                    </div>
                </div>
            </div>
            <div class="md_table" id="md_table"></div>
        <%}%>
        <% if(this.menu_type == 'site_log'){ %>
            <div style="line-height: 28px;">
                请求类型：
                    <div class="mt_select req_type" bt-event-click="selectSwitch">
                        <span class="mt_select_value">
                            <span class="mt_select_content"><% this.request_type_list[this.req_type] %></span>
                            <span class="glyphicon glyphicon-triangle-bottom ml5"></span>
                        </span>
                        <ul class="mt_select_list" bt-event-click="siteReqorCode|li">
                            <% for(var item in this.request_type_list){%>
                                <% if(this.request_type_list.hasOwnProperty(item)){ %>
                                    <li name="req_type" <% item == this.req_type?'class="active"':''%>><% this.request_type_list[item] %></li>
                                <%}%>
                            <%}%>
                        </ul>
                    </div>
                状态码：
                    <div class="mt_select code_type" bt-event-click="selectSwitch" style="width: 70px;">
                        <span class="mt_select_value">
                            <span class="mt_select_content"><% this.code_type == 'all'?'所有':this.code_type%></span>
                            <span class="glyphicon glyphicon-triangle-bottom ml5"></span>
                        </span>
                        <ul class="mt_select_list" bt-event-click="siteReqorCode|li" style="max-height: none;">
                            <% for(var item in this.code_type_list){%>
                                <% if(this.code_type_list.hasOwnProperty(item)){ %>
                                    <li name="code_type" <% this.code_type_list[item] == this.code_type?'class="active"':''%>><% this.code_type_list[item] == 'all'?'所有': this.code_type_list[item]%></li>
                                <%}%>
                            <%}%>
                            <li name="code_type" style="padding: 0;text-align: center;"><input type="text" name="code_custom" value="<% ($.inArray(this.code_type,this.code_type_list) == -1 && this.code_type != 'all')?this.code_type:''%>" style="width: 68px;padding-left: 10px;border: none;" placeholder="自定义" autocomplete="off"></li>
                        </ul>
                    </div>
                蜘蛛过滤：
                    <div class="mt_select zhizhu_type" bt-event-click="selectSwitch">
                        <span class="mt_select_value">
                            <span class="mt_select_content"><% this.zhizhu_type == 'normal'?'不过滤':(this.zhizhu_type == 'only_spider'?'仅显示蜘蛛':(this.zhizhu_type == 'no_spider'?'不显示蜘蛛':(this.zhizhu_type == 'fake_spider'?'假蜘蛛':this.zhizhu_type_list[this.zhizhu_type])))%></span>
                            <span class="glyphicon glyphicon-triangle-bottom ml5"></span>
                        </span>
                        <ul class="mt_select_list" bt-event-click="siteReqorCode|li" style="max-height: none;">
                            <li name="zhizhu_type" data-type="normal" <% this.zhizhu_type == 'normal'?'class="active"':''%>>不过滤</li>
                            <li name="zhizhu_type" data-type="only_spider" <% this.zhizhu_type == 'only_spider'?'class="active"':''%>>仅显示蜘蛛</li>
                            <li name="zhizhu_type" data-type="no_spider" <% this.zhizhu_type == 'no_spider'?'class="active"':''%>>不显示蜘蛛</li>
                            <li name="zhizhu_type" data-type="fake_spider" <% this.zhizhu_type == 'fake_spider'?'class="active"':''%>>假蜘蛛</li>
                            <% for(var item in this.zhizhu_type_list){%>
                                <% if(this.zhizhu_type_list.hasOwnProperty(item)){ %>
                                    <li name="zhizhu_type" data-type="<%item%>" <% item == this.zhizhu_type?'class="active"':''%>><% this.zhizhu_type_list[item] %></li>
                                <%}%>
                            <%}%>
                        </ul>
                    </div>
                URL过滤：
                    <div class="mt_search">
                        <input type="text" class="mt_log_search_input" placeholder="支持逗号分割URL" name="search_search_url" value="<%this.filter_value.search_url%>" style="margin:0">
                        <button type="button" class="btn btn-default btn-sm mr10" style="padding: 4px 10px;" bt-event-click="siteLogSearch">搜索</button>
                        <div bt-event-click="siteLogCompleteSearch" style="display: inline-block;">
                            <a class="btlink modeFilter">高级搜索</a>
                            <div class="complete_search_view hide">
                                <div class="bt-form">
                                    <% for(var item in this.search_type_list){%>
                                        <% if(this.search_type_list.hasOwnProperty(item)){ %>
                                            <% if(this.search_type_list[item]['type'] === 'response_time') {%>
                                                <div class="line">
                                                    <span class="tname"><% this.search_type_list[item]['name'] %></span>
                                                    <div class="info-r">
                                                        <div class="bt-matching-input">
                                                            <select name="search_response_time_comparator">
                                                                <option>>=</option>
                                                                <option><=</option>
                                                                <option>=</option>
                                                            </select>
                                                            <input type="text" placeholder="请输入耗时" name="search_<% this.search_type_list[item]['type'] %>" />
                                                        </div>
                                                        <span style="color: #ccc;">毫秒(1秒=1000毫秒)</span>
                                                    </div>
                                                </div>
                                            <% } else if (this.search_type_list[item]['name']) { %>
                                                <div class="line">
                                                    <span class="tname"><% this.search_type_list[item]['name'] %></span>
                                                    <div class="info-r">
                                                        <input type="text" placeholder="<% this.search_type_list[item]['placeholder'] %>" name="search_<% this.search_type_list[item]['type'] %>" value="<% this.filter_value[this.search_type_list[item]['type']]%>" style="margin-right:0;">
                                                        <span style="color: #ccc;"><% this.search_type_list[item]['type'] == 'referer' ? 'None: 空来源' : '' %></span>
                                                    </div>
                                                </div>
                                            <%}else{%>
                                                <div class="line" style="padding: 0;">
                                                    <span class="tname"></span>
                                                    <div class="info-r">
                                                        <span style="cursor: pointer;" bt-event-click="searchCheckbox">
                                                            <span class="mtcheckbox mr5 search_<% this.search_type_list[item]['type'] %>" style="vertical-align: text-top;"></span>
                                                            <% this.search_type_list[item]['placeholder'] %>
                                                        </span>
                                                    </div>
                                                </div>
                                            <%}%>
                                        <%}%>
                                    <%}%>
                                    <div class="line">
                                        <span class="tname"></span>
                                        <div class="info-r" style="color: #ccc;">
                                            * 过滤的多个条件将合并起来进行搜索
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
            <div id="sitelog_table"></div>
        <%}%>
        <% if(this.menu_type == 'error_log'){%>
            <div id="error_log_table"></div>
        <%}%>
    </script>
    <script type="text/html" id="site_list">
        <div class="total_head">
            <div class="search-day" bt-event-click="TimeChoose|span">
                <% for(var ke in this.time_cycle){%>
                    <span data-name="<% ke %>" <% ke == this.query_text?'class="cur"':''%>><% this.time_cycle[ke]%></span>
                <%}%>
                <span class="last-span"><input id="time_choose" autocomplete="off" placeholder="自定义时间" type="text" value="" lay-key="100001"></span>
            </div>
        </div>
        <div class="total_num_len">
            <div class="total_num_box">
                <p class="tn_title">总浏览量(PV)</p>
                <p class="tn_num"><% this.return_data.sum_data.pv %></p>
            </div>
            <div class="total_num_box">
                <p class="tn_title">总访客量(UV)</p>
                <p class="tn_num"><% this.return_data.sum_data.uv %></p>
            </div>
            <div class="total_num_box">
                <p class="tn_title">总IP数</p>
                <p class="tn_num"><% this.return_data.sum_data.ip %></p>
            </div>
            <div class="total_num_box">
                <p class="tn_title">总流量</p>
                <p class="tn_num"><% ToSize(this.return_data.sum_data.length) %></p>
            </div>
            <div class="total_num_box">
                <p class="tn_title">总请求</p>
                <p class="tn_num"><% this.return_data.sum_data.req %></p>
            </div>
            <div class="total_num_box">
                <p class="tn_title">实时流量</p>
                <p class="tn_num"><% ToSize(this.return_data.sum_data.realtime_traffic) %></p>
            </div>
            <div class="total_num_box">
                <p class="tn_title">每秒请求</p>
                <p class="tn_num"><% this.return_data.sum_data.realtime_req %></p>
            </div>
        </div>
        <div class="site_table" id="site_table"></div>
    </script>
    <script type="text/html" id="setting_view">
        <div class="setting_container" style="height: 625px; overflow: auto;">
            <div class="setting_box">
                <div class="setting_left_title">监控统计:</div>
                <div class="setting_rigth_content">
                    <div class="item-line">
                        <div class="setting_switch_title">监控开关</div>
                        <div class="set_rodio_switch" style="margin-top: 3px;">
                            <span>
                                <input class="btswitch btswitch-ios" id="setMonitoringSwitch" type="checkbox" <% this.monitor ?'checked':''%>>
                                <label class="btswitch-btn setMonitoringSwitch" for="setMonitoringSwitch" bt-event-click="monitoringSwitch"></label>
                            </span>
                        </div>
                        <span class="tips">* 【关闭】后所有站点将停止统计数据</span>
                    </div>
                    <div class="item-line">
                        <div class="setting_switch_title">机器访问</div>
                        <div class="set_rodio_switch" style="margin-top: 3px;">
                            <span>
                                <input class="btswitch btswitch-ios" id="setMachineSwitch" type="checkbox" <% this.statistics_machine_access ?'checked':''%>>
                                <label class="btswitch-btn setMachineSwitch" for="setMachineSwitch" bt-event-click="machineSwitch"></label>
                            </span>
                        </div>
                        <span class="tips">* 【关闭】后不统计机器访问的PV、UV，请在客户端统计列表查看机器访问量</span>
                    </div>
                    <div class="item-line">
                        <div class="setting_switch_title">自动刷新</div>
                        <div class="set_rodio_switch">
                            <span>
                                <input class="btswitch btswitch-ios" id="setAutoRefresh" type="checkbox" <% this.autorefresh ?'checked':''%>>
                                <label class="btswitch-btn setAutoRefresh" for="setAutoRefresh" bt-event-click="submitSetting" name="autofresh" data-hanel="auto"></label>
                            </span>
                        </div>
                    </div>
                    <div class="item-line">
                        <div class="setting_switch_title">刷新间隔</div>
                        <input type="number" id="autofreshtime" style="width:55px;" value="<% this.refresh_interval%>"> /秒</span>
                        <button type="button" class="btn btn-default btn-sm" bt-event-click="submitSetting" name="autofresh" style="margin-left: 40px;"><span>保存</span></button>
                        <span class="tips">* 设置插件是否自动刷新获取数据</span>
                    </div>
                </div>
            </div>
            <div class="line_border"></div>
            <div class="setting_box">
                <div class="setting_left_title">蜘蛛IP库:</div>
                <div class="setting_rigth_content">
                    <div class="item-line">
                        <% if(this.spiders_latest_update){%>
                            <span style="margin-right: 33px;">最新同步时间: <%bt.format_data(this.spiders_latest_update)%></span>
                        <%}%>
                        <button type="button" class="btn btn-default btn-sm" bt-event-click="submitSetting" name="synczhizhu"><span>同步蜘蛛IP库</span></button>
                        <span class="tips">* 从云端更新最新的蜘蛛IP库。监控报表每周会自动更新一次</span>
                    </div>
                </div>
            </div>
            <div class="line_border"></div>
            <div class="setting_box">
                <div class="setting_left_title">统计:</div>
                <div class="setting_rigth_content">
                    <div class="item-line">
                        <div class="setting_switch_title">IP统计</div> 
                        <input type="number" class="ip_total_quantity" name="ip_total" value="<% this.ip_top_num %>" style="width:55px;">
                        <button type="button" class="btn btn-default btn-sm" bt-event-click="totalNumSubmit" style="margin-left: 62px;"><span>保存</span></button>
                        <span class="tips">* 设置IP统计页面的TOP数量</span>
                    </div>
                    <div class="item-line">
                        <div class="setting_switch_title">URI统计</div>
                        <input type="number" class="uri_total_quantity" name="uri_total" value="<% this.uri_top_num %>" style="width:55px">
                        <button type="button" class="btn btn-default btn-sm" bt-event-click="totalNumSubmit" style="margin-left: 62px;"><span>保存</span></button>
                        <span class="tips">* 设置URI统计页面的TOP数量</span>
                    </div>
                </div>
            </div>
            <div class="line_border"></div>
            <div class="setting_box">
                <div class="setting_left_title">日志:</div>
                <div class="setting_rigth_content">
                    <div class="item-line">
                        <div class="setting_switch_title">日志保存天数</div> 
                        <input type="number" id="logdaynum" style="width:55px;" value="<%this.save_day%>"> /天
                        <button type="button" class="btn btn-default btn-sm" bt-event-click="submitSetting" name="log" style="margin-left: 41px;"><span>保存</span></button>
                        <span class="tips">* 缩短日志保存天数原有记录的日志将被删除，请谨慎操作</span>
                    </div>
                    <div class="item-line">
                        <div class="setting_switch_title">历史日志数据目录</div>
                        <input type="text" id="history_path" readonly style="width:350px;background-color: #f5f5f5;" value="<%this.history_data_dir%>">
                        <span class="glyphicon glyphicon-folder-open cursor" style="margin: 0 30px 0 5px;" onclick="bt.select_path('history_path','dir')"></span>
                        <button type="button" class="btn btn-default btn-sm" bt-event-click="submitSetting" name="log_path" ><span>保存</span></button>
                    </div>
                    <div class="item-line">
                        <div class="setting_switch_title">日志压缩</div>
                        <select style="padding: 0 3px;margin-right: 10px;" name="log_compress_type" bt-event-click="logCompressType">
                            <option value="diy">自定义</option>
                            <option value="-1" <% this.compress_day == '-1'?'selected ="selected"':'' %>>不压缩</option>
                        </select>
                        <div class="log_compress_box <% this.compress_day == '-1'?'hide':'' %>" ><input type="number" id="log_compress"  style="width:55px; " value="<%this.compress_day == '-1'?30:this.compress_day %>"> /天</div>
                        <button type="button" class="btn btn-default btn-sm" bt-event-click="submitSetting" name="log_compress" style="margin-left: 41px;"><span>保存</span></button>
                        <div class="log_compress_box <% this.compress_day == '-1'?'hide':'' %>" style="margin:7px 0 0 113px;width:520px;display: block;">
                            对<b class="compress_day bterror"><% this.compress_day == '-1'?30:this.compress_day %></b>天以前的日志进行压缩，预计节省6倍磁盘空间。<br>
                            已压缩的日志只支持手动解压查询，请根据查询历史日志的需要，合理设置压缩天数。<br>
                            日志保存天数、压缩天数更改并不是立即执行，需要等待计划任务在后台执行生效。
                        </div>
                    </div>
                </div>
            </div>
            <!-- <div class="setting_box">
                <div class="setting_left_title">数据存储目录:</div>
                <div class="setting_rigth_content">
                    <span>
                        <input type="text" readonly value="<% this.data_dir%>" style="width:200px;margin-right: 20px;padding-left: 5px;">
                    </span>
                    <span>
                        <button type="button" class="btn btn-default btn-sm" data-path="<% this.data_dir%>" bt-event-click="replaceDir" name="int">更换存储目录</button>
                        <button type="button" class="btn btn-default btn-sm mr10" data-path="<% this.data_dir%>" bt-event-click="replaceDir" name="fast">快速清理数据</button>
                    </span>
                </div>
            </div> -->
            <div class="line_border"></div>
            <div class="setting_box set_cdn_format">
                <div class="setting_left_title">监控配置:</div>
                <div class="setting_rigth_content">
                    <div class="tab-nav">
                        <span class="on" data-type="cdn_headers">CDN headers</span>
                        <span data-type="exclude_extension">排除扩展</span>
                        <span data-type="exclude_status">排除响应状态码</span>
                        <span data-type="exclude_url">排除路径</span>
                        <span data-type="exclude_ip">排除IP</span>
                        <span data-type="record_post_args">记录请求原文</span>
                    </div>
                    <div class="tab-con"></div>
                    <p style="margin-top:10px">
                        <button type="button" class="btn btn-success btn-sm" bt-event-click="submitSetting" name="set">保存</button>
                        <button type="button" class="btn btn-default btn-sm" bt-event-click="submitSetting" name="setAll" style="margin-left: 10px;">同步所有站点</button>
                        <span class="tips" style="display: block;margin: 15px 0 20px 0;">*【保存】【同步所有站点】只会保存/同步当前所选中的监控配置内容<br>*【保存】 只会将没有在【网站列表】中自定义过的配置进行默认设置，如需所有站点都应用请点击【同步所有站点】</span>
                    </p>
                </div>
            </div>
            <div class="line_border"></div>
            <div class="setting_box">
                <div class="setting_left_title">帮助:</div>
                <div class="setting_rigth_content" style="vertical-align: bottom;color: #777;">在使用监控报表插件过程中遇到任何问题，请加QQ群625962236寻求在线帮助。</div>
            </div>
        </div>
    </script>
    <script type="text/html" id="total_view">
        <div class="total_head">
            网站：<div class="mt_select siteSelected" bt-event-click="selectSwitch">
                    <span class="mt_select_value">
                        <span class="mt_select_content"><% this.site_name %></span>
                        <span class="glyphicon glyphicon-triangle-bottom ml5"></span>
                    </span>
                    <ul class="mt_select_list" bt-event-click="siteSelected|li">
                        <% for(var item in this.site_list){%>
                            <% if(this.site_list.hasOwnProperty(item)){ %>
                                <li <% this.site_name == this.site_list[item]? 'class="active"':''%>><%this.site_list[item]%></li>
                            <%}%>
                        <%}%>
                    </ul>
                </div>
            时间：
            <div class="search-day" bt-event-click="TimeChoose|span">
                <% for(var ke in this.time_cycle){%>
                    <span data-name="<% ke %>" <% ke == this.query_text?'class="cur"':''%>><% this.time_cycle[ke]%></span>
                <%}%>
            </div>
            <% if(this.menu_type == 'uri_total'){%>
                <span class="title-box">
                    流量类型：
                    <div class="search-day" bt-event-click="refererStatistical|span">
                        <span data-name="request" <% this.referer_type == 'request'?'class="cur"':''%>>所有访问</span>
                        <span data-name="spider" <% this.referer_type == 'spider'?'class="cur"':''%>>蜘蛛访问</span>
                    </div>
                </span>
            <%}%>
            <div class="head_switch pull-right">
                <% if(this.menu_type == 'ip_total'){%>
                    <span class="ip_accurate" style="vertical-align: sub;">
                        <% if(this.online_data){ %>
                            <i class="open_service"></i>
                            <span style="margin-right: 35px;">已开通IP精准数据包</span>
                        <%} else {%>
                            <% if(this.is_ltd){%>
                                <button class="btn btn-success btn-sm" onclick="bt.soft.install('btiplibrary',this)">开通IP精准数据包</button>
                            <%}else{%>
                                <button class="btn btn-success btn-sm" onclick="bt.soft.product_pay_view({name:'IP精准数据包',pid:100000063,type:12,plugin:true,ps:'链接商业IP数据库，精准显示网站用户归属地信息'})">开通IP精准数据包</button>
                            <%}%>
                        <%}%>
                    </span>
                <%}%>
                <% if(this.menu_type == 'ip_total' || this.menu_type == 'uri_total'){%>
                    <span style="vertical-align: sub;">全局<% this.menu_type == 'ip_total'?'IP统计':'URI统计' %></span>
                    <div class="setting_rigth_content" style="display:inline-block;">
                        <div class="set_rodio_switch" style="margin-top: 3px;">
                            <span>
                                <input class="btswitch btswitch-ios" id="temporary_switch" type="checkbox" <% this.monitor ?'checked':''%>>
                                <label class="btswitch-btn temporary_switch" for="temporary_switch" bt-event-click="onchangeTemporaryIporUri"></label>
                            </span>
                        </div>
                    </div>
                <%}%>
            </div>
        </div>
        <div class="access_total_table" id="access_total_table"></div>
        <ul class="help-info-text c7 mtb15">
            <% if(this.menu_type == 'ip_total' || this.menu_type == 'uri_total'){%>
                <li>【全局<% this.menu_type == 'ip_total'?'IP统计':'URI统计' %>】 开关会关闭所有站点的URI统计功能。</li>
                <li>URI请求和流量统计会耗费一些服务器性能，如果您不需要可关闭该功能。</li>
                <% if(this.online_data && this.menu_type == 'ip_total'){ %>
                    <li>IP归属地信息已通过[IP精准数据包]在线API查询，查询结果由商业IP数据库提供保证，提供国内区县级、归属运营商信息。</li>
                <% }else if(this.menu_type == 'uri_total'){ %>
                    <li class="alone" >不会自动添加路径，需要自行选择或输入网站指定的URI路径</li>
                    <li class="alone" >新添加的数据为0，将在有新访客数据时更新信息</li>
                <%}%>
            <%}else if(this.menu_type == 'referer_stat'){%>
                <li>来源统计：统计网站来自其他域名跳转的访问次数和流量</li>
            <%}%>
        </ul>
    </script>
    <script type="text/html" id="total_report_config">
        <div class="totol_report_box">
            网站：<div class="mt_select siteSelected" bt-event-click="selectSwitch">
                <span class="mt_select_value">
                    <span class="mt_select_content"><% this.site_name %></span>
                    <span class="glyphicon glyphicon-triangle-bottom ml5"></span>
                </span>
                <ul class="mt_select_list" bt-event-click="siteSelected|li">
                    <% for(var item in this.site_list){%>
                        <% if(this.site_list.hasOwnProperty(item)){ %>
                            <li <% this.site_name == this.site_list[item]? 'class="active"':''%>><%this.site_list[item]%></li>
                        <%}%>
                    <%}%>
                </ul>
            </div>
            时间：
            <div class="search-day search-report-time" bt-event-click="ReportTimeChoose|span">
                <% for(var ke in this.report_cycle){%>
                    <span data-name="<% this.report_cycle[ke].year %>" <% this.report_cycle[ke].year == this.report_query_text?'class="cur"':''%>><% this.report_cycle[ke].name%></span>
                <%}%>
            </div>
            <span>类型：</span>
            <div class="search-day search-report-type" bt-event-click="ReportTypeChoose|span">
                <span data-name="" class="cur">全部</span>
                <span data-name="week">周报</span>
                <span data-name="month">月报</span>
            </div>
            <div class="head_switch pull-right" style="display: inline-block;vertical-align: 2px;">
                <span>邮箱推送：</span>
                <div class="setting_rigth_content" style="display:inline-block;vertical-align: inherit;">
                    <div class="set_rodio_switch">
                        <span>
                            <input class="btswitch btswitch-ios" id="report_push_switch" type="checkbox" <% this.return_data.push_report ? 'checked':''%>>
                            <label class="btswitch-btn report_push_switch" for="report_push_switch" bt-event-click="onchangeReportPush"></label>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="total_report_content">
            <div class="swiper">
                <ul class="pic"></ul>
                <ol class="cricle">
                    <% for(var i = 0; i<this.return_data.data.length; i++){ %>
                        <li></li>
                    <%}%>
                </ol>
                <div class="btns">
                  <a href="javascript:;" class="leftbtn" style="float: left; margin-left: 6px;"></a>
                  <a href="javascript:;" class="rightbtn" style="float: right; margin-right: 6px;"></a>
                </div>
                <div class="leftBox"></div>
                <div class="rightBox"></div>
                <%if(this.return_data.data.length != 0){%>
                    <div style="text-align: center;position: absolute;left: 0; right: 0;bottom: 5px;"><button type="button" class="btn btn-success btn-sm mr10" bt-event-click="downloadReport">下载PDF报告(<% ToSize(this.return_data.data[0].file_size) %>)</button></div>
                <%}%>
            </div>
        </div>
        <ul class="help-info-text c7">
            <li>每周一生成上周的数据周报，每月1号生成上个月的数据月报，一年累计生成66份数据报告。</li>
            <li>开启邮箱推送，并配置<a class="btlink" href="https://www.bt.cn/bbs/forum.php?mod=viewthread&tid=108097&highlight=%E5%91%8A%E8%AD%A6%E9%80%9A%E7%9F%A5" target="_blank">邮箱消息通道</a>可定时接收报告推送。</li>
        </ul>
    </script>
    <script>
    var site_monitoring_statistics = {
        plugin_name:'total',
        template_config:{
            menu_type:'overview',        //菜单所在位置
            site_name:'',                //选中的网站
            site_list:[],                //网站列表
            time_cycle:{ today:'今日', yesterday:'昨日', h1: '近1小时', l7: '近7天', l30: '近30天' },      //周期范围
            ov_indicators_label:{pv:'浏览量(PV)',uv:'访客量(UV)',ip:'IP数',length:'流量',req:'请求',realtime_traffic:'实时流量',realtime_request:'每秒请求'},
            ov_trend_type:'pv',          //默认指标类型
            query_text:'today',          //查询日期
            period_time:'hour',          //时段
            referer_type:'request',      //来源类型
            chart_list:'chart',          //图表列表
            return_data:{},              //接口返回的内容
            request_type_list:{all:'所有',GET:'GET',POST:'POST',HEAD:'HEAD',PUT:'PUT',DELETE:'DELETE'},
            code_type_list:['all','500','502','503','504','404','200'],
            zhizhu_type_list:{1:'百度',2:'必应',3:'奇虎360',4:'Google',5:'头条',6:'搜狗',7:'有道',8:'搜搜',9:'Dnspod',10:'Yandex',11:'神马',12:'其他'},
            error_type_list:['all', '50x', '40x', '500', '501', '502', '503', '404','403'],
            md_source_name:{android:'安卓',iphone:'iOS',windows:'Windows',chrome:'Chrome',weixin:'微信',qh360:'360',edeg:'Edge',edge:'Edge',firefox:'火狐',safari:'Safari',mac:'Mac',linux:'Linux',msie:'IE',metasr:'搜狗',theworld:'世界之窗',tt:'腾讯TT',maxthon:'遨游',opera:'Opera',qq:'QQ浏览器',uc:'UC',pc2345:'2345',other:'其他',machine:'Machine',mobile:'移动端'}, //客户端来源
            zz_source_name:{bytes:'今日头条',bing:'必应',soso:'搜搜',yahoo:'雅虎',sogou:'搜狗',google:'谷歌',baidu:'百度',qh360:'奇虎360',youdao:'有道',dnspod:'dnspod',yisou:'神马',yandex:'Yandex',duckduckgo:'DuckDuckGo',mpcrawler:'微信小程序',other:'其他'},//蜘蛛来源
            alone_stat_data_list:[],      //独立统计数据列表
            search_type_list:[
                {name:'IP过滤：',type:'ip',placeholder:'支持逗号分割IP,支持192.168.1.*搜索IP区间'},
                {name:'域名过滤：',type:'domain',placeholder:'请输入域名'},
                {name:'UA过滤：',type:'user_agent',placeholder:'请输入UserAgent'},
                {name:'来源过滤：',type:'referer',placeholder:'请输入来源'},
                {name:'请求原文过滤：',type:'post_header',placeholder:'请输入请求原文'},
                {name:'耗时：', type: 'response_time' },
                {name:'',type:'exact_match',placeholder:'开启精准匹配'},
                {name:'',type:'reverse_match',placeholder:'条件取反<span style="color: #ccc;">（对除时间以外的搜索条件取反）</span>'},
                {name:'',type:'time_reverse',placeholder:'时间取反<span style="color: #ccc;">（排除指定时间的结果）</span>'},
            ],
            default_error_type:'all',    //错误日志请求类型
            req_type:'all',              //网站日志请求类型
            code_type:'all',             //网站日志状态码类型
            zhizhu_type:'normal',        //网站日志蜘蛛类型
            filter_value:{               //网站日志过滤类型
                ip:'',
                domain:'',
                user_agent:'',
                search_url:'',
                referer:'',
                post_header:'',
                exact_match: '',
                reverse_match: '',
                time_reverse: '',
            },
            online_data:false,           //精准ip
            report_cycle:[               //统计报告时间周期
                {name: '上年度',year:new Date().getFullYear()-1},
                {name: '本年度',year:new Date().getFullYear()}
            ],           
            report_query_text:new Date().getFullYear(),
            is_ltd: false,               //是否企业版   
            report_type: '' 			 //报表类型              
        },
        history_config: {
            chart:[]
        },
        default_data_config:{            //默认初始化数据
            list_data:[],
            sum_data:{
                pv:0,
                uv:0,
                ip:0,
                req:0,
                length:0,
                realtime_req:0,
                realtime_traffic:0,
                spider_total:'0',
                total_req:0,
                total_mobile: 0,
                total_pc: 0,
            },
            data:[]
        },
        traffic_unit:'KB/s',
        tips_txt:[                       //概览文字提示
            '用户每次打开网站页面被记录1次。用户多次打开同一页面，访问量值累计多次。此指标衡量网站访问量情况。',
            '访问您网站的上网电脑数量（以cookie为依据），此指标衡量独立访客数量情况。',
            '当前时间段内您网站的独立访问ip数。',
            '当前时间段内您网站的总响应流量大小。包括已排除的请求。',
            '当前时间段内您网站的总请求数量。包括已排除的请求。',
            '当前10秒内您网站的实时流量大小。包括已排除的请求。',
            '当前10秒内您网站的实时请求数量。包括已排除的请求。'
        ],
        is_logpage_change: {},           //是否日志页面点击
        is_autorefresh:false,            //是否自动刷新
        is_compare:false,                //是否对比
        is_manual:false,                 //是否手动
        refersh_page:true,               //刷新网站/错误日志分页
        compare_time:'',                 //对比时间
        realtime_type:'',                //概览实时类型
        overviewOption:{},               //概览图表配置
        serviceData: [],                 //概览实时service数据
        xAxisRealTimeArr: [],            //概览实时xAxis数据 
        ov_set_time_out:null,            //实时流量、请求定时器
        ov_echart_dom: null,             //概览图表id
        automatic_loading:null,          //概览自动刷新
        migrate_time:null,               //是否迁移
        err_log_page_num:1,              //错误日志当前页
        site_log_page_num:1,             //网站日志当前页
        store_page_total:0,              //错误/网站日志暂存总数
        setting_config_data:{},          //全局设置
        ajaxList:{
            'get_site_overview':'获取概览信息',
            'get_all_site':'获取网站列表',
            'get_spider_stat':'获取蜘蛛统计数据',
            'get_client_stat':'获取客户端数据',
            'get_site_logs':'获取网站日志',
            'migrate_total':'统计网站数据',
            'get_migrate_status':'统计进度',
            'get_settings_info':'获取设置信息',
            'get_error_code':'获取错误响应码',
            'get_path_space_info':'获取磁盘信息',
            'get_report_list':'获取报告列表',
            'get_spider_by_day':'获取蜘蛛详细',
            'get_ip_info':'获取日志详情',
            'set_settings':'修改监控配置',
            'quick_change_data_dir':'快速清理数据',
            'change_data_dir':'过程较缓慢，更换目录',
            'sync_settings':'同步配置',
            'export_site_logs':'整理导出数据',
            'change_history_data_dir':'更改历史日志数据路径',
            'update_spiders_from_cloud':'同步蜘蛛IP库'
        },
        init:function(){// 初始化
            var that = this,ltd_end = bt.get_cookie('ltd_end'); 
            $('.layui-layer-close').click(function(){  //插件右上角关闭时
                clearInterval(that.ov_set_time_out)
                clearInterval(that.automatic_loading)
            })
            // 菜单栏事件
            $(".bt-w-menu p").click(function() {
                var index = $(this).index(),_fun = $(this).data('funname');
                $(this).addClass('bgw').siblings().removeClass('bgw');
                that.template_config.menu_type = _fun;
                that.initMenuConfig();
                that['set_'+_fun]();
            });
            that.template_config.is_ltd = ltd_end > 0 ?true :false;
            this.http({
                load: 3,
                type:'GET',
                method:'get_site_lists',
                success: function (rdata) {
                    that.template_config.site_list = rdata.data;              
                    that.template_config.site_name = rdata.default;  // 默认网站
                    that.is_compare = true;            // 初始化默认选中对比
                    that.compare_time = 'yesterday';    // 初始化默认选中对比日期
                    that.set_default_website();
                    that.set_overview();
                }
            })
            this.methods = this.methods();
            this.event();
        },
        // 事件
        methods: function () {
            var that = this;
            return {
                // 网站下拉
                selectSwitch:function(e){
                    var _ul = $(this).find('.mt_select_list');
                    if(!_ul.hasClass('show')){
                        $('.mt_select_list').removeClass('show')   //防止开启多个
                        _ul.addClass('show');
                        //单独处理状态码自定义类型【错误日志,网站日志】
                        if($(e.target).hasClass('error_code_type') ||  $(e.target).parents().hasClass('error_code_type')){
                            var code_num = that.template_config.default_error_type
                            if($.inArray(code_num,that.template_config.error_type_list) == -1){
                                _ul.find('[name=code_custom]').val(code_num)
                                _ul.find('li:last').addClass('active')
                            }else{
                                _ul.find('[name=code_custom]').val('')
                            }
                        }else if($(e.target).hasClass('code_type') ||  $(e.target).parents().hasClass('code_type')){
                            var code_num = that.template_config.code_type
                            if($.inArray(code_num,that.template_config.code_type_list) == -1){
                                _ul.find('[name=code_custom]').val(code_num)
                                _ul.find('li:last').addClass('active')
                            }else{
                                _ul.find('[name=code_custom]').val('')
                            }
                        }
                    }else{
                        if($(e.target).hasClass('mt_select') || $(e.target).hasClass('mt_select_content') || $(e.target).hasClass('glyphicon')) _ul.removeClass('show');
                    }
                    $(document).one('click',function(){
                        _ul.removeClass('show');
                    })
                    e.stopPropagation();
                },
                // 搜索类型
                searchSwitch:function(e){
                    that.template_config.search_type = $(this).attr('name');
                    $('.search_type .mt_select_content').html($(this).html());
                    $(this).addClass('active').siblings().removeClass('active')
                    $('.mt_select_list').removeClass('show');
                    e.stopPropagation();
                },
                // 网站选择
                siteSelected:function(e){
                    that.template_config.site_name = $(this).html();
                    $('.mt_select.siteSelected .mt_select_content').html($(this).html());
                    $('.mt_select_list').removeClass('show')
                    $(this).addClass('active').siblings().removeClass('active')
                    if(that.template_config.ov_trend_type == 'realtime_traffic' || that.template_config.ov_trend_type == 'realtime_request'){
                        clearInterval(that.ov_set_time_out)
                        clearInterval(that.automatic_loading)
                        that.serviceData = []
                        that.xAxisRealTimeArr = []
                        if(that.is_autorefresh){
                            that.resetOverviewData(false,true);
                        }else{
                            that.renderOverRealData();
                        }
                        e.stopPropagation();
                        return 
                    } 
                    that.resetViewTemplate(true);
                    e.stopPropagation();
                },
                // 时间选择
                TimeChoose:function(e){
                    var funname = $('.bt-w-menu p.bgw').attr('data-funname');
                    var type = $('.search-type .cur').attr('data-name');
                    if($(this).parents().hasClass('bt-disabled')) return false;
                    if(!$(e.target).hasClass('last-span') && e.target.localName != 'input'){
                        var timeVal = $(this).attr('data-name');
                        that.template_config.query_text = timeVal;
                        $('#time_choose').val('');
                        $(this).addClass("cur").siblings().removeClass("cur");
                        switch($(this).attr('data-name')){
                            case 'l7':
                            case 'l30':
                                that.is_compare = false;
                                that.compare_time = '';
                                $('.time_contrast').addClass('bt-disabled')
                                $('.time_contrast').children('.checked_time').removeClass('active');
                                if (funname == 'overview' && type == 'chart') {
                                    that.template_config.period_time = 'day';
                                    $('.search-day[bt-event-click="switchingPeriod|span"] span').eq(1).addClass('cur').siblings().removeClass('cur');
                                }
                            	break;
                            default:
                                if (funname == 'overview' && type == 'chart') {
                                    that.template_config.period_time = 'hour';
                                    $('.search-day[bt-event-click="switchingPeriod|span"] span').eq(0).addClass('cur').siblings().removeClass('cur');
                                    if (timeVal != 'h1') {
                                        that.is_compare = true;
                                        that.compare_time = 'yesterday';
                                        $('.checked_time[name="yesterday"]').addClass('active');
                                    } else {
                                        that.is_compare = false;
                                        that.compare_time = '';
                                        $('.checked_time[name="yesterday"]').removeClass('active');
                                    }
                                }
                        }
                        that.resetViewTemplate();
                    }
                    e.stopPropagation();
                },
                //uri来源
                refererStatistical:function(){
                    $(this).addClass("cur").siblings().removeClass("cur");
                    that.template_config.referer_type = $(this).attr('data-name')
                    that.resetViewTemplate();
                },
                // 统计报告时间选择
                ReportTimeChoose:function(e){
                    $(this).addClass("cur").siblings().removeClass("cur");
                    that.template_config.report_query_text = $(this).attr('data-name');
                    that.set_total_report($(this).attr('data-name'));
                    e.stopPropagation();
                },
                // 统计报告类型选择
                ReportTypeChoose: function (e) {
                    $(this).addClass("cur").siblings().removeClass("cur");
                    that.template_config.report_type = $(this).attr('data-name');
                    that.set_total_report($('.search-report-time .cur').attr('data-name'));
                    e.stopPropagation();
                },
                // 概览时段选择
                switchingPeriod:function(){
                    if($(this).parents().hasClass('bt-disabled')) return false;
                    $(this).addClass("cur").siblings().removeClass("cur");
                    that.template_config.period_time = $(this).attr('data-name')
                    that.resetViewTemplate();
                },
                //概览图表类型选择
                switchingChartList: function () {
                    if ($(this).parents().hasClass('bt-disabled')) return false;
                    $(this).addClass("cur").siblings().removeClass("cur");
                    that.template_config.chart_list = $(this).attr('data-name');
                    if (that.template_config.chart_list === 'list') {
                        if (!that.history_config.chart.length) {
                            that.history_config.chart = [
                                $('.search-day:eq(0)').children('span.cur').index(),
                                $('.search-day:eq(1)').children('span.cur').index()
                            ]
                        }
                    } else {
                        if (that.history_config.chart.length) {
                            that.history_config.chart.length = [];
                        }
                    }
                    that.set_overview();
                },
                // 手动刷新（关闭了自动刷新时)
                manuallyRefresh:function(){
                    that.is_manual = true;
                    if(that.realtime_type){
                        clearInterval(that.ov_set_time_out)
                        that.renderOverRealData();
                    }else{
                        that.resetViewTemplate();
                    }
                },
                // 趋势指标类型
                indicatorsType:function(e){ 
                    $('.traffic-unit').empty();
                    that.template_config.ov_trend_type = $(this).attr('data-name');
                    $(this).find('input').prop('checked',true);
                    $(this).siblings().find('input').prop('checked',false);
                    switch($(this).attr('data-name')){
                        case 'realtime_traffic':
                        case 'realtime_request':
                            clearInterval(that.ov_set_time_out)
                            clearInterval(that.automatic_loading)
                            $('.search-day,.time_contrast').addClass('bt-disabled')
                            $('.time_contrast .checked_time').removeClass('active')
                            $('.search-day input').prop('disabled',true)
                            that.template_config.query_text = 'today';
                            that.template_config.period_time = 'hour';
                            $('#time_choose').val('')
                            $('.search-day').each(function(){
                                $(this).find('span').eq(0).addClass('cur').siblings().removeClass('cur');
                            })
                            that.realtime_type = $(this).attr('data-name');
                            that.serviceData = []
                            that.xAxisRealTimeArr = []
                            // if(that.is_autorefresh){
                                that.resetOverviewData(false,true);
                            // }else{
                            //     that.renderOverRealData();
                            // }
                            if($(this).attr('data-name') == 'realtime_traffic') that.create_traffic_unit()
                            break;
                        default:
                            var _ctName = ''
                            switch(that.compare_time){
                                case 'yesterday':
                                        _ctName = 'yesterday';
                                        break;
                                case 'lw':
                                        _ctName = 'topweek';
                                        break;
                            }
                            if(that.is_compare) $('[name='+_ctName+']').addClass('active')
                            that.resetViewTemplate();
                    }
                },
                // 时间比对
                contrastDay:function(){
                    if($(this).parents().hasClass('bt-disabled')) return false;
                    if($(this).hasClass('active')){
                        that.is_compare = false;
                        that.compare_time = '';
                        $(this).removeClass('active')
                    }else{
                        that.is_compare = true;
                        switch($(this).attr('name')){
                            case 'yesterday':
                                that.compare_time = 'yesterday';
                                break;
                            case 'topweek':
                                that.compare_time = 'lw';
                                break;
                        }
                        $(this).addClass('active').siblings().removeClass('active');
                    }
                    that.resetViewTemplate();
                },
                // 错误状态码类型
                siteErrorCodeType:function(e){
                    var _text = $(this).html(),_this = $(this);
                    if(e.target.localName == 'input'){
                        $(this).find('input').unbind('blur keyup').on('blur keyup',function(ev){
                            switch(ev.type){
                                case 'blur':
                                    if($(this).val() == '') return false
                                    _text = $(this).val();
                                    next()
                                    break;
                                case 'keyup':
                                    if (ev.keyCode != 13 && ev.type == 'keyup') return false;
                                    $(this).blur();
                                    break;
                            }
                            ev.stopPropagation();
                        })
                    }else{
                        next()
                    }
                    function next(){
                        $('.mt_select.error_code_type .mt_select_content').html(_text);
                        _this.addClass("active").siblings().removeClass("active");
                        that.template_config.default_error_type = (_text=='所有'?'all':_text);
                        $('.mt_select_list').removeClass('show');
                        that.resetViewTemplate();
                    }
                    
                    e.stopPropagation();
                },
                // 网站日志导出
                siteLogExport:function(){
                    var _type = $(this).attr('name');
                    layer.open({
                        type: 1,
                        title: '导出【'+that.template_config.site_name+'】日志',
                        area: '600px',
                        closeBtn: 2,
                        skin:'site_log_export_view',
                        btn:['导出','取消'],
                        shadeClose: false,
                        content:'<div class="pd20 site_log_export">\
                                <div class="l_export_title f14">请选择需要导出的数据:\
                                    <span class="l_export_radio" style="margin: 0;margin-left: 24px; line-height: 16px;"><span class="mtcheckbox"></span>全部数据</span>\
                                </div>\
                                <div class="l_export_type"></div></div>\
                                <ul class="help-info-text c7 ptb15 mlr20">\
                                    <li>导出单个数据时，会自动去除重复数据。</li>\
                                    <li>导出数据过大时，会耗费较长时间和服务器资源，请尽量在闲时导出。</li>\
                                    <li>日志数据以<span style="color:red">.csv</span>文件格式导出，可用excel、文本编辑器等工具打开。</li>\
                                    <li>浏览器没有弹出文件下载提示，请检查是否被浏览器屏蔽了弹出窗口。</li>\
                                </ul>',
                        success:function(){
                            var _thtml = '',
                                _otype = {time:'时间',ip:'真实IP',client_port:'客户端端口',method:'类型',domain:'域名',status_code:'状态',protocol:'协议',uri:'URL',user_agent:'User-Agent',body_length:'响应大小',referer:'来路',request_time:'耗时',is_spider:'蜘蛛类型',request_headers:'请求头',ip_list:'完整IP列表'}
                            for(var iln in _otype){
                                if(Object.prototype.hasOwnProperty.call(_otype,iln)){
                                    _thtml +='<span class="l_export_radio"><span class="mtcheckbox" name="'+iln+'"></span>'+_otype[iln]+'</span>'
                                }
                            }
                            $('.l_export_type').html(_thtml);
                            // 复选框 > 全选
                            $('.l_export_title .l_export_radio').click(function(){
                                var _allCheck = $(this).find('.mtcheckbox');
                                if(_allCheck.hasClass('active')){
                                    _allCheck.removeClass('active')
                                    $('.l_export_type .mtcheckbox').removeClass('active');
                                }else{
                                    _allCheck.addClass('active')
                                    $('.l_export_type .mtcheckbox').addClass('active');
                                }
                            })
                            // 复选框 > 单个选中
                            $('.l_export_type').on('click','.l_export_radio',function(e){
                                var _check = $(this).find('.mtcheckbox'),radio_length = Object.keys(_otype).length;
                                if(_check.hasClass('active')){
                                    _check.removeClass('active')
                                }else{
                                    _check.addClass('active')
                                }
                                if(radio_length == $('.l_export_type .mtcheckbox.active').length){
                                    $('.l_export_title .mtcheckbox').addClass('active')
                                }else{
                                    $('.l_export_title .mtcheckbox').removeClass('active')
                                }
                                e.stopPropagation();
                            })
                        },
                        yes:function(layers,index){
                            var _etype = [],_param = {
                                site:that.template_config.site_name,
                                query_date:that.template_config.query_text,
                                status_code:_type == 'site_log'? that.template_config.code_type:that.template_config.default_error_type
                            };
                            if(_type == 'site_log'){
                                _param['method'] = that.template_config.req_type
                                _param['spider'] = that.template_config.zhizhu_type
                                // 获取过滤条件
                                that.get_site_filter_type(function(typelist){
                                    if(typelist.length > 0){
                                        $.each(typelist,function(index,item){
                                            _param[item] = that.template_config.filter_value[item]
                                        })
                                    }
                                });
                            }else{
                                _param['export_error'] = true;
                            }
                            if(!$.isEmptyObject(that.is_logpage_change)){
                                _param['orderby'] = that.is_logpage_change.orderby
                                _param['desc'] = that.is_logpage_change.desc
                            }
                            
                            $('.l_export_type .mtcheckbox.active').each(function(){
                                _etype.push($(this).attr('name'))
                            })
                            if(_etype.length == 0)return layer.msg('请至少选择一种数据',{icon:2});
                            _param['fields'] = _etype.join(',');
                            that.ajaxTask('export_site_logs',_param,function(res){
                                if(res.status){
                                    window.open('/download?filename=' + encodeURIComponent(res.file_name));
                                }
                            })
                        }
                    })
                },
                // 请求/状态码
                siteReqorCode:function(e){
                    var _text = $(this).html(),_this = $(this),_type = $(this).attr('name');
                    if(_type == 'zhizhu_type') _text = $(this).data('type');
                    if(e.target.localName == 'input'){
                        $(this).find('input').unbind('blur keyup').on('blur keyup',function(ev){
                            switch(ev.type){
                                case 'blur':
                                    if($(this).val() == '') return false
                                    _text = $(this).val();
                                    next()
                                    break;
                                case 'keyup':
                                    if (ev.keyCode != 13 && ev.type == 'keyup') return false;
                                    $(this).blur();
                                    break;
                            }
                            ev.stopPropagation();
                        })
                    }else{
                        next()
                    }
                    function next(){
                        _this.addClass("active").siblings().removeClass("active");
                        that.template_config[_type] = (_text=='所有'?'all':_text);
                        $('.mt_select.'+(_type)+' .mt_select_content').html(e.target.localName == 'input'?_text:_this.html())
                        $('.mt_select_list').removeClass('show');
                        that.resetViewTemplate();
                    }
                    
                    e.stopPropagation();
                },
                // 网站日志搜索按钮
                siteLogSearch:function(){
                    that.template_config.urlPath = $('.mt_log_search_input').val();
                    that.resetViewTemplate();
                },
                // 网站日志高级搜索按钮
                siteLogCompleteSearch:function(e){
                    var box = $(this).find('.complete_search_view');
                    if($(e.target).hasClass('modeFilter')){
                        if(box.hasClass('hide')){
                            $('.modeFilter').css('color','#23527c');
                            box.removeClass('hide');
                        }else{
                            box.addClass('hide');
                            $('.modeFilter').removeAttr('style');
                        }
                    }
                    $(document).one('click',function(){
                        box.addClass('hide');
                        $('.modeFilter').removeAttr('style');
                    })
                    e.stopPropagation();
                },
                searchCheckbox: function () {
                    var exact_match_check = $(this).find('.mtcheckbox');
                    if (exact_match_check.hasClass('active')) {
                        exact_match_check.removeClass('active')
                    } else {
                        exact_match_check.addClass('active')
                    }
                },
                // 选择已有uri列表
                aloneStatDefaultURI:function(){
                    $('[name=aloneStatUri]').val($(this).text());
                },
                // 全局设置-机器统计
                machineSwitch:function(){
                    that.ajaxTask('set_settings',{site:'global',statistics_machine_access: !$('#setMachineSwitch').prop('checked')},function(res){
                        layer.msg(res.msg,{icon:res.status?1:2})
                    })
                },
                // 全局设置-监控开关
                monitoringSwitch:function(){
                    that.ajaxTask('set_settings',{site:'global',monitor: !$('#setMonitoringSwitch').prop('checked')},function(res){
                        layer.msg(res.msg,{icon:res.status?1:2})
                    })
                },
                // ip/uri全局开关
                onchangeTemporaryIporUri:function(){
                    var _status = $('#temporary_switch').prop('checked'),
                        _type = $('.bt-w-menu .bgw').text(),
                        param = {site:'global'};
                        param[_type == 'IP统计'?'statistics_ip':'statistics_uri'] = !_status
                    layer.confirm(!_status?"是否【开启】全局"+_type+"？":"【关闭】全局"+_type+"后，所有站点将不再统计，是否继续？",{title:_type+"设置",icon:3,closeBtn:2}, function() {
                        that.ajaxTask('set_settings',param,function(res){
                            layer.msg(res.msg,{icon:res.status?1:2})
                        })
                    },function(){
                        $('#temporary_switch').prop('checked',_status);
                    })
                },
                // ip/uri显示数量提交
                totalNumSubmit:function(){
                    var _type = $(this).prev('input').attr('name'),_param = {site: 'global'};
                    switch(_type){
                        case 'ip_total':
                            var ip_num = $('.ip_total_quantity').val()
                            if(ip_num == '' || ip_num <= 0 || ip_num > 2000) return layer.msg('请设置1-2000范围的统计数量',{icon:2})
                            _param['ip_top_num'] = ip_num
                            break;
                        case 'uri_total':
                            var uri_num = $('.uri_total_quantity').val()
                            if(uri_num == '' || uri_num <= 0 || uri_num > 2000) return layer.msg('请设置1-2000范围的统计数量',{icon:2})
                            _param['uri_top_num'] = uri_num
                            break;
                    }
                    that.ajaxTask('set_settings',_param,function(res){
                        layer.msg(res.msg,{icon:res.status?1:2})
                    })
                },
                // 全局设置-保存设置
                submitSetting:function(){
                    switch($(this).attr('name')){
                        case 'autofresh':  //自动刷新
                            if($('#autofreshtime').val() < 3) return layer.msg('刷新间隔不能小于3秒',{icon:2})
                            var refresh = $(this).data('hanel') == 'auto'?!$('#setAutoRefresh').prop('checked'):$('#setAutoRefresh').prop('checked')
                            var param = {
                                site: 'global',
                                autorefresh:refresh,
                                refresh_interval:$('#autofreshtime').val()
                            }
                            that.ajaxTask('set_settings',param,function(res){
                                layer.msg(res.msg,{icon:res.status?1:2})
                            })
                            break;
                        case 'log':   //保存日志天数
                            if($('#logdaynum').val() < 1) return layer.msg('日志保存天数不能小于1',{icon:2});
                            layer.confirm("当前的操作将覆盖所有网站设置，是否继续？",{title:"全局设置",icon:3,closeBtn:2}, function() {
                                that.ajaxTask('set_settings',{profile:'global',tosites:'all',site:'global',save_day:$('#logdaynum').val()},function(res){
                                    layer.msg(res.msg,{icon:res.status?1:2})
                                })
                            })
                            break;
                        case 'log_path':     //历史日志路径
                            that.ajaxTask('change_history_data_dir',{target_dir:$('#history_path').val()},function(res){
                                layer.msg(res.msg,{icon:res.status?1:2});
                            })
                            break;
                        case 'log_compress': //日志压缩
                                var log_compress_day = Number($('#log_compress').val()),maxVal = Number($('#logdaynum').val()),log_compress_type = $('[name=log_compress_type]').val()
                                if(log_compress_day <= 0 || log_compress_day > maxVal) return layer.msg('请设置1-'+maxVal+'范围的数值',{icon:0})
                                if(log_compress_type == '-1') log_compress_day = log_compress_type
                                that.ajaxTask('set_settings',{profile:'global',tosites:'all',site:'global',compress_day:log_compress_day},function(res){
                                    layer.msg(res.msg,{icon:res.status?1:2})
                                })
                                break;
                        case 'set':
                        case 'setAll':
                            var _active = $('.setting_rigth_content .tab-nav span.on'),
                                _plugin = $(this).attr('name') == 'set'?'set_settings':'sync_settings',
                                _param = {site: 'global'},
                                tip = '将对站点默认配置进行修改';
                            
                            if($(this).attr('name') != 'set'){
                                _param = {profile:'global',tosites:'all'}
                                _plugin = 'sync_settings';
                                tip = '将同步覆盖所有站点配置，请谨慎操作'
                            }
                            if($('.tab-nav span.on').index() == 3){//排除路径
                                var ex_path = [];
                                $.each($('.setting-exclude-url tbody tr'),function(index,item){
                                    if($.trim($(this).children('td').eq(1).find('input').val()) != '' ){
                                        ex_path.push({
                                            mode: $(this).children('td').eq(0).find('select').val(),
                                            url: $(this).children('td').eq(1).find('input').val()
                                        })
                                    }
                                })
                                
                                _param[_active.data('type')] = JSON.stringify(ex_path)
                            }else if($('.tab-nav span.on').index() == 5){
                                _param[_active.data('type')] = $('.post_args').hasClass('active');
                                _param['record_get_403_args'] = $('.get_err_four').hasClass('active');
                            }else{
                                if($('textarea[name=setting-cdn]').val() == ''){
                                    _param[_active.data('type')] = 'null'
                                }else{
                                    _param[_active.data('type')] = $('textarea[name=setting-cdn]').val().replace(/\n/g,',')
                                }
                            }
                            bt.show_confirm("【"+_active.text()+"】配置",""+tip+"，是否继续？",function(){
                                var _index = _active.index();
                                that.ajaxTask(_plugin,_param,function(res){
                                    if(res.status) that.set_setting(_index);
                                    layer.msg(res.msg,{icon:res.status?1:2});
                                })
                            })
                            break;
                        case 'synczhizhu':
                            that.ajaxTask('update_spiders_from_cloud',function(res){
                                if(res.status) that.set_setting();
                                layer.msg(res.msg,{icon:res.status?1:2})
                            })
                            break;
                    }
                },
                // 日志压缩下拉
                logCompressType:function(){
                    if($(this).val() == '-1'){
                        $('.log_compress_box').addClass('hide')
                    }else{
                        $('.log_compress_box').removeClass('hide')
                    }
                },
                // 更换数据存储目录
                replaceDir:function(){
                    var _type = $(this).attr('name'),_title = '',_path = $(this).data('path'),ps = [],pshtml = '',btn = [];
                    that.ajaxTask('get_path_space_info',{path:_path},function(res){
                        switch(_type){
                            case 'fast':
                                _title = '监控报表-快速清理数据'
                                ps = [
                                    '<strong>快速清理数据将会<span style="color:red">删除所有网站日志、错误日志</span>，保留PV、UV、IP、请求数、流量、蜘蛛、客户端等所有统计数据。</strong>',
                                    '原数据文件会被移动到回收站（如果开启）。',
                                    '清理数据期间监控报表会暂时关闭统计数据，请尽量在闲时操作。'
                                ]
                                btn = ['快速清理数据','取消']
                                break;
                            case 'int':
                                _title = '监控报表-更换存储目录'
                                ps = [
                                    '<strong>完整更换存储目录占用CPU资源，并且耗时较长，请耐心等待，务必在闲时操作。</strong>',
                                    '新目录必须能让www用户具备完全读写权限。',
                                    '更换目录期间监控报表会暂时关闭统计数据。',
                                    '新目录已存在的同名文件会被移动到回收站（如果开启）。'
                                ]
                                btn = ['更换存储目录','取消']
                                break;
                        }
                        $.each(ps,function(index,item){
                            pshtml+='<li>'+item+'</li>'
                        })
                        layer.open({
                            type: 1,
                            title: _title,
                            area: '590px',
                            closeBtn: 2,
                            skin:'replaceData',
                            btn:btn,
                            shadeClose: false,
                            content:'<div class="bt-form pd15">\
                                <div class="line">\
                                    <span class="tname">现存储目录</span>\
                                    <div class="info-r site_monitoring_statistics">\
                                        <input readonly name="originalURL" value="'+_path+'" style="width:280px;height:35px">\
                                        '+(_type == 'fast'?'<div class="line"><span>预计可释放空间('+ToSize(res.path_size)+'),可用空间:'+ToSize(res.disk_free)+'</span></div>':'<span style="width: 150px;display: inline-block;margin-left: 10px;vertical-align: -8px;">占用空间:'+ToSize(res.path_size)+'</br>可用空间:'+ToSize(res.disk_free)+'</span>')+'\
                                    </div>\
                                </div>\
                                '+(_type == 'fast'?'':'<div class="line">\
                                    <span class="tname">新存储目录</span>\
                                    <div class="info-r">\
                                        <input class="bt-input-text" name="replaceURL" id="replaceURL" readonly style="width:280px;height:35px" placeholder="请选择一个新的存储目录">\
                                        <span><span class="glyphicon glyphicon-folder-open" onclick="bt.select_path(\'replaceURL\')" style="cursor: pointer;margin:0 10px"></span><span class="refeshStorage"></span></span>\
                                    </div>\
                                </div>')+'\
                                <ul class="help-info-text c7">'+pshtml+'</ul>\
                                </div>',
                            success:function(){
                                //查询可用空间
                                $('input[name=replaceURL]').change(function(){
                                    that.ajaxTask('get_path_space_info',{path:$(this).val()},function(res){
                                        $('.refeshStorage').html('可用空间:'+ToSize(res.disk_free))
                                    })
                                })
                            },
                            yes:function(layers,index){
                                var dirPath = '';
                                if(_type != 'fast'){
                                    if($('input[name=replaceURL]').val() == '') return layer.msg('请先选择需更换的目录',{icon:2});
                                    if($('input[name=replaceURL]').val() == $('input[name=originalURL]').val()) return layer.msg('不能选择现存储目录为新目录',{icon:2});
                                    dirPath = $('input[name=replaceURL]').val()
                                }
                                
                                bt.show_confirm((_type == 'fast'?"清理数据":"目录更换"),"当前的操作将会"+(_type == 'fast'?'<strong><span style="color:red">删除所有网站日志、错误日志</span>':'更换存储目录')+"，是否继续？",function() {
                                    that.ajaxTask(
                                        _type == 'fast'?'quick_change_data_dir':'change_data_dir',
                                        {data_dir:_path,target_data_dir:dirPath},
                                        function(res){
                                        if(res.status){
                                            layer.close(layers);
                                            that.set_setting();
                                        } 
                                        layer.msg(res.msg,{icon:res.status?1:2})
                                    })
                                })
                            }
                        })
                    })
                },
                // 统计报告 - 邮箱推送
                onchangeReportPush:function(){
                    var _status = $('#report_push_switch').prop('checked'),_site = that.template_config.site_name;
                    layer.confirm("当前操作将"+(!_status?'开启':'关闭')+"【"+_site+"】邮箱推送，是否继续？",{title:"推送设置",icon:3,closeBtn:2,cancel:function(){
                        $('#report_push_switch').attr('checked',_status);
                    }}, function() {
                        that.ajaxTask('set_settings',{site:_site,push_report:!_status,reload_service:false},function(res){
                            layer.msg(res.msg,{icon:res.status?1:2})
                        })
                    },function(){
                        $('#report_push_switch').attr('checked',_status);
                    })
                },
                // 统计报告 - 下载报告
                downloadReport:function(){
                    var picNow = $('.pic li.now'),downID = that.template_config.return_data.data[picNow.index()].report_id;
                    that.http({
                        tips: "正在下载"+picNow.find('span').text(),
                        type:'POST',
                        method:'download_report',
                        data:{report_id:downID},
                        success:function(res){
                            window.open('/download?filename=' + encodeURIComponent(res.data));
                        }
                    })
                }
            }
        },
        // 设置默认网站
        set_default_website: function () {
            if (window.location.pathname.indexOf('/site') != -1) {
                var website = bt.get_cookie('total_website');
                if (website) {
                    this.template_config.site_name = website;
                }
            }
        },
        // 概览
        set_overview: function () {
            var that = this,
                param={
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    target:this.template_config.ov_trend_type,
                    time_scale:this.template_config.period_time,
                    request_in_panel:'True'
                };
                if(this.compare_time){  //比对
                    param['compare'] = true;
                    param['compare_date'] = this.compare_time;
                }
            if(this.template_config.chart_list === 'list'){
                param['list_display'] = true
            }
            this.ajaxTask({method:'get_site_overview',check:true},param,function(res){
                if(typeof res.msg != 'undefined' && typeof res.status != 'undefined'){
                    layer.msg(res.msg,{icon: 2})
                    that.renderTemplate({
                        html: template_html.innerHTML,
                        data: that.template_config
                    }, function (html) {
                        $('.conter_box').html(html)
                    })
                    return false;
                }
                //需要数据迁移
                if(!res.migrated){
                    $.post('/plugin?action=a&s=migrate_total&name=total')
                }
                res.sum_data['pv'] = that.formatCurrency(res.sum_data.pv)
                res.sum_data['uv'] = that.formatCurrency(res.sum_data.uv)
                res.sum_data['ip'] = that.formatCurrency(res.sum_data.ip)
                res.sum_data['req'] = that.formatCurrency(res.sum_data.req)
                res['realtime_request'] = res['realtime_request'].length != 0 ?res['realtime_request'][0]['req']:0;
                res['realtime_traffic'] = res['realtime_traffic'].length != 0 ?res['realtime_traffic'][0]['flow']:0;
                that.template_config.return_data = res;
                that.template_config.sys_firewall = res.sys_firewall;
                that.template_config.online_data = res.online_data;
                
                that.renderTemplate({
                    html: template_html.innerHTML,
                    data: that.template_config
                }, function (html) {
                    $('.conter_box').html(html)
                    that.event('#template_html'); //关联事件
                    if(that.compare_time){
                        $('.total_num_box .tn_compare').removeClass('compare_hide')
                        var compareData = [that.formatCurrency(res.compare_sum_data.pv),that.formatCurrency(res.compare_sum_data.uv),that.formatCurrency(res.compare_sum_data.ip),res.compare_sum_data.length,that.formatCurrency(res.compare_sum_data.req)];
                        for(var i = 0; i<compareData.length; i++){
                            $('.total_num_box .tn_compare').eq(i).html(i == 3?ToSize(compareData[i]):compareData[i]);
                        }
                    }else{
                        $('.time_contrast').addClass('bt-disabled').find('span').removeClass('active')
                    }
                    if(that.template_config.chart_list === 'list'){
                        that.resetOverviewListData(res)  //渲染列表
                    }else{
                        if(typeof bt_tools == 'undefined'){
                            $.getScript('/static/js/tools.min.js').done(function(){
                                that.ov_echart_dom = echarts.init(document.getElementById('total_num_echart'));
                                that.resetOverviewData()  //渲染图表
                            })
                        }else{
                            that.ov_echart_dom = echarts.init(document.getElementById('total_num_echart'));
                            that.resetOverviewData()  //渲染图表
                        }
                    }
                    // 名词解释
                    var showTips = ''
                    $('.total_num_len .total_tips').hover(function(){
                        var index = $(this).parents('.total_num_box').index()
                        showTips = setTimeout(function(){
                            layer.tips(that.tips_txt[index], $('.total_num_len .total_tips').eq(index), {
                                tips: [1, '#20a53a'],
                                time: 0,
                                success:function(layero,indexs){
                                    layero.css("left", $('.total_num_len .total_tips').eq(index).offset().left - 10);
                            }})
                        },200)
                    },function(){
                        clearTimeout(showTips)
                        layer.closeAll('tips');
                    })
                    //日期选择
                    laydate.render({
                        elem: '#time_choose',
                        range: true,
                        value:'',
                        max: bt.format_data(new Date().getTime(), 'yyyy-MM-dd'),
                        done: function(value, startdate, endDate){
                            if(!value){
                                that.onchangeLaydateEmpty();
                                return false;
                            }
                            var timeA  = value.split('-')
                            that.template_config.query_text = bt.strim((timeA[0]+timeA[1]+timeA[2])+'-'+(timeA[3]+timeA[4]+timeA[5]));
                            that.resetViewTemplate()
                            $("#time_choose").val(value);
                            $(".last-span").addClass("cur").siblings().removeClass("cur")
                        }
                    });
                });
                that.is_autorefresh = res.autorefesh
                // 开启自动刷新且监控统计开启中
                if(res.autorefesh && res.status){
                    that.automatic_loading = setInterval(function(){
                        that.resetOverviewData(true);
                    }, res.refresh_interval*1000);
                }
            })
        },
        // 网站列表
        set_site_list:function(){
            var that = this;
            this.template_config.return_data = this.default_data_config;
            that.renderTemplate({
                html: site_list.innerHTML,
                data: that.template_config
            }, function (html) {
                $('.conter_box').html(html);
                that.event('#site_list'); //关联事件
                that.get_site_list();
                //日期选择
                laydate.render({
                    elem: '#time_choose',
                    range: true,
                    value:'',
                    max: bt.format_data(new Date().getTime(), 'yyyy-MM-dd'),
                    done: function(value, startdate, endDate){
                        if(!value){
                            that.onchangeLaydateEmpty();
                            return false;
                        }
                        var timeA  = value.split('-')
                        that.template_config.query_text = bt.strim((timeA[0]+timeA[1]+timeA[2])+'-'+(timeA[3]+timeA[4]+timeA[5]));
                        $("#time_choose").val(value);
                        $(".last-span").addClass("cur").siblings().removeClass("cur")
                        that.resetViewTemplate()
                    }
                });
            })
        },
        // 蜘蛛概览
        set_zhizhu_total:function(){
            var that = this;
            that.template_config.return_data = that.default_data_config;
            that.renderTemplate({
                html: template_html.innerHTML,
                data: that.template_config
            }, function (html) {
                $('.conter_box').html(html)
                that.event('#template_html'); //关联事件
                that.get_zhizhu_table_list();
                //日期选择
                laydate.render({
                    elem: '#time_choose',
                    range: true,
                    value:'',
                    max: bt.format_data(new Date().getTime(), 'yyyy-MM-dd'),
                    done: function(value, startdate, endDate){
                        if(!value){
                            that.onchangeLaydateEmpty();
                            return false;
                        }
                        var timeA  = value.split('-')
                        that.template_config.query_text = bt.strim((timeA[0]+timeA[1]+timeA[2])+'-'+(timeA[3]+timeA[4]+timeA[5]));
                        that.resetZzorMdDataInfo(true,'zhizhu_total');
                        $("#time_choose").val(value);
                        $(".last-span").addClass("cur").siblings().removeClass("cur");
                        $('.time_contrast').addClass('bt-disabled');
                    }
                });
            })
        },
        // 客户端统计
        set_client_total:function(){
            var that = this;
            that.template_config.return_data = that.default_data_config;
            that.renderTemplate({
                html: template_html.innerHTML,
                data: that.template_config
            }, function (html) {
                $('.conter_box').html(html)
                that.event('#template_html'); //关联事件
                that.get_client_table_list()
                //日期选择
                laydate.render({
                    elem: '#time_choose',
                    range: true,
                    value:'',
                    max: bt.format_data(new Date().getTime(), 'yyyy-MM-dd'),
                    done: function(value, startdate, endDate){
                        if(!value){
                            that.onchangeLaydateEmpty();
                            return false;
                        }
                        var timeA  = value.split('-')
                        that.template_config.query_text = bt.strim((timeA[0]+timeA[1]+timeA[2])+'-'+(timeA[3]+timeA[4]+timeA[5]));
                        that.resetZzorMdDataInfo(true,'client_total');
                        $("#time_choose").val(value);
                        $(".last-span").addClass("cur").siblings().removeClass("cur");
                    }
                });
            })
        },
        // 网站日志
        set_site_log:function(){
            var that = this;
            that.template_config.return_data = this.default_data_config;
            that.renderTemplate({
                html: template_html.innerHTML,
                data: that.template_config
            }, function (html) {
                $('.conter_box').html(html);
                that.get_site_log(function(param){
                    that.get_page_info(param);
                });
                that.event('#template_html'); //关联事件
                //日期选择
                $('#time_choose').css({'width':'290px','background-position':'270px center'});
                laydate.render({
                    elem: '#time_choose',
                    type: 'datetime',
                    range: true,
                    ready: function(date){ 
                        var sDate = date['year']+'-'+date['month']+'-'+date['date']
                        $('[lay-ymd='+sDate+']').click().click();
                    },
                    max: bt.format_data(new Date().getTime()),
                    done: function(value, startdate, endDate){
                        if(!value){
                            that.onchangeLaydateEmpty();
                            return false;
                        }
                        var _timeA = value.replace(/[-:\s]/g,''),
                            stime = _timeA.substr(0,14)+'-'+_timeA.substr(14);
                        
                        that.template_config.query_text = stime;
                        that.resetViewTemplate();
                        $("#time_choose").val(value);
                        $(".last-span").addClass("cur").siblings().removeClass("cur")
                    }
                });
            })
        },
        // 错误日志
        set_error_log:function(){
            var that = this;
            this.renderTemplate({
                html: template_html.innerHTML,
                data: that.template_config
            }, function (html) {
                $('.conter_box').html(html);
                that.event('#template_html'); //关联事件
                that.get_error_log(function(param){
                    that.get_page_info(param);
                });
                //日期选择
                laydate.render({
                    elem: '#time_choose',
                    type: 'datetime',
                    range: true,
                    ready: function(date){
                        var sDate = date['year']+'-'+date['month']+'-'+date['date']
                        $('[lay-ymd='+sDate+']').click().click();
                    },
                    max: bt.format_data(new Date().getTime()),
                    done: function(value, startdate, endDate){
                        if(!value){
                            that.onchangeLaydateEmpty();
                            return false;
                        }
                        var _timeA = value.replace(/[-:\s]/g,''),
                            stime = _timeA.substr(0,14)+'-'+_timeA.substr(14);
                        that.template_config.query_text = stime;
                        that.resetViewTemplate()
                        $("#time_choose").val(value);
                        $(".last-span").addClass("cur").siblings().removeClass("cur")
                    }
                });
            })
        },
        // ip统计
        set_ip_total:function(){
            this.render_access_view();
        },
        // uri统计
        set_uri_total:function(){
            this.render_access_view();
        },
        // uri独立统计
        // set_uri_alone_stat:function(){
        //     var that = this;
        //     bt_tools.send({url:'/plugin?action=a&name=total&s=get_uri_all_list',data:{site:this.template_config.site_name}},function(res){
        //         that.template_config.alone_stat_uri_list = res;
        //         that.renderTemplate({
        //             html: total_view.innerHTML,
        //             data: that.template_config
        //         }, function(html){
        //             $('.conter_box').html(html);
        //             that.event('#total_view'); //关联事件
        //             that.get_uri_alone_stat();
        //         })
        //     })
        // },
        // 来源统计
        set_referer_stat:function(){
            this.render_access_view();
        },
        // 设置网站配置
        set_site_config_view:function(site){
            var that = this;
            this.ajaxTask('get_settings_info',{site:site},function(res){
                layer.open({
                    type: 1,
                    title: '【'+site+'】'+'监控配置',
                    area: '610px',
                    closeBtn: 2,
                    btn:['保存','取消'],
                    content:'<div class="pd20 set_site_config">\
                            <div class="tab-nav">\
                                <span class="on" data-type="cdn_headers">CDN headers</span>\
                                <span data-type="exclude_extension">排除扩展</span>\
                                <span data-type="exclude_status">排除响应状态码</span>\
                                <span data-type="exclude_status">排除路径</span>\
                                <span data-type="exclude_ip">排除IP</span>\
                                <span data-type="record_post_args">记录请求原文</span>\
                            </div>\
                            <div class="tab-con">\
                                <div class="site-setting-item active">\
                                    <span class="tips">* 准确识别CDN网络IP地址，请注意大小写，如需多个请换行填写</span>\
                                    <textarea name="site_cdn" cols="75" rows="8">'+res.cdn_headers.replace(/,/g,'\n')+'</textarea>\
                                </div>\
                                <div class="site-setting-item">\
                                    <span class="tips">* 排除的请求不写入网站日志、不统计PV、UV、IP，只累计总请求、总流量数，如需多个请换行填写</span>\
                                    <textarea name="site_file_type" cols="75" rows="8">'+res.exclude_extension.replace(/,/g,'\n')+'</textarea>\
                                </div>\
                                <div class="site-setting-item">\
                                    <span class="tips">* 排除的请求不写入网站日志、不统计PV、UV、IP，只累计总请求、总流量数，如需多个请换行填写</span>\
                                    <textarea name="site_code_type" cols="75" rows="8">'+res.exclude_status.replace(/,/g,'\n')+'</textarea>\
                                </div>\
                                <div class="site-setting-item bt_table">\
                                    <span class="tips">* 排除的请求不写入网站日志、不统计PV、UV、IP，只累计总请求、总流量数</span>\
                                    <div class="divtable mtb10 setting-exclude-url" style="height: 200px;overflow: auto;">\
                                        <table class="table table-hover">\
                                            <thead>\
                                                <tr><th width="96">排除方式</th><th>排除路径</th></tr>\
                                            </thead>\
                                            <tbody></tbody>\
                                        </table>\
                                    </div>\
                                </div>\
                                <div class="site-setting-item">\
                                    <span class="tips">* 排除的IP不写入网站日志、不统计PV、UV、IP，只累计总请求、总流量数，如需多个请换行填写<br>* 支持 192.168.1.1-192.168.1.10格式排除区间IP</span>\
                                    <textarea name="site_exclude_ip" cols="75" rows="8">'+(res.exclude_ip == 'null'?'':res.exclude_ip.replace(/,/g,'\n'))+'</textarea>\
                                </div>\
                                <div class="site-setting-item">\
                                    <span class="tips">记录请求原文说明：HTTP请求原文包括客户端请求详细参数，有助于分析或排查异常请求；<br>考虑到HTTP请求原文会<span style="color:red">占用额外存储空间</span>，默认仅记录500错误请求原文。<br>【Apache用户暂时不支持，请知悉】</span>\
                                    <div class="post_checkbox" style="margin: 20px 0 40px 0;"><span style="cursor: pointer;margin-right:15px;"><span class="mtcheckbox post_args '+(res.record_post_args?'active':'')+'" style="margin-right: 7px;"></span>记录POST请求原文</span><span style="cursor: pointer;"><span class="mtcheckbox get_err_four '+(res.record_get_403_args?'active':'')+'" style="margin-right: 7px;"></span>记录403错误请求原文</span></div>\
                                </div>\
                            </div>\
                        </div>',
                    success:function(){
                        var _tbody = ''
                        if(!Array.isArray(res.exclude_url)){
                            res.exclude_url = (res.exclude_url?JSON.parse(res.exclude_url):[])
                        }
                        for(var i =0; i<10;i++){
                            if(typeof res['exclude_url'][i] == 'undefined'){
                                res['exclude_url'][i] = {mode:'regular',url:''}
                            }
                            
                            _tbody+='<tr>\
                                <td>\
                                    <select>\
                                        <option value="normal" '+(res.exclude_url[i].mode == 'normal'?'selected':'')+'>完整匹配</option>\
                                        <option value="regular" '+(res.exclude_url[i].mode == 'regular'?'selected':'')+'>模糊匹配</option>\
                                    </select>\
                                </td>\
                                <td><input style="width:290px" placeholder="'+(res.exclude_url[i].mode == 'normal'?'例：需排除a.com/test.html请求，请填写 /test.html':'请使用常规的正则表达式语法')+'" type="text" value="'+res.exclude_url[i].url+'"></td>\
                                </tr>'
                            }
                        $('.setting-exclude-url tbody').html(_tbody)
                        $('.setting-exclude-url').on('change','select',function(){
                            var selectType = $(this).val(),thatTrInput = $(this).parents('tr').find('input');
                            switch(selectType){
                                case 'normal':
                                    thatTrInput.attr('placeholder','例：需排除a.com/test.html请求，请填写 /test.html')
                                    break;
                                case 'regular':
                                    thatTrInput.attr('placeholder','请使用常规的正则表达式语法')
                                    break;
                            }
                        })
                        $('.set_site_config .tab-nav span').click(function(){
                            $(this).addClass('on').siblings().removeClass('on');
                            $('.set_site_config .tab-con .site-setting-item').eq($(this).index()).addClass('active').siblings().removeClass('active');
                        })
                        
                        // 复选框
                        $('.post_checkbox>span').unbind('click').click(function(e){
                            var _check = $(this).find('.mtcheckbox');
                            if(_check.hasClass('active')){
                                _check.removeClass('active')
                            }else{
                                _check.addClass('active')
                            }
                            e.stopPropagation();
                        })
                    },
                    yes:function(index,layero){
                        var _cdn = $('textarea[name=site_cdn]').val() == ''?'null':$('textarea[name=site_cdn]').val().replace(/\n/g,','),
                            _filetype = $('textarea[name=site_file_type]').val() == ''?'null':$('textarea[name=site_file_type]').val().replace(/\n/g,','),
                            _codetype = $('textarea[name=site_code_type]').val() == ''?'null':$('textarea[name=site_code_type]').val().replace(/\n/g,','),
                            _exclude_ip = $('textarea[name=site_exclude_ip]').val() == ''?'null':$('textarea[name=site_exclude_ip]').val().replace(/\n/g,','),
                            _urltype = [],
                            _record_post = $('.post_args').hasClass('active'),
                            _get_403 = $('.get_err_four').hasClass('active');
                        $.each($('.setting-exclude-url tbody tr'),function(index,item){
                            if($.trim($(this).children('td').eq(1).find('input').val()) != '' ){
                                _urltype.push({
                                    mode: $(this).children('td').eq(0).find('select').val(),
                                    url: $(this).children('td').eq(1).find('input').val()
                                })
                            }
                        })
                        _urltype = JSON.stringify(_urltype)
    
                        that.ajaxTask('set_settings',{
                            site:site,
                            cdn_headers:_cdn,
                            exclude_extension:_filetype,
                            exclude_status:_codetype,
                            exclude_url:_urltype,
                            exclude_ip:_exclude_ip,
                            record_post_args:_record_post,
                            record_get_403_args:_get_403
                        },function(res){
                            if(res.status) layer.close(index);
                            layer.msg(res.msg,{icon:res.status?1:2});
                        })
                    }
                })
            })
        },
        // 设置
        set_setting:function(indx){
            var that = this;
            this.ajaxTask('get_settings_info',{site:'global'},function(res){
                that.setting_config_data = res
                that.renderTemplate({
                    html: setting_view.innerHTML,
                    data: that.setting_config_data
                }, function (html) {
                    $('.conter_box').html(html);
                    that.event('#setting_view'); //关联事件
    
                    //cdn设置
                    var _texbox = '',_text = '',_tips = '';
                    $('.set_cdn_format .tab-nav span').click(function(){
                        $(this).addClass('on').siblings().removeClass('on');
                        switch($(this).index()){
                            case 0:
                                _tips='* 准确识别CDN网络IP地址，请注意大小写，如需多个请换行填写';
                                _text = res.cdn_headers.replace(/,/g,'\n')
                                break;
                            case 1:
                                _tips = '* 排除的请求不写入网站日志，不统计PV、UV、IP，只累计总请求、总流量数，如需多个请换行填写';
                                _text = res.exclude_extension.replace(/,/g,'\n')
                                break;
                            case 2:
                                _tips = '* 排除的请求不写入网站日志，不统计PV、UV、IP，只累计总请求、总流量数，如需多个请换行填写';
                                _text = res.exclude_status.replace(/,/g,'\n')
                                break;
                            case 3:
                                _tips = '* 排除的请求不写入网站日志，不统计PV、UV、IP，只累计总请求、总流量数';
                                if(!Array.isArray(res.exclude_url)){
                                    res.exclude_url = (res.exclude_url?JSON.parse(res.exclude_url):[])
                                }
                                _text = '';
                                for(var i =0; i<10;i++){
                                    if(typeof res['exclude_url'][i] == 'undefined'){
                                        res['exclude_url'][i] = {mode:'regular',url:''}
                                    }
                                    
                                    _text+='<tr>\
                                        <td>\
                                            <select>\
                                                <option value="normal" '+(res.exclude_url[i].mode == 'normal'?'selected':'')+'>完整匹配</option>\
                                                <option value="regular" '+(res.exclude_url[i].mode == 'regular'?'selected':'')+'>模糊匹配</option>\
                                            </select>\
                                        </td>\
                                        <td><input style="width:290px" placeholder="'+(res.exclude_url[i].mode == 'normal'?'例：需排除a.com/test.html请求，请填写 /test.html':'请使用常规的正则表达式语法')+'" type="text" value="'+res.exclude_url[i].url+'"></td>\
                                        </tr>'
                                }
                                break; 
                            case 4:
                                _tips = '* 排除的IP不写入网站日志，不统计PV、UV、IP，只累计总请求、总流量数，如需多个请换行填写<br>* 支持 192.168.1.1-192.168.1.10格式排除区间IP';
                                _text = res.exclude_ip == 'null'?'':res.exclude_ip.replace(/,/g,'\n')
                                break;
                            case 5:
                                _tips = '记录请求原文说明：HTTP请求原文包括客户端请求详细参数，有助于分析或排查异常请求；</br>考虑到HTTP请求原文会<span style="color:red">占用额外存储空间</span>，默认仅记录500错误请求原文。</br>【Apache用户暂时不支持，请知悉】'
                                break;
                        }
                        _texbox = '<span class="tips">'+_tips+'</span><textarea name="setting-cdn" cols="52" rows="8">'+_text+'</textarea>'
                        if($(this).index() == 3){
                            _texbox = '<span class="tips">'+_tips+'</span><div class="divtable mt10 setting-exclude-url" style="height: 200px;overflow: auto;"><table class="table table-hover"><thead><tr><th width="96">排除方式</th><th>排除路径</th></tr></thead><tbody>'+_text+'</tbody></table></div>'
                        }
                        if($(this).index() == 5){
                            _texbox = '<span class="tips">'+_tips+'</span><div class="post_checkbox" style="margin: 20px 0 40px 0;"><span style="cursor: pointer;margin-right:15px;"><span class="mtcheckbox post_args '+(res.record_post_args?'active':'')+'" style="margin-right: 7px;"></span>记录POST请求原文</span><span style="cursor: pointer;"><span class="mtcheckbox get_err_four '+(res.record_get_403_args?'active':'')+'" style="margin-right: 7px;"></span>记录403错误请求原文</span></div>'
                        }
                        $('.set_cdn_format .tab-con').html(_texbox);
                        // select 选中选中修改默认placeholder值
                        $('.setting-exclude-url').on('change','select',function(){
                            var selectType = $(this).val(),thatTrInput = $(this).parents('tr').find('input');
                            switch(selectType){
                                case 'normal':
                                    thatTrInput.attr('placeholder','例：需排除a.com/test.html请求，请填写 /test.html')
                                    break;
                                case 'regular':
                                    thatTrInput.attr('placeholder','请使用常规的正则表达式语法')
                                    break;
                            }
                        })
                        // 复选框
                        $('.post_checkbox>span').unbind('click').click(function(e){
                            var _check = $(this).find('.mtcheckbox');
                            if(_check.hasClass('active')){
                                _check.removeClass('active')
                            }else{
                                _check.addClass('active')
                            }
                            e.stopPropagation();
                        })
                    })
                    
                    $('.set_cdn_format .tab-nav span:eq('+(indx?indx:0)+')').trigger('click')
                })
            })
        },
        // 统计报告
        set_total_report:function(_year){
            var that = this,year = new Date().getFullYear();
            if(_year) year = _year;
            var type = this.template_config.report_type;
    
            this.ajaxTask('get_report_list',{ site: this.template_config.site_name, year: year, report_type: type },function(rdata){
                that.template_config.return_data = rdata
                that.renderTemplate({
                    html: total_report_config.innerHTML,
                    data: that.template_config
                }, function (html) {
                    $('.conter_box').html(html);
                    
                    that.event('#total_report_config'); //关联事件

					$('.search-report-type span[data-name="' + type + '"]').addClass('cur').siblings('.cur').removeClass('cur');
                    var swiper = $('.total_report_content .swiper'),
                        cricle = swiper.find(".cricle"),
                        btns = swiper.find(".btns"),
                        leftbtn = swiper.find(".leftbtn"),
                        rightbtn = swiper.find(".rightbtn"),
                        leftBox = swiper.find(".leftBox"),
                        rightBox = swiper.find(".rightBox"),
                        swiperLi = '',   //轮播列表
                        report_txt = '', //轮播文字说明
                        box_index = rdata.data.length-1,  //当前索引位置
                        cricleLi = cricle.find('li');
    
                    $.each(rdata.data,function(index,item){
                        var _isPrev = '',timeArray = item['report_cycle'].split('-'),reg = /^(\d{4})(\d{2})(\d{2})$/
                        switch(item['report_type']){
                            case '月报':
                                report_txt = year+"年"+item["sequence"]+"月份月报"
                                break;
                            case '周报':
                                report_txt =  year + "年第" + item["sequence"] + "周周报"
                                break;
                        }
                        swiperLi+='<li class="'+(item['report_type'] == '周报'?'Cweek':'Cmonth')+'">\
                            <span>\
                                <p>'+report_txt+'</p>\
                                <p style="font-size:14px">'+timeArray[0].replace(reg,"$1-$2-$3")+' - '+timeArray[1].replace(reg,"$1-$2-$3")+'</p>\
                            </span>\
                        </li>'
                    })
                    swiper.find('.pic').html(swiperLi);
                    // 渲染后重新获取pic长度
                    var picTotal = swiper.find('.pic li'),picLength = picTotal.length - 1; // 从0算起
                    if(!picTotal.length){
                        $('.swiper').html('<span style="position: absolute;left: 0;right: 0;top: 250px;text-align: center;font-size: 20px;">暂无统计报告</span>')
                        return true;
                    }
                    //初始化索引位置
                    $(picTotal[picLength]).addClass('now');
                    $(cricleLi[picLength]).addClass('_bg');
                    if(picTotal.length >= 2) $(picTotal[picLength - 1]).addClass('prev');     
                    // 小圆点事件
                    cricle.on('click','li',function(){
                        box_index = $(this).index();
                        swiperStyle()
                    })
                    //点击预览
                    $('.swiper').on('click','.now',function(){
                        var _location = window.location.href,_url = _location.lastIndexOf('\/');
                        window.open(_location.substring(0,_url+1)+'total/preview_report.html?report_id='+rdata.data[box_index].report_id+'&site='+that.template_config.site_name)
                    })
                    // 轮播图经过事件
                    swiper.hover(function(){
                        btns.css('display','block')
                    },function(){
                        btns.css('display','none')
                    })
                    // 左BTN
                    leftbtn.on('click',function(){
                        box_index--;
                        box_index = box_index < 0 ? 0 :box_index;
                        $('.cricle li:eq('+box_index+')').click()
                    })
                    //右BTN
                    rightbtn.on('click',function(){
                        box_index++;
                        box_index = box_index === picLength+1 ? picLength :box_index;
                        $('.cricle li:eq('+box_index+')').click()
                    })
                    leftBox.click(function(){leftbtn.click()})
                    rightBox.click(function(){rightbtn.click()})
                    // 设置轮播
                    function swiperStyle(){
                        $('[bt-event-click=downloadReport]').html('下载PDF报告('+ ToSize(rdata.data[box_index].file_size)+')');//动态文件大小
                        $(picTotal,cricleLi).removeClass('now prev next');
                        $(picTotal[box_index]).addClass('now').siblings().removeClass('now');
                        $(cricleLi[box_index]).addClass('_bg').siblings().removeClass('_bg');
                        if(!(box_index - 1 === -1) || !(box_index + 1 > picLength)){
                            $(picTotal[box_index-1]).addClass('prev');
                            $(picTotal[box_index+1]).addClass('next');
                        }
                    }
                })
            });
        },
        // 获取网站列表
        get_site_list:function(){
            var that = this;
            bt_tools.table({
                el:'#site_table',
                fid:'site_table',
                load:true,
                tips:'正在获取网站列表',
                default:"网站列表为空", //数据为空时的默认提示
                url:'/plugin?action=a&s=get_all_site&name=total',
                param:{query_date:that.template_config.query_text},
                dataFilter: function(res) {
                    var totalView = [that.formatCurrency(res.sum_data.pv),that.formatCurrency(res.sum_data.uv),that.formatCurrency(res.sum_data.ip),res.sum_data.length,that.formatCurrency(res.sum_data.req),res.sum_data.realtime_traffic,res.sum_data.realtime_req];
                    for(var i = 0; i<totalView.length; i++){
                        totalView[i] = totalView[i] == null ? 0 :totalView[i]
                        $('.total_num_box').eq(i).find('.tn_num').html(i == 3?ToSize(totalView[i]):(i==5?ToSize(totalView[i]):totalView[i]));
                    }
                    return { data: res.list_data};
                },
                column:[
                    {fid:'name',sort: true,title:'网站',width:120,template:function(row){
                        return '<span class="btlink" title="查看'+row.name+'概览" style="word-break: break-all">'+row.name+'</span>';
                    },event:function(row){
                        that.template_config.site_name = row.name;
                        $('[data-funname=overview]').click()
                    }},
                    {fid:'pv',sort: true,width:70,sortValue:'desc',title:'浏览量',template:function(row){
                        return '<span>'+that.formatCurrency(row.pv)+'</span>'
                    }},
                    {fid:'uv',sort: true,width:70,title:'访客数',template:function(row){
                        return '<span>'+that.formatCurrency(row.uv)+'</span>'
                    }},
                    {fid:'ip',sort: true,width:60,title:'IP数',template:function(row){
                        return '<span>'+that.formatCurrency(row.ip)+'</span>'
                    }},
                    {fid:'length',width:86,sort: true,title:'总流量',template:function(row){
                        return '<span>'+ToSize(row.length)+'</span>';
                    }},
                    {fid:'realtime_traffic',title:'实时流量',template:function(row){
                        return '<span>'+ToSize(row.realtime_traffic)+'</span>';
                    }},
                    {fid:'realtime_req',title:'每秒请求'},
                    {fid:'req',sort: true,width:70,title:'请求数',template:function(row){
                        return '<span>'+that.formatCurrency(row.req)+'</span>'
                    }},
                    {fid:'errors_num',title:'错误数',template:function(row){
                        var errors_num =  row.s50x+row.s40x;
                        return errors_num?'<span style="color:red" class="btlink">'+that.formatCurrency(errors_num)+'</span>':'<span>0</span>';
                    },event:function(row,index){
                        if(!(row.s50x+row.s40x) ) return false;
                        that.template_config.site_name = row.name;
                        $('[data-funname=error_log]').click()
                    }},
                    {fid:'spider',title:'真假蜘蛛',width:66,template:function(row){
                        var Fspider = '';
                        if(row.spider == 0 && row.fake_spider == 0)return '<span>0</span>'
                        if(row.fake_spider > 0)Fspider = '<br>'+that.formatCurrency(row.fake_spider)
                        return '<span class="btlink">'+that.formatCurrency(row.spider)+Fspider+'</span>';
                    },event:function(row,index){
                        if(!row.spider && !row.fake_spider) return false;
                        that.template_config.site_name = row.name;
                        $('[data-funname=zhizhu_total]').click()
                    }},
                    {fid:'status',title:'状态',width:45,class:'t_website_status',type:'switch',event:function(row,index){
                        that.ajaxTask('set_settings',{site:row.name,monitor:$('.t_website_status input').eq(index).prop('checked')},function(res){
                            layer.msg(res.msg,{icon:res.status?1:2})
                        })
                    }},
                    {title:'操作',width:82, type:'group',align:'right',group:[{
                        title:'日志',
                        tips:'网站日志',
                        event:function(row,index,ev,key){
                            that.template_config.site_name = row.name;
                            $('[data-funname=site_log]').click()
                        }
                    },{
                        title:'配置',
                        tips:'设置CDN,排除扩展类型',
                        event:function(row,index,ev,key){
                            that.set_site_config_view(row.name)
                        }
                    }]}
                ],
                sortParam:function(data){
                    $('.not-select.cursor-pointer').parent('th').removeAttr('style');
                    $('.sort-active').parent('th').css('padding','8px 8px');
                    $('.not-select.cursor-pointer .glyphicon').hide();
                    $('.not-select.cursor-pointer.sort-active .glyphicon').show();
                    return {orderby:data.name,desc:data.sort == 'desc'?true:false}
                },
                success:function(){
                    $('.not-select.cursor-pointer .glyphicon').hide();
                    $('.not-select.cursor-pointer.sort-active .glyphicon').show();
                    that.fixed_table('#site_table', '476px');
                }
            })
        },
        /**
         * @descripttion: 获取网站uri独立统计
         * @author: Lifu
         * @param {Object} param 请求所需参数    
         * @return viod
         */
        get_uri_alone_stat:function(){
            var that = this,fixedThead= true,num = 0,aloneArray = [];
            bt_tools.table({
                el:'#uri_stat_table',
                load:true,
                default:'URI列表为空',
                url:'/plugin?action=a&name=total&s=get_uri_alone_stat',
                param:{site:this.template_config.site_name,query_date:this.template_config.query_text},
                height:'390px',
                dataFilter:function(res){
                    that.alone_stat_data_list = res.data;
                    return {data:res.data}
                },
                column:[
                    {fid:'uri',title:'URI',width: 200, fixed: true},
                    {title:'浏览量',template:function(row){
                        return '<span>'+row.uri_count_stat.pv+'</span>'
                    }},
                    {title:'访客数',template:function(row){
                        return '<span>'+row.uri_count_stat.uv+'</span>'
                    }},
                    {title:'IP数',template:function(row){
                        return '<span>'+row.uri_count_stat.ip+'</span>'
                    }},
                    {title:'客户端',template:function(row){
                        return '<span class="alone_stat--block btlink" data-type="client_stat" data-id="'+row.no+'">详情</span>'
                    }},
                    {title:'总流量',template:function(row){
                        return '<span>'+ToSize(row.uri_count_stat.flow)+'</span>';
                    }},
                    {title:'蜘蛛数',template:function(row){
                        return '<span class="alone_stat--block" data-type="spider_stat" data-id="'+row.no+'">'+row.uri_count_stat.spider+'</span>';
                    }},
                    {title:'蜘蛛流量',template:function(row){
                        return '<span class="alone_stat--block" data-type="flow_stat" data-id="'+row.no+'">'+ToSize(row.uri_count_stat.spider_flow)+'</span>';
                    }},
                    {title:'操作',type:'group', align:'right', group:[{
                        title:'删除',
                        event:function(row,index,ev,key,thatC){
                            layer.confirm('删除【'+row.uri+'】后将不再统计访客数据，是否继续？', {
                                title: '删除URI统计', closeBtn: 2, icon: 0
                            }, function (index) {
                                bt_tools.send({url:'/plugin?action=a&name=total&s=del_uri_alone_stat',data:{site:that.template_config.site_name,uri:row.uri}},function(rdata){
                                    if(rdata.status){
                                        thatC.$refresh_table_list(true)
                                    }
                                    bt_tools.msg(rdata)
                                })
                            });
                        }
                    }]}
                ],
                success:function(){
                    if(fixedThead){
                        num++;
                        if(num >= 2){
                            // 鼠标经过增加tips展示
                            $('#uri_stat_table').on('mouseover','.alone_stat--block',function(ev){
                                var type = $(this).data('type'),
                                    id = $(this).data('id'),
                                    item = that.alone_stat_data_list.find(function(item){return item.no == id}) // 获取当前行数据
                                // 根据型数据显示tips
                                that.open_alone_stat_tips(item,type,ev)
                            }).on('mouseout','.alone_stat--block',function(e){
                                // 不在含有stat_tips的元素内
                                if(e.relatedTarget.className.indexOf('stat_tips') == -1){
                                    $('.alone_stat_tips').remove()
                                }
                            })
                        }
                    }
                }
            })
        },
        /**
         * @descripttion: 显示单独统计的tips信息
         * @author: Lifu
         * @param {Object} row 当前行数据
         * @param {String} type 展示所关联的类型【client_stat/spider_stat/flow_stat】
         * @param {String} ev 当前元素
         * @return viod
         */
        open_alone_stat_tips:function(row,type,ev){
            $('.alone_stat_tips').remove()   // 移除之前的tips
            var that = this,
                cNum = 0,
                tips = '',
                data = row['uri_'+type],
                cnTitleArr = this.template_config.zz_source_name,
                evTopHeight = $(ev.target).offset().top + $(ev.target).outerHeight() - $(window).scrollTop(),// 偏离高度(元素距离文档顶部的偏移+元素本身的高度-滚动条的高度)
                evLeftWidth = $(ev.target).offset().left;// 偏离宽度

            tips = '<div class="alone_stat_tips">';
            switch(type){
                case 'client_stat':
                    cnTitleArr = this.template_config.md_source_name
                    // 增加头部数据展示
                    tips += '<div class="alone_stat_tips--header">' 
                    $.each(data.count,function(i,item){
                        tips += '<div class="alone_stat_tips--header--div ms-tips-'+i+'">\
                            <div class="alone_stat_tips--header--title">\
                                <i class="alone_stat_tips--header--icon"></i>\
                                <span class="alone_stat_tips--header--text ft-transform">'+cnTitleArr[i]+'</span>\
                            </div>\
                            <div class="alone_stat_tips--header--num">'+data.count[i]+'</div>\
                        </div>'
                    })
                    tips += '</div>'
                    data = data.client  // 设置客户端总数后修改内容区域的数据
                    break;
            }

            tips +='<div class="alone_stat_tips--content">'
            for(var i in data){
                cNum++;
                var fKey = '',Val = data[i];
                if(i.indexOf('_flow') != -1){
                    fKey = i.replace('_flow','')
                    Val = ToSize(data[i])
                } else{fKey = i;} 
                tips += '<div class="alone_stat_tips--content--item"><div class="alone_stat_tips--item--div ft-transform">'+cnTitleArr[fKey]+'</div><div class="alone_stat_tips--item--div">'+Val+'</div></div>'
                // 循环每6个增加一条线
                if((parseInt(cNum))%6 == 0){
                    tips += '<div class="alone_stat_tips--content--line"></div>'
                }
            }
            tips += '</div><i class="alone_stat_tips_radius"></i>'
            $('.site_monitoring_statistics').append($(tips).css({left:evLeftWidth-(type === 'client_stat'?460:410)+'px',top:evTopHeight-130+'px',width:type === 'client_stat' ? '450px' : '400px'}))

            // 判断tips是否超出边界
            var tipsHeight = $('.alone_stat_tips').outerHeight(),
                winHeight = $(window).height(),
                tipsTop = $('.alone_stat_tips').offset().top;
            if(tipsTop + tipsHeight > winHeight){
                var realHeight = evTopHeight-tipsHeight
                $('.alone_stat_tips').css({top:realHeight+50+'px'})
                // i标签跟随
                $('.alone_stat_tips .alone_stat_tips_radius').css({top:tipsHeight-65+'px'})
            }else{
                $('.alone_stat_tips .alone_stat_tips_radius').removeAttr('style')
            }
            // 鼠标离开弹窗时
            $('.alone_stat_tips').on('mouseout',function(e){
                if(e.relatedTarget.className.indexOf('stat_tips') == -1){
                    $('.alone_stat_tips').remove()
                }
            })
        },
        // 获取网站日志
        get_site_log:function(callback){
            var that = this,fixedThead= true,num = 0,total_data = {}
                param={
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    method:this.template_config.req_type,
                    spider:this.template_config.zhizhu_type,
                    status_code:this.template_config.code_type,
                    page:this.site_log_page_num,
                    page_size:100,//100
                    no_total_rows:true,
                    request_in_panel:'True'
                };
            if(!$.isEmptyObject(this.is_logpage_change)){
                param['orderby'] = this.is_logpage_change.orderby
                param['desc'] = this.is_logpage_change.desc
            }
            that.get_site_filter_type(function(typelist){
                if (typelist.length > 0) {
                    $.each(typelist, function(index, item) {
                        param[item] = that.template_config.filter_value[item];
                    });
                }
            });
            bt_tools.table({
                el:'#sitelog_table',
                fid:'sitelog_table',
                load:true,
                default:"网站日志为空", //数据为空时的默认提示
                url:'/plugin?action=a&s=get_site_logs&name=total',
                param:param,
                height:'470px',
                dataFilter: function(ress) {
                    total_data = ress.total_data
                    return { data: ress.list_data };
                },
                column:[
                    {fid:'time',width:137, sort: true,sortValue:'desc',title:'时间',template:function(row){
                        return '<span>'+bt.format_data(row.time)+'</span>'
                    }},
                    {fid:'domain',width:126,title:'域名',template:function(row){
                        var _fiter_text = $('<div></div>').text(row.domain).html();
                        return '<span class="overflow_hide sitelog_domain" title="'+_fiter_text+'">'+_fiter_text+'</span>'
                    }},
                    {
                        fid: 'ip',
                        width: 116,
                        title: 'IP',
                        template: function (row) {
                        var _fiter_text_uri = $('<div></div>').text(that.escapeHTML(row.uri)).html(),
                        _fiter_text_ua = $('<div></div>').text(that.escapeHTML(row.user_agent)).html(),
                        _fiter_text_ip = $('<div></div>').text(row.ip).html(), 
                        _fiter_text_ref = $('<div></div>').text((row.referer)).html();
                        return '<span class="overflow_hide sitelog_ip '+ ( that.template_config.sys_firewall ? (row.droped ? 'text_dec' : 'btlink') : 'btlink') +'" title="'+ (that.template_config.sys_firewall && row.droped ? '当前IP已屏蔽\n\n':'') +'URI:\n'+_fiter_text_uri+'\n\n'+'User-Agent:\n'+_fiter_text_ua+'\n\n'+'来源:\n'+(!_fiter_text_ref?'None':_fiter_text_ref)+'">'+_fiter_text_ip+'</span>'
                    	}, 
                        event: function(row,index, ev, key, _that) {
                            if (row.droped) return;

                            if (!that.template_config.sys_firewall) {
                                layer.msg('检测到未安装<span class="bterror">系统防火墙</span>，请安装后再试', { icon: 0, closeBtn: 1, shade: 0.3 });
                                return;
                            }

                            bt.confirm({
                                title: '系统防火墙-屏蔽IP',
                                msg: '您确定要<span class="bterror">系统防火墙</span>屏蔽IP【' + row.ip + '】吗，是否继续？'
                            }, function () {
                                bt_tools.send({ url: 'plugin?action=a&name=firewall&s=create_ip_rules' }, {
                                    types:'drop',
                                    address: row.ip,
                                    brief: '从监控报表添加'
                                }, function(res) {
                                    layer.msg(res.msg,{icon:res.status?1:2})
                                    _that.$refresh_table_list(true);
                                }, '屏蔽IP');
                            });
                        }
                    },
                    {fid:'body_length',width:80,title:'响应',template:function(row){
                        var _fiter_text = $('<div></div>').text(ToSize(row.body_length)).html();
                        return '<span>'+_fiter_text+'</span>'
                    }},
                    {fid:'request_time',sort: true,width:68,title:'耗时',template:function(row){
                        var _fiter_text = $('<div></div>').text(that.elapsed_time_size(row.request_time)).html();
                        return '<span>'+_fiter_text+'</span>'
                    }},
                    {fid:'uri', width:200,title:'URL', template:function(row){
                        var _fiter_text = $('<div></div>').text(that.escapeHTML(row.uri)).html();
                        return '<span class="overflow_hide sitelog_uri" title="'+_fiter_text+'">'+_fiter_text+'</span>'
                    }},
                    {fid:'method',width:85,title:'状态/类型',template:function(row){
                        var _fiter_text = $('<div></div>').text((row.status_code+'/'+row.method)).html(),
                            isSpider = ''
                        switch(row.is_spider){
                            case 0:
                                break;
                            case 77:   //不是蜘蛛
                                isSpider = '<i title="当前为蜘蛛请求"></i>'
                                break;
                            default:
                                isSpider = '<i title="当前为蜘蛛请求" style="background-color:#000"></i>'
                        }
                        return '<span class="log_uri_box">'+isSpider+_fiter_text+'</span>'
                    }},
                    {title:'操作',type:'group',align:'right',group:[{
                        title:'HTTP',
                        tips:'请求头',
                        hide:function(row){
                            return !row['request_headers'];
                        },
                        event:function(row,index,ev,key){
                            if(row['request_headers']){
                                var _http_info = JSON.parse(row['request_headers']),http_html = row['method']+' '+row['uri']+'\n';
                                for(var item in _http_info){
                                    var dataV = _http_info[item]
                                    try {
                                        dataV = decodeURI(dataV);
                                    }catch(e){
                                        dataV = dataV;
                                    }
                                    http_html+= item+':'+dataV+'\n'
                                }
                                layer.open({
                                    type: 1,
                                    title: "【"+ row['domain'] + "】HTTP详情",
                                    area: ['800px','500px'],
                                    closeBtn: 1,
                                    shadeClose: false,
                                    maxmin: true,
                                    content: '<div class="pd15" style="height:100%">\
                                            <pre id="http_info_data" style="height:90%;white-space: break-spaces;"></pre>\
                                            <ul class="help-info-text c7 mtb15"><li style="list-style: none;">payload: POST请求中客户端提交的参数。</li></ul>\
                                            </div>',
                                    success:function(layers){
                                        var html = $('<div></div>').text(http_html).html().replace(/payload/,'<strong style="font-weight:bold;color:#000">payload</strong>')
                                        $('#http_info_data').html(html);
                                        $(layers).css('top',($(window).height() - $(layers).height()) /2);
                                    }
                                })
                            }else{
                                layer.msg('暂无HTTP详情信息',{icon:6})
                            }
                        }
                    },{
                        title:'详情',
                        tips:'日志详情',
                        event:function(row,index,ev,key){
                            that.open_site_details_view(row)
                        }
                    }]}
                ],
                sortParam:function(data){
                    return {orderby:data.name,desc:data.sort == 'desc'?true:false,no_total_rows:true}
                },
                success:function(){
                    if(fixedThead){
                        num++;
                        if(num >= 2){
                            // 点击分页排序不变处理
                            if(!$.isEmptyObject(that.is_logpage_change)){
                                that.is_logpage_change.orderby == 'time'?'':$('thead th:nth-child(5)').find('span:first-child').addClass('sort-active').parent('th').siblings().find('span:first-child').removeClass('sort-active');
                                if(that.is_logpage_change.desc){
                                    $('.sort-active').find('.glyphicon').removeClass('glyphicon-triangle-top').addClass('glyphicon-triangle-bottom')
                                }else{
                                    $('.sort-active').find('.glyphicon').removeClass('glyphicon-triangle-bottom').addClass('glyphicon-triangle-top')
                                }
                                that.is_logpage_change = {}
                            }
                            fixedThead = false;
                            //参数回调
                            if(callback) callback(param);
                            render_log_info()
                        }
                    }
                    
                    if(!that.refersh_page){
                        //重新渲染分页html
                        $('#sitelog_table .pull-right').remove();
                        $('#sitelog_table').append('<div class="pull-right logTotal">'+that.render_custom_page(that.store_page_total,{page:new Number(that.site_log_page_num),number:100})+'</div>')
                        render_log_info()
                    }
                    function render_log_info(){
                        if(!$.isEmptyObject(total_data)){
                            var errHtml = [],textArray = {error: '错误',fake_spider: '假蜘蛛',spider: '蜘蛛'};
                            $.each(total_data,function(index,item){
                                if(item != 0) errHtml.push(textArray[index]+':'+item)
                            })
                            $('#sitelog_table').append('<div class="pull-right logSpider c6" style="margin-top: 13px;margin-right:20px">'+errHtml.join('/')+'</div>')
                            //超过可显示视图隐藏真假蜘蛛
                            if(($('#sitelog_table .page').width()+$('#sitelog_table .logSpider').width()+20) >= 892) $('#sitelog_table .logSpider').remove()
                        }
                    }
                    $('.tbody_shadow_bottom').css({'display':'none'});
					that.setScrollWidth('#sitelog_table');
                }
            })
        },
        // 获取蜘蛛表格
        get_zhizhu_table_list:function(){
            var that = this,fixedThead= true,num = 0,
                param={
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    time_scale:'day',
                    target:'top',
                    request_in_panel:'True'
                };

            if(this.compare_time){
                param['compare'] = true;
                param['compare_date'] = this.compare_time;
            }
            bt_tools.table({
                el:'#zz_table',
                // fid:'zz_table',
                load:true,
                tips:'正在获取蜘蛛列表',
                default:"蜘蛛列表为空", //数据为空时的默认提示
                url:'/plugin?action=a&s=get_spider_stat&name=total',
                param:param,
                height:245,
                dataFilter: function(res) {
                    if(num <= 1){  //排序时不刷新图表
                        var percent = (res.sum_data.spider_total/res.sum_data.total_req)*100,
                            occupy = '('+(isNaN(percent)?0:parseInt(percent))+'%)',
                            totalView = [that.formatCurrency(res.sum_data.spider_total)+occupy,that.formatCurrency(res.sum_data.fake_spider),that.formatCurrency(res.sum_data.total_req)];
                        for(var i = 0; i<totalView.length; i++){
                            totalView[i] = totalView[i] == null ? 0 :totalView[i]
                            $('.total_num_box').eq(i).find('.tn_num').html(totalView[i]);
                        }
                        that.template_config.return_data = res;
                        that.resetZzorMdDataInfo(false,'zhizhu_total');
                    }
                    return { data: res.list_data,total:res.total_row};
                },
                column:[
                    {fid:'time',width:75,sort: true,sortValue:'desc',title:'日期'},
                    {fid:'baidu',sort: true,title:'百度',template:function(row){
                        return '<span>'+that.formatCurrency(row.baidu)+'</span>'
                    }},
                    {fid:'bing',sort: true,title:'必应',template:function(row){
                        return '<span>'+that.formatCurrency(row.bing)+'</span>'
                    }},
                    {fid:'qh360',sort: true,title:'奇虎360',template:function(row){
                        return '<span>'+that.formatCurrency(row.qh360)+'</span>'
                    }},
                    {fid:'google',sort: true,title:'Google',template:function(row){
                        return '<span>'+that.formatCurrency(row.google)+'</span>'
                    }},
                    {fid:'bytes',sort: true,title:'头条',template:function(row){
                        return '<span>'+that.formatCurrency(row.bytes)+'</span>'
                    }},
                    {fid:'sogou',sort: true,title:'搜狗',template:function(row){
                        return '<span>'+that.formatCurrency(row.sogou)+'</span>'
                    }},
                    {fid:'soso',sort: true,title:'搜搜',template:function(row){
                        return '<span>'+that.formatCurrency(row.soso)+'</span>'
                    }},
                    {fid:'yisou',sort: true,title:'神马',template:function(row){
                        return '<span>'+that.formatCurrency(row.yisou)+'</span>'
                    }},
                    {fid:'youdao',sort: true,title:'有道',template:function(row){
                        return '<span>'+that.formatCurrency(row.youdao)+'</span>'
                    }},
                    {fid:'dnspod',sort: true,title:'Dnspod',template:function(row){
                        return '<span>'+that.formatCurrency(row.dnspod)+'</span>'
                    }},
                    {fid:'yandex',sort: true,title:'Yandex',template:function(row){
                        return '<span>'+that.formatCurrency(row.yandex)+'</span>'
                    }},
                    {fid:'other',title:'其他<i class="total_tips">?</i>',template:function(row){
                        return '<span>'+that.formatCurrency(row.other)+'</span>'
                    }},
                    {title:'操作',type:'group', align:'right', group:[{
                        title:'详细',
                        event:function(row,index,ev,key){
                            that.get_zhizhu_detail_info({site:param.site,query_date:row.time})
                        }
                    }]}
                ],
                sortParam:function(data){
                    $('.not-select.cursor-pointer').parent('th').removeAttr('style');
                    $('.sort-active').parent('th').css('padding','8px 3px');
                    $('.not-select.cursor-pointer .glyphicon').hide();
                    $('.not-select.cursor-pointer.sort-active .glyphicon').show();
                    return {orderby:data.name,desc:data.sort == 'desc'?true:false}
                },
                success:function(){
                    $('.not-select.cursor-pointer .glyphicon').hide();
                    $('.not-select.cursor-pointer.sort-active .glyphicon').show();
                    if(fixedThead){
                        num++;
                        if(num >= 2){
                            fixedThead = false;
                            setTimeout(function(){
                                // 名词解释
                                var showTips = ''
                                $('.total_tips').hover(function(){
                                    showTips = setTimeout(function(){
                                        layer.tips('包含Yahoo、DuckDuckGo', $('#zz_table .total_tips'), {
                                            tips: [1, '#20a53a'],
                                            time: 0,
                                            success:function(layero,indexs){
                                                layero.css("left", $('#zz_table .total_tips').offset().left - 10);
                                        }})
                                    },200)
                                },function(){
                                    clearTimeout(showTips)
                                    layer.closeAll('tips');
                                })
                            },200)
                        }
                    }
					that.setScrollWidth('#zz_table');
                },
                tootls:[{ //分页显示
                    type:'page',
                    positon:['right','bottom'], // 默认在右下角
                    pageParam:'page', //分页请求字段,默认为 : p
                    page:1, //当前分页 默认：1
                    numberParam:'page_size',　//分页数量请求字段默认为 : limit
                    number:40,　//分页数量默认 : 10条
                    render:true
                }]
            })
        },
        // 获取客户端表格
        get_client_table_list:function(){
            var that = this,fixedThead= true,num = 0,
                param={
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    time_scale:'day',
                    target:'top',
                    request_in_panel:'True'
                };
            if(this.compare_time){
                param['compare'] = true;
                param['compare_date'] = this.compare_time;
            }
            bt_tools.table({
                el:'#md_table',
                // fid:'md_table',
                load:true,
                tips:'正在获取网站日志',
                default:"客户端列表为空", //数据为空时的默认提示
                url:'/plugin?action=a&s=get_client_stat&name=total',
                param:param,
                height:245,
                dataFilter: function(res) {
                    if(num <= 1){ //排序时不刷新图表
                        that.template_config.return_data = res;
                        that.resetZzorMdDataInfo(false,'client_total');
                    }
                    return { data: res.list_data,total:res.total_row };
                },
                column:[
                    {fid:'time',width:75,sort: true,sortValue:'desc',title:'日期'},
                    {fid:'android',sort: true,title:'安卓',template:function(row){
                        return '<span>'+that.formatCurrency(row.android)+'</span>'
                    }},
                    {fid:'iphone',sort: true,title:'iOS',template:function(row){
                        return '<span>'+that.formatCurrency(row.iphone)+'</span>'
                    }},
                    {fid:'windows',sort: true,title:'Windows',template:function(row){
                        return '<span>'+that.formatCurrency(row.windows)+'</span>'
                    }},
                    {fid:'chrome',sort: true,title:'Chrome',template:function(row){
                        return '<span>'+that.formatCurrency(row.chrome)+'</span>'
                    }},
                    {fid:'weixin',sort: true,title:'微信',template:function(row){
                        return '<span>'+that.formatCurrency(row.weixin)+'</span>'
                    }},
                    {fid:'qh360',sort: true,title:'360',template:function(row){
                        return '<span>'+that.formatCurrency(row.qh360)+'</span>'
                    }},
                    {fid:'edeg',sort: true,title:'Edge',template:function(row){
                        return '<span>'+that.formatCurrency(row.edeg)+'</span>'
                    }},
                    {fid:'firefox',sort: true,title:'火狐',template:function(row){
                        return '<span>'+that.formatCurrency(row.firefox)+'</span>'
                    }},
                    {fid:'safari',sort: true,title:'Safari',template:function(row){
                        return '<span>'+that.formatCurrency(row.safari)+'</span>'
                    }},
                    {fid:'mac',sort: true,title:'Mac',template:function(row){
                        return '<span>'+that.formatCurrency(row.mac)+'</span>'
                    }},
                    {fid:'msie',sort: true,title:'IE',template:function(row){
                        return '<span>'+that.formatCurrency(row.msie)+'</span>'
                    }},
                    {fid:'machine',title:'机器<i class="total_tips">?</i>',template:function(row){
                        return '<span>'+that.formatCurrency(row.machine)+'</span>'
                    }},
                    {fid:'other',title:'其他',template:function(row){
                        var _other = 0,_other_text = '',other_name = {metasr:'搜狗',theworld:'世界之窗浏览器',tt:'腾讯TT浏览器',maxthon:'遨游',opera:'Opera浏览器',qq:'QQ浏览器',uc:'UC浏览器',pc2345:'2345浏览器',linux:'linux',other:'其他'};
                        _other_text+='日期：'+row.time+'\n\n'
                        for(var i in row.other){
                            _other+=row.other[i]
                            _other_text+=(other_name[i]?other_name[i]:i)+'：'+that.formatCurrency(row.other[i])+'\n'
                        }
                        return '<span title="'+_other_text+'">'+that.formatCurrency(_other)+'</span>'
                    }}
                ],
                sortParam:function(data){
                    $('.not-select.cursor-pointer').parent('th').removeAttr('style');
                    $('.sort-active').parent('th').css('padding','8px 3px');
                    $('.not-select.cursor-pointer .glyphicon').hide();
                    $('.not-select.cursor-pointer.sort-active .glyphicon').show();
                    return {orderby:data.name,desc:data.sort == 'desc'?true:false}
                },
                success:function(){
                    $('.not-select.cursor-pointer .glyphicon').hide();
                    $('.not-select.cursor-pointer.sort-active .glyphicon').show();
                    if(fixedThead){
                        num++;
                        if(num >= 2){
                            fixedThead = false;
                            setTimeout(function(){
                                // 名词解释
                                var showTips = ''
                                $('.total_tips').hover(function(){
                                    showTips = setTimeout(function(){
                                        layer.tips('机器或者脚本应用程序访问，包括：Curl、HeadlessChrome、Bot、Wget、Spider、Crawler、Scrapy、zgrab、Python、java 此类关键词', $('#md_table .total_tips'), {
                                            tips: [1, '#20a53a'],
                                            time: 0,
                                            success:function(layero,indexs){
                                                layero.css("left", $('#md_table .total_tips').offset().left - 10);
                                        }})
                                    },200)
                                },function(){
                                    clearTimeout(showTips)
                                    layer.closeAll('tips');
                                })
                            },200)
                        }
                    }
                },
                tootls:[{ //分页显示
                    type:'page',
                    positon:['right','bottom'], // 默认在右下角
                    pageParam:'page', //分页请求字段,默认为 : p
                    page:1, //当前分页 默认：1
                    numberParam:'page_size',　//分页数量请求字段默认为 : limit
                    number:40,　//分页数量默认 : 10条
                    render:true
                }]
            })
        },
        // 获取错误日志表格
        get_error_log:function(callback){
            var that = this,fixedThead= true,num = 0,total_data = {}
                param = {
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    status_code:this.template_config.default_error_type,
                    page:this.err_log_page_num,
                    page_size:50,
                    no_total_rows:true,
                    request_in_panel:'True'
                }
                if(!$.isEmptyObject(this.is_logpage_change)){
                    param['orderby'] = this.is_logpage_change.orderby
                    param['desc'] = this.is_logpage_change.desc
                }
            bt_tools.table({
                el:'#error_log_table',
                // fid:'error_log_table',
                load:true,
                tips:'正在获取错误日志',
                default:"错误日志为空", //数据为空时的默认提示
                url:'/plugin?action=a&s=get_site_error_logs&name=total',
                param:param,
                height:'470px',
                dataFilter: function(ress) {
                    total_data = ress.total_data
                    return { data: ress.list_data};
                },
                column:[
                    {fid:'time',width:137, sort: true,sortValue:'desc',title:'时间',template:function(row){
                        return '<span>'+bt.format_data(row.time)+'</span>'
                    }},
                    {fid:'domain',width:126,title:'域名',template:function(row){
                        var _fiter_text = $('<div></div>').text(that.escapeHTML(row.domain)).html();
                        return '<span class="overflow_hide sitelog_domain" title="'+_fiter_text+'">'+_fiter_text+'</span>'
                    }},
                    {fid:'ip',width:116, title:"IP",template:function(row){
                        var _fiter_text_uri = $('<div></div>').text(that.escapeHTML(row.uri)).html(),
                        _fiter_text_ua = $('<div></div>').text(that.escapeHTML(row.user_agent)).html(),
                        _fiter_text_ip = $('<div></div>').text(that.escapeHTML(row.ip)).html(),
                        _fiter_text_ref = $('<div></div>').text(that.escapeHTML(row.referer)).html();
                        return '<span class="overflow_hide sitelog_ip" title="URI:\n'+_fiter_text_uri+'\n\n'+'User-Agent:\n'+_fiter_text_ua+'\n\n'+'来源:\n'+(!_fiter_text_ref?'None':_fiter_text_ref)+'">'+_fiter_text_ip+'</span>'
                    }},
                    {fid:'body_length',width:80,title:'响应',template:function(row){
                        var _fiter_text = $('<div></div>').text(ToSize(row.body_length)).html();
                        return '<span>'+_fiter_text+'</span>'
                    }},
                    {fid:'request_time',width:68,title:'耗时',template:function(row){
                        var _fiter_text = $('<div></div>').text(that.elapsed_time_size(row.request_time)).html();
                        return '<span>'+_fiter_text+'</span>'
                    }},
                    {fid:'uri', width:200,title:'URL',template:function(row){
                        var _fiter_text = $('<div></div>').text(that.escapeHTML(row.uri)).html();
                        return '<span class="overflow_hide" style="width:180px" title="'+_fiter_text+'">'+_fiter_text+'</span>'
                    }},
                    {fid:'method',width:85,title:'状态/类型',template:function(row){
                        var _fiter_text = $('<div></div>').text((row.status_code+'/'+row.method)).html(),
                            isSpider = ''
                        switch(row.is_spider){
                            case 0:
                                break;
                            case 77:   //不是蜘蛛
                                isSpider = '<i title="当前为蜘蛛请求"></i>'
                                break;
                            default:
                                isSpider = '<i title="当前为蜘蛛请求" style="background-color:#000"></i>'
                                break;
                            
                        }
                        return '<span class="log_uri_box">'+isSpider+_fiter_text+'</span>'
                    }},
                    {title:'操作',type:'group',align:'right',group:[{
                        title:'HTTP',
                        tips:'请求头',
                        hide:function(row){
                            return !row['request_headers'];
                        },
                        event:function(row,index,ev,key){
                            if(row['request_headers']){
                                var _http_info = JSON.parse(row['request_headers']),http_html = row['method']+' '+row['uri']+'\n';
                                for(var item in _http_info){
                                    var dataV = _http_info[item]
                                    try {
                                        dataV = decodeURI(dataV);
                                    }catch(e){
                                        dataV = dataV;
                                    }
                                    http_html+= item+':'+dataV+'\n'
                                }
                                layer.open({
                                    type: 1,
                                    title: "【"+ row['domain'] + "】HTTP详情",
                                    area: ['800px','500px'],
                                    closeBtn: 1,
                                    shadeClose: false,
                                    maxmin: true,
                                    content: '<div class="pd15" style="height:100%">\
                                            <pre id="http_info_data" style="height:90%;white-space: break-spaces;"></pre>\
                                            <ul class="help-info-text c7 mtb15"><li style="list-style: none;">payload: POST请求中客户端提交的参数。</li></ul>\
                                            </div>',
                                    success:function(layers){
                                        var html = $('<div></div>').text(http_html).html().replace(/payload/,'<strong style="font-weight:bold;color:#000">payload</strong>')
                                        $('#http_info_data').html(html);
                                        $(layers).css('top',($(window).height() - $(layers).height()) /2);
                                    }
                                })
                            }else{
                                layer.msg('暂无HTTP详情信息',{icon:6})
                            }
                        }
                    },{
                        title:'详情',
                        tips:'日志详情',
                        event:function(row,index,ev,key){
                            that.open_site_details_view(row)
                        }
                    }]}
                ],
                sortParam:function(data){
                    return {orderby:data.name,desc:data.sort == 'desc'?true:false,no_total_rows:true}
                },
                success:function(){
                    if(fixedThead){
                        num++;
                        if(num >= 2){
                            // 点击分页排序不变处理
                            if(!$.isEmptyObject(that.is_logpage_change)){
                                if(that.is_logpage_change.desc){
                                    $('.sort-active').find('.glyphicon').removeClass('glyphicon-triangle-top').addClass('glyphicon-triangle-bottom')
                                }else{
                                    $('.sort-active').find('.glyphicon').removeClass('glyphicon-triangle-bottom').addClass('glyphicon-triangle-top')
                                }
                                that.is_logpage_change = {}
                            }
    
                            fixedThead = false;
                            // 参数回调
                            if(callback) callback(param)
                            render_log_info()
                        }
                    }
                    
                    if(!that.refersh_page){
                        //重新渲染分页html
                        $('#error_log_table .pull-right').remove();
                        $('#error_log_table').append('<div class="pull-right logTotal">'+that.render_custom_page(that.store_page_total,{page:new Number(that.err_log_page_num),number:50})+'</div>')
                        render_log_info()
                    }
                    function render_log_info(){
                        if(!$.isEmptyObject(total_data)){
                            var errHtml = [];
                            $.each(total_data,function(index,item){
                                errHtml.push(index+':'+item)
                            })
                            $('#error_log_table').append('<div class="pull-right logSpider c6" style="margin-top: 13px;margin-right:20px">'+errHtml.join('/')+'</div>')
                            //超过可显示视图隐藏真假蜘蛛
                            if(($('#error_log_table .page').width()+$('#error_log_table .logSpider').width()+20) >= 892) $('#error_log_table .logSpider').remove()
                        }
                    }
                    $('.tbody_shadow_bottom').css({'display':'none'});
					that.setScrollWidth('#error_log_table');
                }
            })
        },
        /**
         * @descripttion: 获取分页信息【错误/网站日志】
         * @author: Lifu
         * @param {Object} param 请求所需参数    
         * @return viod
         */
        get_page_info:function(param){
            var that = this,
                _type = this.template_config.menu_type == 'site_log'? true: false
            
            delete param['no_total_rows'] // 删除不获取总数字段
            $(_type?'#sitelog_table':'#error_log_table').append('<div class="pull-right logTotal"><div class="page"><span class="Pcount">获取页码中<img src="/static/img/ing.gif"></span></div></div>');
            that.http({
                load:3,
                type:'GET',
                data:param,
                method: _type?'get_site_logs_total':'get_site_error_logs_total',
                success: function (res) {
                    that.refersh_page = true;
                    that.store_page_total = res.total_row
                    $((_type?'#sitelog_table':'#error_log_table') +' .logTotal').html(that.render_custom_page(res.total_row,{page:new Number(_type?that.site_log_page_num:that.err_log_page_num),number:_type?100:50}))
                    // 分页事件
                    $(_type?'#sitelog_table':'#error_log_table').off('click','.page a').on('click','.page a', function (e) {
                        var page = $(this).attr('href');
                        page = page.match(/p=([\d]*)$/)[1]
                        render_log_view(page)
                        e.stopPropagation();
                        e.preventDefault();
                    });
                    // 分页跳转
                    $(_type?'#sitelog_table':'#error_log_table').off('click','.page_jump_btn').on('click','.page_jump_btn', function (e) {
                        render_log_view($('[name=page_jump_num]').val())
                        e.stopPropagation();
                        e.preventDefault();
                    })
                    function render_log_view(page){
                        var _tsort = $('.sort-active').find('span:first-child').html(),
                            _ssort = $('.sort-active').find('.glyphicon'),
                            _nsort = '';
                        switch(_tsort){
                            case '时间':
                                _nsort = 'time'
                                break;
                            case '耗时':
                                _nsort = 'request_time'
                                break;
                        }
                        that.is_logpage_change['orderby'] = _nsort;
                        that.is_logpage_change['desc'] = _ssort.hasClass('glyphicon-triangle-bottom')?true:false;
    
                        that.refersh_page = false;
                        that[_type?'site_log_page_num':'err_log_page_num'] = page
                        $(_type?'#sitelog_table':'#error_log_table').empty();
                        that[_type?'get_site_log':'get_error_log']();
                    }
                }
            })
        },
        // 获取ip、url、来源统计表格
        get_access_list_table:function(){
            var that = this,
                fixedThead= true,
                request_data = {},
                num = 0,
                url = '',
                tbodyText = '',
                tableHeight = 470,
                isIPTotal = true,
                rowList = [{fid:'no',width:50,title:'序号'},
                    {fid:'count',width:130,title:'请求数',template(row){
                        return '<span class="">'+that.formatCurrency(row.count)+' ('+row.count_rate+'%)</span>'
                    }},
                    {fid:'flow',width:130,title:'流量<span style="width:10px;height:10px;display:inline-block;background-color:#ff7e0e"</span>',template:function(row){
                        return '<span>'+ToSize(row.flow)+' ('+row.flow_rate+'%)</span>'
                    }},
                    {fid:'flow_rate',title:'占比图',template:function(row){
                        return '<div class="uri_echart_box"><div class="fr_bg_color" style="width:'+(row.flow_rate > 100 ? 100 : row.flow_rate)+'%"></div></div>'
                    }}],
                param = {
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    request_in_panel:'True'
                }
                
            if(this.template_config.referer_type == 'spider' && this.template_config.menu_type == 'uri_total') param['get_spider_flow'] = true
            switch(this.template_config.menu_type){
                case 'ip_total':
                    url = '/plugin?action=a&name=total&s=get_ip_stat';
                    tbodyText = 'IP统计为空';
                    rowList.splice(1,0,{fid:'ip',width:110,title:'IP',template:function(row){
                        var _fiter_text = $('<div></div>').text(row.ip).html();
                        return '<span class="btlink '+ (that.template_config.sys_firewall && row.droped ? 'text_dec' : '') +'">'+_fiter_text+'</span>'
                    },event:function(row,index){
                        $('.conter_box').empty();
                        $(".bt-w-menu p:nth-child(9)").addClass('bgw').siblings().removeClass('bgw');
                        that.template_config['filter_value']['ip'] = row.ip
                        that.template_config.menu_type = 'site_log'
                        that.set_site_log();
                    }},{fid:'area',width:120,title:'归属地(仅供参考)'})
    
                    //IP精准
                    if(that.template_config.online_data){
                        rowList.splice(3,0,{fid:'carrier',width:106,title:"运营商",template:function(row){
                            return '<span class="overflow_hide btlink" style="width:90px" title="'+row.carrier+'">'+row.carrier+'</span>'
                        }})
                        rowList[2].title = '归属地';
                        rowList[2].template = function(row){return '<span>'+row.area+'</span>'}
                        tableHeight = 449;
                    }
                    break; 
                case 'uri_total':
                    // 获取cookie，查看是否有默认项
                    var c_uri = bt.get_cookie('total_uri_type');
                    if(c_uri == null) c_uri = 'uri_interview';

                    url = '/plugin?action=a&name=total&s=get_uri_stat';
                    tbodyText = 'URI统计为空';
                    rowList.splice(1,0,{fid:'uri',width:220,title:'URI',template:function(row){
                        var _fiter_text = $('<div></div>').text(that.escapeHTML(row.uri)).html();
                        return '<span class="overflow_hide btlink" style="width:200px" title="'+_fiter_text+'">'+_fiter_text+'</span>'
                    },event:function(row,index){
                        $('.conter_box').empty(); 
                        $(".bt-w-menu p:nth-child(9)").addClass('bgw').siblings().removeClass('bgw');
                        that.template_config['filter_value']['search_url'] = row.uri
                        that.template_config.menu_type = 'site_log'
                        that.set_site_log();
                    }})
                        rowList.splice(4,0,{fid:'spider_flow',width:120,title:"蜘蛛流量<span style='width:10px;height:10px;display:inline-block;background-color:#4885ff'</span>",template(row){
                        return '<span class="">'+ToSize(row.spider_flow)+' ('+row.spider_rate+'%)</span>'
                    }})
                    rowList[5].template = function(row){return '<div class="uri_echart_box">\
                        <div class="fr_bg_color" style="width:'+(row.flow_rate > 100 ? 100 : row.flow_rate)+'%"></div>\
                        <div class="sp_bg_color" style="width:'+(row.spider_rate > 100 ? 100 : row.spider_rate)+'%"></div>\
                        </div>'}

                    // tabs切换
                    var uri_tab = total_tab_method({
                        type: 0,
                        active:c_uri,  //默认选中
                        theme: { nav: 'ml0'},
                        list: [{
                            title: '默认统计',
                            name: 'uri_interview',
                            content: '<div id="uri_interview_table"></div>',
                            success: function () {
                                bt_tools.table({
                                    el:'#uri_interview_table',
                                    fid:'uri_interview_table',
                                    default:tbodyText, //数据为空时的默认提示
                                    url:url,
                                    param:param,
                                    load:true,
                                    height:'446px',
                                    tips:'正在获取统计列表',
                                    dataFilter: function (res) {
                                        if(res.data.length > 0) $('.uri_interview_table').addClass('valid')
                                        request_data = res;
                                        return {data: res.data};
                                    },
                                    column:rowList,
                                    success: function(){
                                        if(fixedThead){
                                            num++;
                                            if(num >= 2){
                                                fixedThead = false;
                                                var _type = that.template_config.menu_type;
                                                //获取开关状态  
                                                that.ajaxTask('get_settings_info',{site:'global'},function(res){
                                                    $('#temporary_switch').prop('checked',res['statistics_uri']);
                                                })
                                            }
                                        }
                                    }
                                })
                            }
                        },{
                            title: '独立统计',
                            name: 'uri_stat',
                            content: '<div style="position: relative;margin-top: 10px;">\
                                统计URI：\
                                <input type="text" class="mt_log_search_input" placeholder="请输入或选择需要统计访客数据的URI，如：/bbs/thread-1.html" name="aloneStatUri" value="" style="margin:0;width: 415px;">\
                                <ul class="mt_select_list" name="aloneStatDefaultURI" style="width: 415px;left: 60px;max-height: 250px;"></ul>\
                                <button type="button" class="btn btn-success btn-sm" name="addAloneStat" name="log" style="margin-left: 10px;"><span>添加</span></button>\
                            </div><div id="uri_stat_table"></div>',
                            success: function () {
                                // uri独立统计输入框点击
                                $('[name=aloneStatUri]').click(function(e){
                                    var box = $(this).siblings('.mt_select_list');
                                    if(box.hasClass('show')){
                                        box.removeClass('show');
                                    }else{
                                        box.addClass('show');
                                    }
                                    $(document).one('click',function(){
                                        box.removeClass('show');
                                    })
                                    e.stopPropagation();
                                })
                                // 选择默认uri
                                $('[name=aloneStatDefaultURI]').on('click','li',function(){
                                    var val = $(this).text();
                                    $('[name=aloneStatUri]').val(val);
                                    $(this).parent().removeClass('show');
                                })
                                // 添加uri独立统计
                                $('[name=addAloneStat]').click(function(){
                                    var val = $('[name=aloneStatUri]').val();
                                    bt_tools.send({url:'/plugin?action=a&name=total&s=add_uri_alone_stat',data:{site:that.template_config.site_name,uri:val}},function(res){
                                        if(res.status){
                                            $('[name=aloneStatUri]').val('')
                                            that.get_uri_alone_stat();
                                        }
                                        layer.msg(res.msg,{icon:res.status?1:2})
                                    },'添加独立统计')
                                })
                                // 独立统计输入框下拉
                                bt_tools.send({url:'/plugin?action=a&name=total&s=get_uri_all_list',data:{site:that.template_config.site_name}},function(option){
                                    var _html = '';
                                    for(var i=0;i<option.length;i++){
                                        _html += '<li>'+option[i]+'</li>'
                                    }
                                    $('[name=aloneStatDefaultURI]').html(_html);
                                    that.get_uri_alone_stat();
                                },'获取独立统计列表')
                            }
                        }]
                    })
                    // 渲染tab
                    $('#access_total_table').html(uri_tab.$reader_content())
                    uri_tab.$init();
                    show_uri_dom(c_uri)
                    // tab切换监听
                    $('#access_total_table .tab-nav span').click(function () {
                        var _index = $(this).index(),
                            cookieText = _index == 1?'uri_stat':'uri_interview';
                        show_uri_dom(cookieText)
                        bt.set_cookie('total_uri_type',cookieText);
                    })
                    function show_uri_dom(type){
                        var findEV = $('#site_monitoring_statistics').find('.help-info-text li,.head_switch,.title-box')
                        // 独立统计时隐藏【流量类型/统计开关/提示信息】
                        if(type == 'uri_stat'){
                            findEV.css('display','none')
                            $('.site_monitoring_statistics .alone').removeAttr('style')
                        }else{
                            findEV.removeAttr('style')
                            $('.site_monitoring_statistics .alone').css('display','none')
                        }
                    }
                    return;
                case 'referer_stat':
                    url = '/plugin?action=a&name=total&s=get_referer_stat';
                    tbodyText = '来源统计为空';
                    rowList.splice(1,0,{fid:'domain',width:350,title:'网站',template:function(row){
                        var _fiter_text = $('<div></div>').text(that.escapeHTML(row.domain)).html();
                        return '<span class="overflow_hide btlink" style="width:330px" title="'+_fiter_text+'">'+_fiter_text+'</span>'
                    },event:function(row,index){
                        $('.conter_box').empty(); 
                        $(".bt-w-menu p:nth-child(9)").addClass('bgw').siblings().removeClass('bgw');
                        that.template_config['filter_value']['referer'] = row.domain
                        that.template_config.menu_type = 'site_log'
                        that.set_site_log();
                    }})
                    break;
            }
            bt_tools.table({
                el:'#access_total_table',
                fid:'access_total_table',
                default:tbodyText, //数据为空时的默认提示
                url:url,
                param:param,
				load:true,
				height:'496px',
                tips:'正在获取统计列表',
                dataFilter: function (res) {
                    if(res.data.length > 0) $('.access_total_table').addClass('valid')
                    request_data = res;
                    return {data: res.data};
                },
                column:rowList,
                success: function(){
                    if(fixedThead){
                        num++;
                        if(num >= 2){
                            fixedThead = false;
                            var _type = that.template_config.menu_type;
                            //获取开关状态  
                            if(that.template_config.menu_type != 'referer_stat'){
                                that.ajaxTask('get_settings_info',{site:'global'},function(res){
                                    $('#temporary_switch').prop('checked',res[_type == 'ip_total'?'statistics_ip':'statistics_uri']);
                                })
                            }
                        }
                    }
                }
            })
        },
        // 获取网站过滤类型（值）
        get_site_filter_type:function(callback){
            var that = this,
                type = [],  //过滤类型
                arry = ['search_url','ip','domain','user_agent','referer','post_header','exact_match', 'reverse_match', 'time_reverse', 'response_time'];
            $.each(arry,function(index,item){
                var val = item === 'exact_match' || item === 'reverse_match' || item === 'time_reverse' ? ($('.search_'+item).hasClass('active') ? true : '') : $('input[name=search_'+item+']').val().trim();
                if (val != '') {
                    that.template_config.filter_value[item] = val;
                    type.push(item);
                    if (item == 'response_time') {
                        var key = 'response_time_comparator';
                        type.push(key);
                        that.template_config.filter_value[key] = $('select[name="search_' + key + '"]').val();
                    }
                }
            })
            if(callback) callback(type)
        },
        // 查看日志详情
        open_site_details_view:function(logS){
            var that = this
            layer.open({
                type: 1,
                title: "【"+logS.domain + "】详情信息",
                area: '600px',
                skin:'site_ip_layer',
                closeBtn: 2,
                shadeClose: false,
                content: '<div class="pd15 lib-box">\
                    <div style="height: '+(that.template_config.online_data?'120px':'auto')+'"><table class="table" style="border:#ddd 1px solid; margin-bottom:10px">\
                    <tbody class="site_details_tbody"><tr><th>时间</th><td>' +
                    bt.format_data(logS.time) +
                    '</td><th>真实IP</th><td><span class="overflow_hide detail_ip">' + logS.ip +
                    '</span></td><th>客户端端口</th><td>'+(logS.client_port>0 && logS.client_port != ''?logS.client_port:'')+'</td></tr><tr><th>类型</th><td>' + logS.method + '</td><th>状态码</th><td>' + logS.status_code + '</td><th>响应大小</th><td>' + ToSize(logS.body_length) + '</td></tr></tbody></table></div>\
                    <div><b style="margin-left:10px">协议</b></div>\
                    <div class="lib-con pull-left mt10"><div class="divpre">' + logS.protocol + '</div></div>\
                    <div><b style="margin-left:10px">URL</b></div>\
                    <div class="lib-con pull-left mt10"><div class="divpre">' + $('<div />').text(logS.uri).html() + '</div></div>\
                    <div><b style="margin-left:10px">完整IP列表</b></div>\
                    <div class="lib-con pull-left mt10"><div class="divpre" style="max-height: 66px;">' + $('<div />').text(logS.ip_list).html() + '</div></div>\
                    <div><b style="margin-left:10px">来路</b></div>\
                    <div class="lib-con pull-left mt10"><div class="divpre">' + $('<div />').text(logS.referer == null ?'None':logS.referer).html() + '</div></div>\
                    <div><b style="margin-left:10px">User-Agent</b></div>\
                    <div class="lib-con pull-left mt10"><div class="divpre">' + $('<div />').text(logS.user_agent).html() + '</div></div>\
                    <div><b style="margin-left:10px">处理耗时</b></div>\
                    <div class="lib-con pull-left mt10"><div class="divpre">' +logS.request_time + ' ms</div></div>\
                </div>',
                success:function(){
                    //是否开通ip精准包
                    if(that.template_config.online_data){
                        that.http({
                            load:3,
                            type:'GET',
                            data:{ip:logS.ip,simplify: true},
                            method: 'get_ip_info',
                            success:function(ip_info){
                                $('.site_details_tbody').append('<tr><th>IP归属地</th><td>'+ip_info['data'][logS.ip]['area']+'</td><th>IP运营商</th><td>'+ip_info['data'][logS.ip]['carrier']+'</td><td colspan="2" style="padding:0"><i class="open_service" style="margin-right:2px"></i><span>已开通IP精准数据包</span></td></tr>')
                            }
                        })
                    }
                }
            })
        },
        // 获取蜘蛛详细信息
        get_zhizhu_detail_info:function(param){
            this.ajaxTask('get_spider_by_day',param,function(res){
                layer.open({
                    type: 1,
                    title:'蜘蛛统计',
                    area: '800px',
                    closeBtn: 2,
                    shadeClose: false,
                    content: '<div class="bt-form">\
                        <div class="bt-w-main">\
                            <div class="pd15" id="seo_chart" style="height:550px;width:800px;"></div>\
                        </div>\
                    </div>'
                });
                var my_flow_chart = echarts.init(document.getElementById('seo_chart')),
                    spider_name_en = ['total','baidu','bing','qh360','google','bytes','sogou','soso','yisou','youdao','dnspod','yandex','yahoo','other'],
                    spide_name_zh = ['总次数','百度','必应','奇虎360','Google','头条','搜狗','搜搜','神马','有道','Dnspod','Yandex','Yahoo','其它'],
                    spider_color = ['#d2e8ff','#FF9B42','#F0D418','#4346D3','#4fa8f9','#6ec71e','#f56e6a','#fc8b40','#818af8','#31c9d7','#f35e7a','#ab7aee','#14d68b','#cde88f'],
                    spider_array_type = {},   //蜘蛛列表存放
                    spider_series = [],       //图表series数据
                    xData = [];  //x轴小时段
    
                //遍历已字段名为其本身创建数组
                $.each(spider_name_en,function(index,item){
                    spider_array_type[item] = []     //初始化蜘蛛空数组
                    spider_series.push({             //图表series动态生成
                        name:spide_name_zh[index],
                        type:'line',
                        smooth:true,
                        symbol: 'circle',
                        sampling: 'average',
                        itemStyle: {
                            normal: {
                                color: spider_color[index]
                            }
                        },
                        data: spider_array_type[item]
                    })
                    // 总次数series
                    if(item == 'total'){
                        spider_series[0].type = 'bar';
                        spider_series[0].barMaxWidth = '26px'
                    }
                })
                // 获取所有小时段数据
                for(var i = 0; i < res.length; i++){
                    // 设置初始化总数，取当前小时段后两位数为小时单位
                    var all_num = 0,_hour = res[i].time.toString().substring(8,10);
                    // 遍历具体小时段内蜘蛛数据
                    $.each(res[i],function(idx,v){
                        //字段名不为时间且不是流量数据
                        // if(idx != "time" && idx.indexOf('_flow') == -1 ){]
                        if($.inArray(idx,spider_name_en) != -1){
                            all_num+=v  //每小时总数
                            spider_array_type[idx].push(v)   //添加入对应蜘蛛数组中
                        }
                    })
                    spider_array_type['total'].push(all_num)  //每小时总数
                    xData.push(_hour+':00')   //x轴列表数组
                }
                var option = {
                    title: {
                        text: '蜘蛛统计',
                        left: '50%',
                        textAlign: 'center',
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        },
                        confine:true
                    },
                    grid:{
                        height:'330',
                        top:'24%',
                    },
                    legend: {
                        data:spide_name_zh,
                        top:'10%'
                    },
                    xAxis: {
                        type: 'category',
                        data: xData,
                        axisLine:{
                            lineStyle:{
                                color:"#666"
                            }
                        }
                    },
                    yAxis: {
                        type: 'value',
                        name: '次/h',
                        boundaryGap: [0, '100%'],
                        splitLine:{
                            lineStyle:{
                                color:"#ddd"
                            }
                        },
                        axisLine:{
                            lineStyle:{
                                color:"#666"
                            }
                        }
                    },
                    dataZoom: [{
                        type: 'inside',
                        start: 0,
                        end: 100,
                        zoomLock:true
                    }, {
                        start: 0,
                        end: 100,
                        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
                        handleSize: '80%',
                        handleStyle: {
                            color: '#fff',
                            shadowBlur: 3,
                            shadowColor: 'rgba(0, 0, 0, 0.6)',
                            shadowOffsetX: 2,
                            shadowOffsetY: 2
                        }
                    }],
                    series:spider_series
                };
                my_flow_chart.setOption(option,true);
            })
        },
        // 渲染访问统计视图
        render_access_view:function(){
            var that = this;

            that.renderTemplate({
                html: total_view.innerHTML,
                data: that.template_config
            }, function (html) {
                $('.conter_box').html(html);
                that.event('#total_view'); //关联事件
                that.get_access_list_table();
            })
        },
        /**
         * @descripttion: 渲染概览图表
         * @author: Lifu
         * @param {Object} obj 可接收【tooltip/legendData/xAxisData/yAxis/serData】
         * @return viod
         */
        renderOverEchart:function(obj){
            this.overviewOption = {
                backgroundColor:'#fff',
                tooltip: obj.tooltip,
                legend:{
                    data:obj.legendData,
                    left:'center',
                    top:'94%',
                },
                grid: {
                    bottom: '9%',
                    containLabel: true,
                    x: 20,
                    y: 20,
                    x2: 20,
                    y2: 20
                },
                xAxis:{
                    type: 'category',
                    boundaryGap: false,
                    axisTick: {
                        alignWithLabel: true
                    },
                    axisLabel: {
                        interval: this.template_config.period_time == 'hour'? 1:(this.template_config.query_text == 'l7'?0:parseInt(obj.serData[0].data.length/11))
                    },
                    data: obj.xAxisData,
                },
                yAxis: obj.yAxis,
                graphic:[{
                    type: 'group',
                    right: 420,
                    top: 50,
                    z: 100,
                    children: [{
                        type: 'text',
                        left: 'center',
                        top: 'center',
                        z: 100,
                        style: {
                            fill: '#ccc',
                            text: this.template_config.site_name,
                            font: '16px Arial'
                        }
                    }]
                }],
                series: obj.serData
            }
            if(this.realtime_type != ''){
                delete this.overviewOption.legend
                this.overviewOption.xAxis.axisLabel = {interval: 0};
                this.overviewOption.grid = {bottom:0,top:'10%',containLabel: true,x: 20,y: 20,x2: 20,y2: 20}
            }
            this.ov_echart_dom.setOption(this.overviewOption,true)
        },
        // 渲染蜘蛛图表
        renderZzEchart:function(){
            var that = this;
            var zzEchart = echarts.init(document.getElementById('zz_echart'));
            var xAxixName = this.template_config.query_text.length >10?this.template_config.query_text:this.template_config.time_cycle[this.template_config.query_text]
            xAxixName = xAxixName+'(TOP'+(this.is_compare?3:5)+')'
            var source_name = this.template_config.zz_source_name;
            var lenend2_obj = {};
            var initData = this.template_config.return_data.data;
            var lenend = [];
            var serData = [];
            for(var i = 0; i<initData.length; i++){
                for(var j in initData[i]){
                    source_name[j] = source_name[j]?source_name[j]:j
                    lenend.push(source_name[j])

                    serData.push({
                        name: source_name[j],
                        type: 'bar',
                        label:{
                            normal: { 
                                show: true, 
                                position: 'top', 
                                formatter:function(params){
                                    return params.data;
                                }
                            }
                        },
                        barMaxWidth:60,
                        data: [initData[i][j]?initData[i][j]: 0]
                    })
                }
            }
            for (var i = 0; i < lenend.length; i++) {
                if (i > (this.is_compare?2:4)) {
                    lenend2_obj[lenend[i]] = false;
                } else {
                    lenend2_obj[lenend[i]] = true;
                }
            }
            var option = {
                backgroundColor:'#fff',
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { 
                        type: 'shadow',
                        textStyle: {
                            color: '#fff',
                            fontSize: '26'
                        },
                    },
                    confine:true
                },
                legend: {
                    top:'0%',
                    data: lenend,
                    selected:lenend2_obj,
                    textStyle:{
                        fontSize:12,
                        color:'#808080'
                    },
                    icon:'rect'
                },
                grid: {
                    top:60,
                    left:60,
                    right:0,
                    bottom:60
                },
                xAxis: [{
                    type: 'category',
                    axisLabel:{
                        color:'#4D4D4D',
                        fontSize:14,
                        fontWeight:'bold'
                    },
                    data: [xAxixName],
                }],
                color:['#4fa8f9', '#6ec71e', '#f56e6a', '#fc8b40', '#818af8', '#31c9d7', '#f35e7a', '#ab7aee','#14d68b', '#cde5ff'],
                yAxis: [{
                    type: 'value',
                    axisLine: {
                        show: false,
                    },
                    axisTick: {
                        show: false
                    },
                    splitNumber:4,   //y轴分割线数量
                    axisLabel:{
                        color:'#8C8C8C'
                    },
                    splitLine:{
                        lineStyle:{
                            type:'dashed'
                        }
                    }
                }],
                series:serData
            }
            
            // 是否对比
            if(this.is_compare){
                var compareData = this.template_config.return_data.compare_data;
                option.xAxis[0].data.push(this.compare_time == 'yesterday'?'前一天(TOP'+(this.is_compare?3:10)+')':'上周同期(TOP'+(this.is_compare?3:10)+')');
                for(var i = 0; i<compareData.length; i++){
                    for(var j in compareData[i]){
                        if(serData[i]['name'] == source_name[j]){
                            serData[i]['data'].push(compareData[i][j]==null ?0:compareData[i][j])
                        }
                    }
                }
            }
            zzEchart.setOption(option);
            
            var oop = lenend.slice(0, (this.is_compare?3:10));
            zzEchart.on('legendselectchanged', function (params) {
                var legend_option = this.getOption(),newAxisName = [];
                $.each(legend_option['xAxis'][0]['data'],function(index,item){
                    newAxisName.push(item.replace(/\([^\)]*\)/g,""))
                })
                legend_option['xAxis'][0]['data'] = newAxisName;
                var selectArr =[];
                for(var e in  params.selected){
                    selectArr.push(params.selected[e])
                }
                var num = 0;
                for (var i = 0; i < selectArr.length; i++) {
                    selectArr[i] === true ? num++ : "";
                }
                if(num > (that.is_compare?3:10)){
                    oop.push(params.name)
                }
                if (num > (that.is_compare?3:10)) {
                    var hah = oop.slice(oop.length - (that.is_compare?4:10), oop.length - (that.is_compare?3:9))[0] + '';
                    legend_option.legend[0].selected[hah] = false;
                }
                if (num < 1){
                    legend_option.legend[0].selected[params.name] = true;
                }
                this.setOption(legend_option)
            });
        },
        // 渲染客户端图表
        renderMdEchart:function(){
            var that = this;
            var mdTotal = echarts.init(document.getElementById('md_total_echart'));
            var mdEchart = echarts.init(document.getElementById('md_echart'));
            var xAxixName = this.template_config.query_text.length >10?this.template_config.query_text:this.template_config.time_cycle[this.template_config.query_text]
            xAxixName = xAxixName+'(TOP'+(this.is_compare?3:5)+')'
            var source_name = this.template_config.md_source_name  //客户端常规类型;
            var lenend2_obj = {};
            var initData = this.template_config.return_data.data;
            var colorList = ['#6ec71e','#4885FF']
            var datas = [
                {name:'PC客户端',value:this.template_config.return_data.sum_data.total_pc == null?0:this.template_config.return_data.sum_data.total_pc},
                {name:'移动客户端',value:this.template_config.return_data.sum_data.total_mobile == null?0:this.template_config.return_data.sum_data.total_mobile}
            ]
            var option = {
                backgroundColor:'#fff',
                title: {
                    text: that.formatCurrency(this.template_config.return_data.sum_data.total_req),
                    textStyle: {
                        color: '#484848',
                        fontSize: 17
                    },
                    subtext: '总请求数',
                    subtextStyle: {
                        color: '#717171',
                        fontSize: 15
                    },
                    itemGap: 20,
                    left: 'center',
                    top: '42%'
                },
                tooltip: {
                    trigger: 'item'
                },
                series: [{
                    type: 'pie',
                    radius: ['45%', '55%'],
                    center: ["50%", "50%"],
                    clockwise: true,
                    avoidLabelOverlap: false,
                    hoverOffset: 15,
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                position: 'outside',
                                color: '#666',
                                formatter: function(params) {
                                    var percent = 0;
                                    var total = 0;
                                    for (var i = 0; i < datas.length; i++) {
                                        total += datas[i].value;
                                    }
                                    if(params.name !== '') {
                                        return params.name + '\n' + '\n' + that.formatCurrency(params.value) + '/次';
                                    }else {
                                        return '';
                                    }
                                },
                            },
                            labelLine: {
                                length: 20,
                                length2: 10
                            },
                            color: function(params) {
                                return colorList[params.dataIndex]
                            }
                        }
                    },
                    data: datas
                },{
                    itemStyle: {
                        normal: {
                            color: '#F5F6FA',
                        }
                    },
                    type: 'pie',
                    hoverAnimation: false,
                    radius: ['42%', '58%'],
                    center: ["50%", "50%"],
                    label: {
                        normal: {
                            show:false
                        }
                    },
                    data: [],
                    z:-1
                }]
            }
            var lenend = [];
            var serData = [];
            for(var i = 0;i<initData.length; i++){
                for(var j in initData[i]){
                    source_name[j] = source_name[j]?source_name[j]:j
                    lenend.push(source_name[j])
                    serData.push({
                        name: source_name[j],
                        type: 'bar',
                        label:{
                            normal: { 
                                show: true, 
                                position: 'top', 
                                formatter:function(params){
                                    return params.data;
                                }
                            }
                        },
                        barMaxWidth:60,
                        data: [initData[i][j]?initData[i][j]:0]
                    })
                }
            }
            for (var i = 0; i < lenend.length; i++) {
                if (i > (this.is_compare?2:4)) {
                    lenend2_obj[lenend[i]] = false;
                } else {
                    lenend2_obj[lenend[i]] = true;
                }
            }
            var option2 = {
                backgroundColor:'#fff',
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { 
                        type: 'shadow' ,
                        textStyle: {
                            color: '#fff',
                            fontSize: '26'
                        },
                    }
                },
                legend: {
                    top:'0%',
                    data: lenend,
                    selected:lenend2_obj,
                    textStyle:{
                        fontSize:12,
                        color:'#808080'
                    },
                    icon:'rect'
                },
                grid: {
                    top:60,
                    left:60,
                    right:0,
                    bottom:50
                },
                xAxis: [{
                    type: 'category',
                    axisLabel:{
                        color:'#4D4D4D',
                        fontSize:14,
                        fontWeight:'bold'
                    },
                    data: [xAxixName],
                }],
                color:['#4fa8f9', '#6ec71e', '#f56e6a', '#fc8b40', '#818af8', '#31c9d7', '#f35e7a', '#ab7aee',
                '#14d68b', '#cde5ff'],
                yAxis: [{
                    type: 'value',
                    axisLine: {
                        show: false,
                    },
                    axisTick: {
                        show: false
                    },
                    splitNumber:4,   //y轴分割线数量
                    axisLabel:{
                        color:'#8C8C8C'
                    },
                    splitLine:{
                        lineStyle:{
                            type:'dashed'
                        }
                    }
                }],
                series: serData
            }
            // 是否对比
            if(this.is_compare){
                var compareData = this.template_config.return_data.compare_data;
                option2.xAxis[0].data.push(this.compare_time == 'yesterday'?'前一天(TOP'+(this.is_compare?3:5)+')':'上周同期(TOP'+(this.is_compare?3:5)+')');
                for(var i = 0; i<compareData.length; i++){
                    for(var j in compareData[i]){
                        if(serData[i]['name'] == source_name[j]){
                            serData[i]['data'].push(compareData[i][j] == null ?0:compareData[i][j])
                        }
                    }
                }
            }
            mdTotal.setOption(option);
            mdEchart.setOption(option2);
            var oop = lenend.slice(0, (this.is_compare?3:5));
            mdEchart.on('legendselectchanged', function (params) {
                var legend_option = this.getOption(),newAxisName = [];
                $.each(legend_option['xAxis'][0]['data'],function(index,item){
                    newAxisName.push(item.replace(/\([^\)]*\)/g,""))
                })
                legend_option['xAxis'][0]['data'] = newAxisName;
                
                var num = 0;
                for(var e in  params.selected){
                    if(params.selected.hasOwnProperty(e)){
                        params.selected[e]? num++ : '';
                    }
                }
                if(num > (that.is_compare?3:5)){
                    oop.push(params.name)
                }
                if (num > (that.is_compare?3:5)) {
                    var hah = oop.slice(oop.length - (that.is_compare?4:6), oop.length - (that.is_compare?3:4))[0] + '';
                    legend_option.legend[0].selected[hah] = false;
                }
                if (num < 1){
                    legend_option.legend[0].selected[params.name] = true;
                }
                this.setOption(legend_option)
            });
        }, 
        /**
         * @descripttion: 重置概览列表数据
         * @author: Lifu
         * @param {Array} msg 表格数据
         * @return viod
         */
        resetOverviewListData: function (msg) {
            var that = this;
            $('#overview_table').empty()
            bt_tools.table({
                el:'#overview_table',
                fid:'overview_table',
                height: '550px',
                load:true,
                tips:'正在获取概览列表',
                default:"概览列表为空", //数据为空时的默认提示
                data: msg.data,
                column:[
                    {fid: that.template_config.period_time === 'hour' ? 'time':'time1',title:'时间',width:100,template:function(row){
                        return '<span>'+ (that.template_config.period_time === 'hour' ? row.time : row.time1) +'</span>';
                    }},
                    {fid:'pv',title:'浏览量(PV)',template:function(row){
                        return '<span>'+that.formatCurrency(row.pv)+'</span>'
                    }},
                    {fid:'uv',title:'访客量(UV)',template:function(row){
                        return '<span>'+that.formatCurrency(row.uv)+'</span>'
                    }},
                    {fid:'ip',title:'IP数',template:function(row){
                        return '<span>'+that.formatCurrency(row.ip)+'</span>'
                    }},
                    {fid:'length',title:'流量',template:function(row){
                        return '<span>'+ToSize(row.length)+'</span>'
                    }},
                    {fid:'req',title:'请求',template:function(row){
                        return '<span>'+that.formatCurrency(row.req)+'</span>'
                    }},
                    {width:70,title:'40x',template:function(row){
                        var _text = '',sum = 0
                        _text+='时间：' + (that.template_config.period_time === 'hour' ? row.time : row.time1) + '\n\n'
                        $.each(row['40x'], function (item, index) {
                            sum += index
                            _text += item + '：' + that.formatCurrency(index) +'\n'
                        })
                        return '<span title="'+ _text +'">'+that.formatCurrency(sum)+'</span>'
                    }},
                    {width:70,title:'50x',template:function(row){
                        var _text = '',sum = 0
                        _text+='时间：' + (that.template_config.period_time === 'hour' ? row.time : row.time1) + '\n\n'
                        $.each(row['50x'], function (item, index) {
                            sum += index
                            _text += item + '：' + that.formatCurrency(index) +'\n'
                        })
                        return '<span title="'+ _text +'">'+that.formatCurrency(sum)+'</span>'
                    }},
                    {fid:'http_get',width:70,title:'GET',template:function(row){
                        return '<span>'+that.formatCurrency(row.http_get)+'</span>'
                    }},
                    {fid:'http_post',width:70,title:'POST',template:function(row){
                        return '<span>'+that.formatCurrency(row.http_post)+'</span>'
                    }},
                    {fid:'spider',width:70,title:'真蜘蛛',template:function(row){
                        return '<span>'+that.formatCurrency(row.spider)+'</span>'
                    }},
                    {fid:'fake_spider',width:70,title:'假蜘蛛',template:function(row){
                        return '<span>'+that.formatCurrency(row.fake_spider)+'</span>'
                    }},
                ],
                success:function(){
                    $('.not-select.cursor-pointer .glyphicon').hide();
                    $('.not-select.cursor-pointer.sort-active .glyphicon').show();
                    that.fixed_table('#overview_table', '550px');
                }
            });
        },
        /**
         * @descripttion: 重置概览数据
         * @author: Lifu
         * @param {Boolean} is_refresh 是否刷新
         * @param {Boolean} is_real 是否为实时数据
         * @return viod
         */
        resetOverviewData:function(is_refresh,is_real){
            var that = this,
                param = {
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    target:this.template_config.ov_trend_type,
                    time_scale:this.template_config.period_time,
                    request_in_panel:'True'
                }
            if(this.template_config.chart_list === 'list'){
                that.is_compare = false;
                that.compare_time = '';
                param['list_display'] = true
            }
            //实时流量/每秒请求
            if(is_real){  
                that.renderOverRealData();
                this.ov_set_time_out = setInterval(function(){
                    that.renderOverRealData()
                },3000)
                return 
            }
            // 刷新数据
            if(is_refresh){
                if(this.compare_time){  //比对
                    param['compare'] = true;
                    param['compare_date'] = this.compare_time;
                }
                this.http({
                    load:3,
                    type:'GET',
                    data:param,
                    method:'get_site_overview',
                    success: function (res) {
                        var totalView = [that.formatCurrency(res.sum_data.pv),that.formatCurrency(res.sum_data.uv),that.formatCurrency(res.sum_data.ip),res.sum_data.length,that.formatCurrency(res.sum_data.req),res.realtime_traffic.length != 0 ?res.realtime_traffic[0]['flow']:0,res.realtime_request.length != 0 ?res.realtime_request[0]['req']:0];
                        for(var i = 0; i<totalView.length; i++){
                            $('.total_num_box').eq(i).find('.tn_num').html(i == 3?ToSize(totalView[i]):(i==5?ToSize(totalView[i]):totalView[i]));
                        }
                        $('.total_num_box .tn_compare').addClass('compare_hide')
                        if(that.compare_time){
                            $('.total_num_box .tn_compare').removeClass('compare_hide')
                            var compareData = [that.formatCurrency(res.compare_sum_data.pv),that.formatCurrency(res.compare_sum_data.uv),that.formatCurrency(res.compare_sum_data.ip),res.compare_sum_data.length,that.formatCurrency(res.compare_sum_data.req)];
                            for(var i = 0; i<compareData.length; i++){
                                $('.total_num_box .tn_compare').eq(i).html(i == 3?ToSize(compareData[i]):compareData[i]);
                            }
                        }
                        that.template_config.return_data = res;
                        if(that.template_config.chart_list === 'list'){
                            that.resetOverviewListData(res)  //渲染列表
                        }else{
                            that.fillOverviewData()
                        }
                        if(that.is_manual){
                            that.is_manual = false;
                            layer.msg('刷新成功',{icon:1})
                        }
                    }
                })
                return
            }
            
            that.fillOverviewData()
        }, 
        /**
         * @descripttion: 重置蜘蛛/客户端统计
         * @author: Lifu
         * @param {Boolean} is_refresh 是否刷新
         * @param {Boolean} type 类型为蜘蛛或者客户端
         * @return viod
         */
        resetZzorMdDataInfo:function(is_refresh,type){
            var that = this,
                param = {
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    target:'top',
                    time_scale:'day',
                    request_in_panel:'True'
                }
            if(is_refresh){
                if(this.compare_time){  //比对
                    param['compare'] = true;
                    param['compare_date'] = this.compare_time;
                }
                var loadT = layer.msg('正在获取'+(type == 'zhizhu_total'?'蜘蛛统计数据':'客户端数据')+'中，请稍候。。。', { icon: 16, time: 0, shade: [0.3, '#000'] });
                this.http({
                    load:3,
                    type:'GET',
                    data:param,
                    method:type == 'zhizhu_total'?'get_spider_stat':'get_client_stat',
                    success: function (res) {
                        layer.close(loadT)
                        that.template_config.return_data = res;
                        if(type == 'zhizhu_total'){
                            var percent = (res.sum_data.spider_total/res.sum_data.total_req)*100,
                                occupy = '('+(isNaN(percent)?0:parseInt(percent))+'%)',
                                totalView = [that.formatCurrency(res.sum_data.spider_total)+occupy,that.formatCurrency(res.sum_data.fake_spider),that.formatCurrency(res.sum_data.total_req)];
                            for(var i = 0; i<totalView.length; i++){
                                $('.total_left_box .total_num_box').eq(i).find('.tn_num').html(totalView[i]);
                            }
                            that.renderZzEchart()
                        }else{
                            that.renderMdEchart()
                        }
                    }
                })
                return
            }
            type == 'zhizhu_total'?that.renderZzEchart():that.renderMdEchart();
        },
        // 填充概览数据
        fillOverviewData:function(){
            var that = this,data = {};
            // 默认数据
            var ov_trend_data =  this.resetApiFormat(this.template_config.return_data.query_date.split('-'),this.template_config.return_data.data)
            var trend_name = this.template_config.ov_indicators_label[this.template_config.ov_trend_type]
            var one_trend_name = this.is_compare?(this.template_config.query_text.length >10?this.template_config.query_text:this.template_config.time_cycle[this.template_config.query_text]):trend_name;
            
            //tooltip
            data['tooltip'] = {
                trigger: 'axis',
                backgroundColor: 'rgba(255,255,255,0.8)',
                axisPointer: { // 坐标轴指示器，坐标轴触发有效
                    type: 'line', // 默认为直线，可选为：'line' | 'shadow'
                    lineStyle: {
                        color: 'rgba(150,150,150,0.2)'
                    }
                },
                textStyle: {
                    color: '#666',
                    fontSize: '14px',
                },
                extraCssText: 'width:220px;height:'+(that.is_compare?'30%':'22%')+';padding:0;box-shadow: 0 0 3px rgba(0, 0, 0, 0.3);"',
                formatter: function (params) {
                    var htmlStr = "";
                    for (var i = 0; i < params.length; i++) {
                        var tem = params[i].name;
                        var val = params[i].value;
                        if(that.template_config.period_time == 'hour'){
                            if (tem.indexOf('/') < 0) {
                                tem > 9 ? tem = tem + ":00 - " + tem + ":59" : tem = "0" + tem + ":00 - " +
                                    "0" + tem + ":59";
                            }
                            val > 0 ? val = val : val = '--'
                        }
                        
                        htmlStr +=
                            '<div style="height:26px;line-height:26px;overflow:hidden;padding:6px 8px;">' +
                            '<span style="float:left;max-width:160px;overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">' +
                            '<span style="margin-right:5px;display:inline-block;width:10px;height:10px;border-radius:5px;background-color:' +
                            params[i].color + ';"></span>' + params[i].seriesName + '</span>' +
                            '<span style="float:right">' + val + '</span>' + '</div>'
                    }
                    var res ='<div><div style="height:40px;line-height:40px;padding:0 8px;background:rgba(237,233,233,0.4)">' +
                        tem + '<span style="float:right;">' + (that.is_compare?trend_name:'') +
                        '</span>' + htmlStr + '</div></div>'
                    return res;
                }
            }
            
            //legendData
            data['legendData'] = [one_trend_name]
    
            //xAxisData
            data['xAxisData'] = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14','15', '16', '17', '18', '19', '20', '21', '22', '23']
            
            //yAxis
            data['yAxis'] = [{
                type: 'value',
                splitNumber: 5,
                axisLabel: {
                    textStyle: {
                        color: '#a8aab0',
                        fontStyle: 'normal',
                        fontFamily: '微软雅黑',
                        fontSize: 12,
                    },
                },
                axisLine:{
                    show: false
                },
                axisTick:{
                    show: false
                },
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: '#E5E9ED'
                    }
                }
            }]
            
            //serData
            data['serData'] = [{
                name:one_trend_name,
                type:'line',
                smooth: true, 
                itemStyle: {
                    normal: {
                        color:'#3A84FF',
                        lineStyle: {
                            color: "#3A84FF",
                            width:1,
                        },
                        areaStyle: { 
                            color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
                                offset: 0,
                                color: 'rgba(58,132,255,0)'
                            }, {
                                offset: 1,
                                color: 'rgba(58,132,255,0.35)'
                            }]),
                        }
                    }
                },
                data: this.transformDataTotal(ov_trend_data)
            }];
            
            // 是否对比
            if(this.is_compare){
                var contrastCycle = this.resetApiFormat(this.template_config.return_data.compare_date.split('-'),this.template_config.return_data.compare_data)
                data['serData'].push({
                    name:this.compare_time == 'yesterday'?'前一天':'上周同期',
                    type:'line',
                    smooth: true, 
                    itemStyle: {
                        normal: {
                            barBorderRadius: 2,
                            color:'#b9dcfd',
                            lineStyle: {
                                color: "rgb(185, 220, 253)",
                                width:1
                            },
                            areaStyle: { 
                                color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
                                    offset: 0,
                                    color: 'rgb(185, 220, 253,0.6)'
                                }, {
                                    offset: 1,
                                    color: 'rgb(185, 220, 253,0.3)'
                                }])
                            }
                        }
                    },
                    data: this.transformDataTotal(contrastCycle)
                })
                data['legendData'].push(this.compare_time == 'yesterday'?'前一天':'上周同期')
            }
            if(this.template_config.period_time == 'day'){
                var xTitle = [],daySerData = [],reg = /^(\d{4})(\d{2})(\d{2})$/
                ov_trend_data.forEach(function (item) {
                    daySerData.push(item[that.template_config.ov_trend_type])
                    xTitle.push(item['time'].toString().replace(reg,"$1/$2/$3"))
                })
                data['serData'][0].data = daySerData
                data['xAxisData'] = xTitle
            }
            // 渲染到概览
            this.renderOverEchart(data);
        },
        // 渲染实时模板
        renderOverRealData:function(){
            var that = this,
                data = {},
                param = {
                    site:this.template_config.site_name,
                    query_date:this.template_config.query_text,
                    target:this.template_config.ov_trend_type,
                    request_in_panel:'True'
                };
            this.http({
                load:3,
                type:'GET',
                data:param,
                method:'get_site_overview',
                success: function (res) {
                    if(that.is_manual){
                        that.is_manual = false;
                        layer.msg('刷新成功',{icon:1})
                    }
                    var d = new Date()
                    if(that.serviceData.length >= 8)that.serviceData.splice(0, res[that.realtime_type].length == 0?1:res[that.realtime_type].length);
                    if(that.xAxisRealTimeArr.length >= 8)that.xAxisRealTimeArr.splice(0,res[that.realtime_type].length == 0?1:res[that.realtime_type].length);
                    var unit_size = 1024;
                    if(res[that.realtime_type].length == 0){
                        that.serviceData.push(0)
                        that.xAxisRealTimeArr.push(d.getHours() + ':' + d.getMinutes() + ':' + d.getSeconds());
                    }else{
                        for(var i = 0; i<res[that.realtime_type].length; i++){
                            var serData = res[that.realtime_type][i][that.realtime_type == 'realtime_traffic'?'flow':'req']
                            if(that.realtime_type == 'realtime_traffic'){
                                switch(that.traffic_unit){
                                    case 'MB/s':
                                        unit_size = 1024*1024;
                                        break;
                                    case 'GB/s':
                                        unit_size = 1024*1024*1024;
                                        break;
                                    default:
                                        unit_size = 1024;
                                }
                                serData = serData/unit_size
                            }
                            that.serviceData.push(serData)
                            that.xAxisRealTimeArr.push(bt.format_data(res[that.realtime_type][i]['timestamp'],'hh:mm:ss'));
                        }
                    }
                    var totalView = [that.formatCurrency(res.sum_data.pv),that.formatCurrency(res.sum_data.uv),that.formatCurrency(res.sum_data.ip),res.sum_data.length,that.formatCurrency(res.sum_data.req),res.realtime_traffic.length != 0 ?res.realtime_traffic[0]['flow']:0,res.realtime_request.length != 0 ?res.realtime_request[0]['req']:0];
                    for(var i = 0; i<totalView.length; i++){
                        $('.total_num_box').eq(i).find('.tn_num').html(i == 3?ToSize(totalView[i]):(i==5?ToSize(totalView[i]):totalView[i]));
                    }
                    data['tooltip'] = {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'line'
                        },
                        extraCssText: 'background: #fff; border-radius: 0;box-shadow: 0 0 3px rgba(0, 0, 0, 0.2);color: #777;',
                        formatter:function(config){
                            var _config = config,_tips = '';
                            for(var i=0;i<config.length;i++){
                                _tips +=  '<span style="display: inline-block;width: 10px;height: 10px;margin-rigth:10px;border-radius: 50%;background: '+ config[i].color +';"></span>  '+ config[i].seriesName +'：'+(that.realtime_type == 'realtime_traffic'?config[i].data.toFixed(2) + that.traffic_unit:config[i].data)  + ( config.length-1 !== i?'<br />':'')
                            }
                            return "时间："+ _config[0].axisValue +"<br />" + _tips;
                        }
                    }
                    data['xAxisData'] = that.xAxisRealTimeArr
                    data['yAxis'] = [{
                        type: 'value',
                        splitNumber: 5,
                        axisLabel: {
                            textStyle: {
                                color: '#a8aab0',
                                fontStyle: 'normal',
                                fontFamily: '微软雅黑',
                                fontSize: 12,
                            },
                        },
                        min:0,
                        axisLine:{
                            show: false
                        },
                        axisTick:{
                            show: false
                        },
                        splitLine: {
                            show: true,
                            lineStyle: {
                                color: '#E5E9ED'
                            }
                        }
                    }]
                    data['serData'] = [{
                        name: (that.realtime_type=='realtime_traffic'?'实时流量':'每秒请求'),
                        type:'line',
                        smooth: true, 
                        itemStyle: {
                            normal: {
                                color:'#3A84FF',
                                lineStyle: {
                                    color: "#3A84FF",
                                    width:1,
                                },
                                areaStyle: { 
                                    color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
                                        offset: 0,
                                        color: 'rgba(58,132,255,0)'
                                    }, {
                                        offset: 1,
                                        color: 'rgba(58,132,255,0.35)'
                                    }]),
                                }
                            }
                        },
                        data: that.serviceData
                    }]
                    that.renderOverEchart(data)
                }
            })
        },
        // 创建实时流量单位
        create_traffic_unit:function(){
            var that = this;
            $('.traffic-unit').empty();
            $('.traffic-unit').html('<span class="tu-name">单位:</span><div class="traffic-unit-content">'+
                '<div class="tu-box"><span class="tu-text">'+this.traffic_unit+'</span><span class="down-select-full"></span></div>'+
                '<div class="tu-list"><ul><li data-attr="KB/s">KB/s</li><li data-attr="MB/s">MB/s</li><li data-attr="GB/s">GB/s</li></ul></div></div>')
            $('.tu-list li:contains('+this.traffic_unit+')').addClass('active');
            // 单位开关
            $(".traffic-unit-content").on('click','.tu-box',function(e){
                $(this).next().toggle();
                $(document).one('click',function(){
                    $('.tu-list').hide();
                })
                e.stopPropagation();
            })
            //单位选中
            $(".traffic-unit-content").on('click','.tu-list li',function(e){
                $(this).addClass('active').siblings().removeClass('active');
                that.traffic_unit = $(this).data('attr');
                $('.tu-text').html($(this).data('attr'));
                clearInterval(that.ov_set_time_out)   //实时
                clearInterval(that.automatic_loading)  //自动刷新
    
                that.serviceData = []
                that.xAxisRealTimeArr = []
                if(that.is_autorefresh){
                    that.resetOverviewData(false,true);
                }else{
                    that.renderOverRealData();
                }
            })
        },
        /**
         * @descripttion: 重置视图模板
         * @author: Lifu
         * @param {Boolean} is_reset 是否重置蜘蛛/客户端
         * @return viod
         */
        resetViewTemplate:function(is_reset){
            var that = this;
            this.refersh_page = true;   //网站日志/错误日志刷新自定义分页
            this.is_logpage_change = {}   //切换栏目时清空分页选中参数
            switch(this.template_config.menu_type){
                case 'overview':
                    this.realtime_type = '';
                    clearInterval(this.ov_set_time_out)   //实时
                    clearInterval(this.automatic_loading)  //自动刷新
                    
                    this.resetOverviewData(true);
                    break;
                case 'zhizhu_total':
                case 'client_total':
                    if(is_reset){
                        $('#md_table,#zz_table').empty();
                        this.template_config.menu_type == 'zhizhu_total'? this.get_zhizhu_table_list():this.get_client_table_list();
                    }else{
                        this.resetZzorMdDataInfo(true,this.template_config.menu_type);
                    }
                    break;
                case 'ip_total':
                case 'uri_total':
                case 'referer_stat':
                    $('#access_total_table').empty()
                    this.get_access_list_table();
                    break;
                case 'uri_alone_stat':
                    $('#access_total_table').empty()
                    this.set_uri_alone_stat();
                    break;
                case 'site_list':
                    $('#site_table').empty()
                    this.get_site_list();
                    break;
                case 'site_log':
                    this.site_log_page_num = 1;
                    $('#sitelog_table').empty()
                    this.get_site_log(function(param){
                        that.get_page_info(param);
                    });
                    break;
                case 'error_log':
                    this.err_log_page_num = 1;
                    $('#error_log_table').empty();
                    this.get_error_log(function(param){
                        that.get_page_info(param);
                    });
                    break;
                case 'total_report':
                    this.set_total_report(new Date().getFullYear());
                    this.template_config['report_query_text'] = new Date().getFullYear();   //切换站点后重置统计报告时间
                    break;
            }
            
            if(this.template_config.query_text != 'l7' && this.template_config.query_text != 'l30'){
                $('.search-day,.time_contrast').removeClass('bt-disabled')
                $('.last-span input').attr("disabled",false)
            }
        },
        /**
         * @descripttion: 渲染后端返回的总页数拼接分页样式
         * @author: Lifu
         * @param {Number} total 总页数 
         * @param {Number} config 分页配置
         * @return 完整的分页html
         */
        render_custom_page:function(total,config){
            var html = '<div class="page">',
                page = Math.ceil(total / config.number),
                tmpPageIndex = 0;
            if(config.page > 1 && page > 1){
                html += '<a class="Pstart" href="p=1">首页</a><a class="Pstart" href="p='+ (config.page -1) +'">上一页</a>';
            }
            if(page <= 6){
                for (var i = 1; i <= page; i++){
                    i == config.page ? html += '<span class="Pcurrent">' + i + "</span>": html += '<a class="Pnum" href="p=' + i + '">' + i + "</a>";
                }
            }else if (config.page < 6) {
                for (var i = 1; i <= 6; i++) i == config.page ? html += '<span class="Pcurrent">' + i + "</span>": html += '<a class="Pnum" href="p=' + i + '">' + i + "</a>";
                html += "<span>...</span>"
            } else if (page - config.page < 6) {
                page - 6 > 1 && (html += '<a class="Pnum" href="p=1">1</a>', html += "<span>...</span>");
                for (var i = page - 6; i <= page; i++) i == config.page ? html += '<span class="Pcurrent">' + i + "</span>": (html += 1 == i ? "<span>...</span>": '<a class="Pnum" href="p=' + i + '">' + i + "</a>")
            } else {
                0 == tmpPageIndex && (tmpPageIndex = config.page),
                (tmpPageIndex <= config.page - 5 || tmpPageIndex >= config.page + 5) && (tmpPageIndex = config.page),
                html += '<a class="Pnum" href="p=1">1</a>',
                html += "<span>...</span>";
                for (var i = tmpPageIndex - 2; i <= tmpPageIndex + 2; i++) i == config.page ? html += '<span class="Pcurrent">' + i + "</span>": html += '<a class="Pnum" href="p=' + i + '">' + i + "</a>";
                html += "<span>...</span>",
                html += '<a class="Pnum" href="p=' + page + '">' + page + "</a>"
            }
            return page > 1 && config.page < page && (html += '<a class="Pstart" href="p=' + (config.page + 1) + '">下一页</a><a class="Pstart" href="p=' + page + '">尾页</a>'),html += '<span class="Pcount">共' + total + '条</span><div class="page_jump_box"><span class="page_jump_title">跳转到</span><input type="number" value="'+config.page+'" name="page_jump_num" style="width: 40px;text-align: center;float: left;"><span class="page_jump_title">页</span> <button type="button" class="page_jump_btn">确认</button></div></div>'
        },
        /**
         * @descripttion: 重置图表数据  【计算周期内的时间段，静态生成的数据和后端返回的数据合并】
         * @author: Lifu
         * @param {Array} timeCycle 时间周期 
         * @param {Array} tData 后端返回的数据
         * @return 完整的周期数据【后端没返回的默认创建空数据】
         */
        resetApiFormat:function(timeCycle,tData){
            var start = this.transformTime(timeCycle[0]);
            var end = this.transformTime(timeCycle[1], ':59:59');
            var hour = Math.ceil((end - start) / (60 * 60 * 1000))
            var day = Math.ceil((end - start) / (60 * 60 * 1000 * 24))
            var tempArr = [];
            if(day > 7){
                // 天数大于7不进行对比
                $('.time_contrast').addClass('bt-disabled');
            }
            for (var i = 0; i < day; i++) {
                var startDate = new Date(start + (i * 1 * 24 * 60 * 60 * 1000))
                var month = startDate.getMonth() + 1
                var dateStr = startDate.getFullYear().toString()+ (month >= 10 ? month : '0' + month)+ (startDate.getDate() >= 10 ? startDate.getDate() : '0' + startDate.getDate()).toString()
                if(this.template_config.period_time == 'hour'){
                    for (var j = 0; j < 24; j++) {
                        var hourStr = j >= 10 ? j : "0" + j
                        tempArr.push({
                            "time": parseInt(dateStr + hourStr),
                            "req": 0,
                            "pv": 0,
                            "uv": 0,
                            "ip": 0,
                            "length": 0
                        })
                    }
                }else{
                    tempArr.push({
                        "time":parseInt(dateStr),
                        "req": 0,
                        "pv": 0,
                        "uv": 0,
                        "ip": 0,
                        "length": 0
                    })
                }
            }
            for (var i = 0; i < tData.length; i++) {
                for (var j = 0; j < tempArr.length; j++) {
                    if (tData[i].time == tempArr[j].time) {
                        tempArr[j] = tData[i]
                    }
                }
            }
            return tempArr
        },
        /**
         * @descripttion: 时间转换  【转换后端返回的时间格式[2021033000 此格式专用]】
         * @author: Lifu
         * @param {String} str 时间 
         * @param {Array} time 具体的分钟/秒格式
         * @return 时间戳
         */
        transformTime:function(str, time) {
            time = time || ':00:00';
            var temp = str;
            var arr3 = [];
            for (var i = 0; i < 3; i++) {
                arr3.unshift(temp.substr(temp.length - 2, temp.length))
                temp = temp.substr(0, temp.length - 2)
            }
            arr3.unshift(temp)
            var dateStr = ''
            for (var i = 0; i < 3; i++) {
                if (i == 2) {
                    dateStr += arr3[i] + ' '
                } else {
                    dateStr += arr3[i] + '-'
                }
            }
            dateStr += arr3[arr3.length - 1] + time
            return new Date(dateStr).getTime()
        },
        /**
         * @descripttion: 数据总汇  【根据最后两位数求和（小时），并排序时间】
         * @author: Lifu
         * @param {Array} arry 数据
         * @return 整理后的数据格式
         */
        transformDataTotal:function(arry){
            var total = [],sortNum = [],str = {},trendType = this.template_config.ov_trend_type;
            for(var i = 0; i < arry.length; i++){  
                // 取最后两位数相同的求和
                var itemHour = arry[i].time.toString().substr((arry[i].time.toString().length - 2), arry[i].time.toString().length)
                if(str[itemHour]){
                    str[itemHour][trendType] = str[itemHour][trendType]+arry[i][trendType]
                }else{
                    str[itemHour] = {};
                    str[itemHour][trendType] = arry[i][trendType]
                }
            }
            // 取时间排序
            for(var k in str){
                sortNum.push(k)
            }
            // 调整排序
            for(var j = 0; j<sortNum.length; j++){
                for(var s = 0; s<sortNum.length - 1 - j; s++){
                    if(parseInt(sortNum[s+1]) < parseInt(sortNum[s])){
                        var temp = sortNum[s+1];
                        sortNum[s+1] = sortNum[s];
                        sortNum[s] = temp;
                    }
                }
            }
            // 生成正确的排列循序
            sortNum.forEach(function (item) {
                total.push(str[item][trendType])
            })
            return total;
        },
        // 自定义时间清空事件
        onchangeLaydateEmpty:function(){
            $('.search-day span').eq(0).addClass('cur').siblings().removeClass("cur");
            this.template_config.query_text = 'today';
            this.resetViewTemplate()
        },
        // 初始化菜单栏
        initMenuConfig:function(){
            var target = ''
            clearInterval(this.ov_set_time_out)   //实时
            clearInterval(this.automatic_loading)  //概览自动刷新
            this.compare_time = ''     //对比时间
            this.is_compare = false;   //是否对比
            this.realtime_type = '';   //取消实时类型
            // $('.conter_box').empty();    
            switch(this.template_config.menu_type){
                case 'overview':
                    target = 'pv';
                    this.compare_time = 'yesterday'  //对比时间
                    this.is_compare = true;          //是否对比
                    this.template_config.period_time = 'hour'; // 时段：按时
                    this.template_config.chart_list = 'chart'; // 图表显示
                    break;
                case 'zhizhu_total':
                    target = 'baidu';
                    break;
            }
            this.template_config['ov_trend_type'] = target;     //默认请求字段类型
            this.template_config['query_text'] = 'today'        //默认请求时间
            this.template_config['filter_value'] = {};          //网站日志url查询
            this.template_config['report_query_text'] = new Date().getFullYear();   //切换栏目后重置统计报告时间
            this.template_config['referer_type'] = 'request'    //来源类型

            this.site_log_page_num = 1;
            this.err_log_page_num = 1;
            this.template_config.default_error_type ='all'
            this.template_config.code_type ='all'
            this.template_config.req_type ='all'
            this.template_config.zhizhu_type ='normal'
            if(this.template_config.menu_type === 'overview' && this.template_config.chart_list === 'list'){
                this.is_compare = false;
                this.compare_time = '';
            }
        },
        /**
         * @descripttion: 千位分割  三位数以上以逗号分割 【数字为空/null 默认设置为0】
         * @author: Lifu
         * @param {String} num 数字
         * @return 分割后的数字
         */
        formatCurrency:function(num) {
            if(isNaN(num) || num == null) num = "0";
            num = num.toString().replace(/\$|\,/g,'');
                
            sign = (num == (num = Math.abs(num)));
            num = Math.floor(num*100+0.50000000001);
            num = Math.floor(num/100).toString();
            for (var i = 0; i < Math.floor((num.length-(1+i))/3); i++)
            num = num.substring(0,num.length-(4*i+3))+','+
            num.substring(num.length-(4*i+3));
            return (((sign)?'':'-') + num);
        },
        /** 耗时转换 **/
        elapsed_time_size:function(ctime){
            if(isNaN(ctime) || ctime == null) ctime = 0;
            if(ctime <= 999) return ctime+'ms';
    
            var _ctime = parseInt(ctime) / 1000;  //转换为秒
            _ctime = _ctime.toFixed(2);
            if(_ctime < 60){
                return _ctime +'s'
            }else if(_ctime >= 60 && _ctime <= 3600){
                var val = _ctime/60,arr = val.toString().split('.');
                return !arr[1]?val+'min':(val).toFixed(3) +'min'
            }else{
                var val = _ctime/60/60,arr = val.toString().split('.');
                return !arr[1]?val+'h':(val).toFixed(3) +'h'
            }
    
        },
        // 编码转换
        escapeHTML:function(val) {
            val = "" + val;
            return val.replace(/&/g, "&amp;").replace(/\>/g, "&gt;").replace(/</g, "&lt;").replace(/"/g, '&quot;').replace(/'/g, "‘").replace(/\(/g, "&#40;").replace(/\&#60;/g, "&lt;").replace(/\&#62;/g, "&gt;").replace(/`/g, "&#96;").replace(/=/g, "＝");
        },
        // 行内模拟事件绑定
        event: function (el) {
            var that = this;
            _html = $('#site_monitoring_statistics')[0].innerHTML, event_list = {};
            if (el != undefined) _html = $(el)[0].innerHTML;
            _reg = new RegExp(/bt-event-(click|change|focus)="([a-z0-9A-Z]+)\|*([a-z0-9A-Z]*)"/g);
            _html.replace(_reg, function ($1, $2, $3, $4) {
                if (!event_list[($2)]) {
                    if ($4 != "") {
                        $('[' + $1 + ']').unbind($2).on($2, $4, function (ev) {
                            that.methods[$3].apply(this, [ev, $(this).index]);
                        });
                    } else {
                        $('[' + $1 + ']').unbind($2).on($2, function (ev) {
                            that.methods[$3].apply(this, [ev]);
                        });
                    }
                    event_list[$3] = true;
                }
            });
        },
        // 模板渲染
        renderTemplate:function(obj, callback) {
            if (!obj.html) return '缺少模板HTML';
            var re = /<%([^%>]+)?%>/g, reExp = /(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g, code = 'var r=[];\n',
                cursor = 0;
            var add = function (line, js) {
                js ? (code += line.match(reExp) ? line + '\n' : 'r.push(' + line + ');\n') :
                    (code += line != '' ? 'r.push("' + line.replace(/"/g, '\\"') + '");\n' : '');
                return add;
            }
            while (match = re.exec(obj.html)) {
                add(obj.html.slice(cursor, match.index))(match[1], true);
                cursor = match.index + match[0].length;
            }
            add(obj.html.substr(cursor, obj.html.length - cursor));
            code += 'return r.join("");';
            if (callback) {
                callback(new Function(code.replace(/[\r\t\n]/g, '')).apply(obj.data));
            } else {
                return new Function(code.replace(/[\r\t\n]/g, '')).apply(obj.data);
            }
        },
		/**
		 * 获取滚动条的宽度
		 */
		setScrollWidth: function (el) {
			setTimeout(function () {
				var scroll = $(el + ' .thead_div')[0];
				if (!scroll) return;
				var scrollIn = $(el + ' .tbody_div .table')[0];
				var scrollWidth = scroll.offsetWidth;
				var scrollInWidth = scrollIn.offsetWidth;
				var width = scrollWidth - scrollInWidth + 8;
				$(el + ' .thead_div thead tr th:last-of-type').css('padding-right', width + 'px');
			});
		},
		/**
		 * @descripttion: 固定表头 
		 */
		fixed_table: function (el, height) {
			$(el + ' .divtable').css({
				'overflow': 'auto',
				'border': '.5px solid #ddd',
				'max-height': height
			});
			$(el + ' .divtable .table').css({
				border: 'none'
			});
			$(el + ' .divtable').bind('scroll', function () {
				var scrollTop = this.scrollTop;
				$(this).find("thead").css({
					"transform": "translateY(" + scrollTop + "px)",
					"position": "relative",
					"z-index": "1"
				});
			});
		},
        /**
            * 动态处理请求，设置全局ajaxList，api和提示语，遍历请求返回成功值
            * @param {string} config 需要请求的api
            * @param {Function} data 请求参数
            * @param {Function} success 成功值
            * @param {Function} error 失败值
        */
        ajaxTask: function (config,data,success,error) {
            if(typeof config == "string"){
                if(typeof data == "object"){
                    config = {method:config,data:data,success:success,error:error}
                }else if(typeof data == "function"){
                    config = { method:config,success:data}
                    if(typeof success == "function" ){
                        config.error = success
                    }
                }
            }else{
                config = {method:config.method,data:data,success:success,error:error,check:config.check}
            }
            if (config.middle === false) {config.success();return false}
            this.http({
                tips: '正在' + this.ajaxList[config.method] + ',请稍侯...',
                method: config.method,
                data: config.data || {},
                success: function (rdata) {
                    if (config.success) config.success(rdata);
                },
                error: function (rdata) {
                    if (config.error) config.error(rdata);
                },
                check:config.check == true?true:false
            });
        },
        // 请求封装
        http: function (obj) {
            var loadT = '';
            if (obj.load == undefined) obj.load = 0;
            if (obj.url == undefined) {
                if (obj.plugin_name === undefined && this.plugin_name !== undefined) obj.plugin_name = this.plugin_name
                if (!obj.plugin_name || !obj.method) {
                    layer.msg('插件类名称，或插件方法名称缺失!', {icon: 2 });
                    return false;
                }
            }
            if (obj.load === 0 || obj.tips != undefined) {
                loadT = layer.msg(obj.tips, {icon: 16,time: 0, shade: 0.1});
            } else if (obj.load === 1 || (obj.tips == undefined && obj.load == undefined)) {
                loadT = layer.load();
            }
            $.ajax({
                type: 'POST',
                url: obj.url != undefined ? obj.url : ('/plugin?action=a&name=' + obj.plugin_name + '&s=' + obj.method),
                data: obj.data || {},
                timeout: obj.timeout || 99999999,
                complete: function (res) {
                    if (obj.load === 0 || obj.load === 1) layer.close(loadT);
                },
                success: function (rdata) {
                    if (obj.check) {
                        obj.success(rdata);
                        return
                    }
                    if (typeof rdata.status !== 'undefined' && rdata.status === false) {
                        layer.msg(rdata.msg, {icon: 2});
                        return false;
                    }
                    obj.success(rdata);
                },
                error: function (ex) {
                    if (!obj.error) {
                        obj.msg || obj.msg == undefined ? layer.msg('请求过程发现错误!', {icon: 2}) : '';
                        return;
                    }
                    return obj.error(ex);
                }
            });
        }
    }
    
    setTimeout(function(){
        $('.layui-layer-page').width(1050).css({   //设置最外层弹窗大小
            'left':(document.body.clientWidth-1050)/2+'px'
        })
        
        //加载模板
        site_monitoring_statistics.template_config.return_data = site_monitoring_statistics.default_data_config
        site_monitoring_statistics.renderTemplate({
            html: template_html.innerHTML,
            data: site_monitoring_statistics.template_config
        }, function (html) {
            $('.conter_box').html(html);
        })
    },1);
    jQuery.ajax({
        url: "/static/js/echarts.min.js",
        dataType: "script",
        cache: true
    }).done(function() {
        site_monitoring_statistics.init();
    });
    
    //问卷调差视图
	function open_waf_qa_view(){
	    if($('.nps_survey').length >= 1) return false;  //防止多层
	    layer.open({
	        type:1,
	        title:false,
	        btn:false,
	        area:'578px',
	        skin:'nps_survey',
	        closeBtn: 2,
	        content:'<div class="nps_survey_box" style="overflow: hidden;">\
	           <div class="nps_survey_banner">\
	                <span>\
	                    <i></i>\
	                    <span style="vertical-align: 4px;">网站监控报表NPS问卷问题</span>\
	                </span>\
	           </div>\
	           <div style="padding:30px 40px 65px">\
    	           <div class="nps_survey_score">\
    	                <div class="survey_title">您向朋友或同事推荐网站监控报表的可能性有多大？</div>\
                    <ul class="survey_score_num small">\
                        <li data-content="0">0</li>\
                        <li data-content="1">1</li>\
                        <li data-content="2">2</li>\
                        <li data-content="3">3</li>\
                        <li data-content="4">4</li>\
                        <li data-content="5">5</li>\
                        <li data-content="6">6</li>\
                    </ul>\
                    <ul class="survey_score_num medium">\
                        <li data-content="7">7</li>\
                        <li data-content="8">8</li>\
                    </ul>\
                    <ul class="survey_score_num large">\
                        <li data-content="9">9</li>\
                        <li data-content="10">10</li>\
                    </ul>\
    	           </div>\
    	           <div class="nps_survey_content hide">\
    	                <div class="nps_survey_line">\
    	                    <span class="nps_survey_title">1.当初购买网站监控报表是解决<b>什么问题</b>？是否解决了？</span>\
    	                    <p>如：购买时是想对网站的异常访问数据分析</p>\
    	                    <input type="text" name="problem_one">\
    	                </div>\
    	                <div class="nps_survey_line">\
    	                    <span class="nps_survey_title">2.您在使用网站监控报表中出现<b>最多的问题</b>是什么?</span>\
    	                    <p>如：没有办法分析到我想要的数据（展示说说您想要什么数据）</p>\
    	                    <input type="text" name="problem_two">\
    	                </div>\
    	                <div class="nps_survey_line">\
    	                    <span class="nps_survey_title">3.谈谈您对网站监控报表的<b>建议</b>。</span>\
    	                    <p>如：我希望网站监控报表能分析更多数据，这些数据是什么？</p>\
    	                    <input type="text" name="problem_three">\
    	                </div>\
                        <div class="score_title"><span>我们特别重视您的回答，这将帮助到其他用户更好的使用网站监控报表</span></div>\
    	                <button class="btn btn-success set_survey_info pull-right" style="margin: 5px 190px;padding: 6px 40px;">提交</button>\
    	           </div>\
    	       </div>\
	        </div>\
	        <style>\
            .nps_survey_banner{position: relative;background: url(/total/static/feedback/QA_banner.png);width:100%;background-size: 100%;height: 92px;margin-top: -1px;}\
	        .nps_survey_banner>span{position: absolute;left: 32px;top: 16px;font-size: 17px;color: #fff;}\
	        .nps_survey_banner i{background-image: url(/static/images/svg/logo-white.svg);background-repeat: no-repeat;background-size: 18px;display: inline-block;width: 20px;height: 20px;}\
	        .survey_title {font-size: 19px;font-weight: bold;text-align: center;color: #000;}\
	        .score_title{font-size:13px;color:#20a53a;text-align:center;line-height: 35px;}\
	        .nps_survey_score ul{position: relative;margin-top:25px;display: inline-block;border: 1px solid #ccc;border-radius: 2px;font-size:0}\
            .survey_score_num::before {content: "";height: 35px;width: 100%;display: inline-block;position: absolute;bottom: -37px;}\
            .nps_survey_score ul.small::before{background:linear-gradient(to bottom,#ffdfdd,#fff)}\
            .nps_survey_score ul.medium::before{background:linear-gradient(to bottom,#fff2db,#fff);}\
            .nps_survey_score ul.large::before{background:linear-gradient(to bottom,#ebf9e0,#fff)}\
            .survey_score_num.small::after {content: "不可能推荐";position: absolute;top: 48px;left: 117px;font-size: 12px;}\
            .survey_score_num.medium::after {content: "可能推荐";position: absolute;top: 48px;left: 18px;font-size: 12px;}\
            .survey_score_num.large::after {content: "一定推荐";position: absolute;top: 48px;left: 18px;font-size: 12px;}\
            .survey_score_num li {position: relative;display: inline-block;width: 42px;height: 42px;line-height: 42px;text-align: center;font-size:15px;font-weight: bold;}\
            .survey_score_num .act::before {content: attr(data-content);color: #fff;height: 52px;line-height: 52px;width: 100%;position: absolute;top: -5px;font-size: 19px;background: inherit;border-radius: 4px;font-weight: initial;}\
            .survey_score_num li::before{content:"";position: absolute;right: 0;top:5px;border-right-style: solid;border-right-width: 1px;border-color: rgb(255 255 255 / 30%);height: 25px;}\
            .survey_score_num li:last-child::before{border:none}\
            .survey_score_num.small{border-color: #f3a8a5;background: #f7cfce;color: #ed6d68;}\
            .survey_score_num.medium{border-color: #f4cf8f;background: #fbe6c0;color: #f7be56;margin: 0 5px;}\
            .survey_score_num.large{border-color: #a7db88;background: #d8f0ca;color: #69be3d;}\
            .nps_survey_content{margin-top: 65px;position: relative;}\
            .nps_survey_line{ font-size:15px;}\
            .nps_survey_line .nps_survey_title{margin:20px 0 7px 0;font-weight: bold;}\
            .nps_survey_line .nps_surver_tips{font-size:12px;color:#999;}\
            .nps_survey_line p{color:#999;font-size:12px;margin-bottom:5px;}\
            .nps_survey_line input{width:490px;height:45px;border:1px solid #cccccc;font-size:12px;margin-top: 5px;margin-bottom: 20px;padding-left: 5px;}\
            </style>',
	        success:function(layers,indexs){
                var goNum = 0;
                //评分栏目鼠标经过事件
                $('.survey_score_num').on('mouseenter','li',function(){
                $('.nps_survey_content').removeClass('hide')
                if(goNum < 1) {
                    $(window).resize()
                    goNum++
                }
                var _mouseScore = $(this).text()
                if(!$(this).hasClass('act')){
                    $('.survey_score_num li').removeAttr('class')
                    $('.survey_score_num li').removeAttr('style')
                    $(this).addClass('act')
                    if(_mouseScore <= 6){
                        $(this).css('background-color','red')
                    }else if(_mouseScore == 7 || _mouseScore == 8){
                        $(this).css('background-color','#ff7f00')
                    }else{
                        $(this).css('background-color','#20a53a')
                    }
                }
                })
                // 设置调查信息
                $('.set_survey_info').click(function(){
                    var _score = $('.wafA').index(),
                        _one = $('input[name=problem_one]').val(),
                        _two = $('input[name=problem_two]').val(),
                        _three = $('input[name=problem_three]').val(),
                        kfChat = $('.nps-kf-input').prop('checked');
                        
                    _one = _one == '' ? ' ' : _one
                    _two = _two == '' ? ' ' : _two
                    _three = _three == '' ? ' ' : _three
                    site_monitoring_statistics.http({
                        tips: '提交问卷中,请稍候...',
                        method: 'write_nps',
                        data: {rate:_score,questions:JSON.stringify({
                            "iDKEtySOHMmZjYjczNTUyMDM5WoXwnxp": _one,
                            "PQpWcuZmcMjBjYjczNTUyMDA2GlIeTUE": _two,
                    		"NvyJWBTCtMjkwYjczNTUyMDIwvyQOPBd":_three}),phone_back:kfChat?1:0},
                        success: function (rdata) {
                            if(rdata.status){
                                layer.close(indexs)
                                layer.open({
                                    title: false,
                                    btn: false,
                                    shadeClose: true,
                                    shade:0.1,
                                    closeBtn: 0,
                                    skin:'qa_thank_dialog',
                                    area: '230px',
                                    content: '<div class="qa_thank_box" style="background-color:#F1F9F3;text-align: center;padding: 20px 0;"><img src="/total/static/feedback/QA_like.png" style="width: 55px;"><p style="margin-top: 15px;">感谢您的参与!</p></div>',
                                    success: function (layero,index) {
                                        $(layero).find('.layui-layer-content').css({'padding': '0','border-radius': '5px'})
                                        $(layero).css({'border-radius': '5px','min-width': '230px'})
                                        
                                        setTimeout(function(){layer.close(index)},3000)
                                    }
                                })
                                $('.waf_qa_box').addClass('hide')
                            }
                        }
                    });
                })
	        }
	    })
	}
	//关闭满意度调查
	function close_qa_dialog(){
	    layer.confirm('关闭满意度调查后，将不再展示问卷，是否继续操作？',{
          title: "关闭满意度调查",
          icon: 3,
          closeBtn: 2,
        }, function () {
            site_monitoring_statistics.http({
                tips: '关闭满意度调查中,请稍候...',
                method: 'stop_nps',
                data: {},
                success: function (rdata) {
                    if(rdata.status){
                        layer.msg('关闭成功',{icon:1})
                        $('.waf_qa_box').addClass('hide')
                    }
                }
            });
        });
	}
	site_monitoring_statistics.http({
        load:3,
        method: 'get_nps',
        data: {},
        success: function (rdata) {
            // 是否已提交问卷
            if(!rdata.nps && rdata.safe_day >= 6) $('.waf_qa_box').removeClass('hide')
        }
    });
    </script>
    <script>
    // bt_tools.tab方法调整
    var total_tab_method = function (config) {
        var _that = this;
        function ReaderTab (config) {
            this.config = config;
            this.theme = this.config.theme || {};
            this.active = this.config.active;
        }
        function $verify (value, attr, type) {
            if (!value) return '';
            if (type === true) return value ? ' ' + attr : '';
            if (type === 'style') return attr ? attr + ':' + value + ';' : value;
            return attr ? ' ' + attr + '="' + value + '"' : ' ' + value;
        }
        ReaderTab.prototype = {
            type: 0,
            theme_list: [{
                content: 'tab-body',
                nav: 'tab-nav',
                body: 'tab-con',
                active: 'on'
            },
            {
                content: 'bt-w-body',
                nav: 'bt-w-menu',
                body: 'bt-w-con'
            }],
            random: bt.get_random(5),
            $init: function () {
                var that = this,
                    configList = that.config.list,
                    activeItem = null;

                activeItem = configList.find(function (item) {
                    return item.name === that.active;
                });
                this.$event_bind();
                if (activeItem.success) activeItem.success();
            },
            $reader_content: function () {
                var that = this, _list = that.config.list, _tab = '', _tab_con = '', _theme = that.theme, config = that.config;
                if (typeof that.active === "undefined") that.active = config.list[0]['name'];
                if (!$.isEmptyObject(config.theme)) {
                    _theme = this.theme_list[that.type];
                    $.each(config.theme, function (key, item) {
                        if (_theme[key]) _theme[key] += ' ' + item;
                    });
                    that.theme = _theme;
                }
                if (config.type && $.isEmptyObject(config.theme)) this.theme = this.theme_list[that.type];
                $.each(_list, function (index, item) {
                    var active = (that.active === item.name),
                        _active = _theme['active'] || 'active';
                    _tab += '<span class="' + (active ? _active : '') + '">' + item.title + '</span>';
                    _tab_con += '<div class="tab-block ' + (active ? _active : '') + '">' + (active ? item.content : '') + '</div>';
                });
                that.element = $('<div id="tab_' + that.random + '" class="' + _theme['content'] + $verify(that.config['class']) + '"><div class="' + _theme['nav'] + '" >' + _tab + '</div><div class="' + _theme['body'] + '">' + _tab_con + '</div></div>');
                return that.element[0].outerHTML;
            },
            /**
             * @description 事件绑定
             *
             */
            $event_bind: function () {
                var that = this, _theme = that.theme,
                    active = _theme['active'] || 'active';
                if (!that.el) that.element = $('#tab_' + that.random);
                that.element.on('click', ('.' + _theme['nav'].replace(/\s+/g, '.') + ' span'), function () {
                    var index = $(this).index(),
                        config = that.config.list[index];
                    $(this).addClass(active).siblings().removeClass(active);
                    $('#tab_' + that.random + ' .' + _theme['body'] + '>div:eq(' + index + ')').addClass(active).siblings().removeClass(active);
                    that.active = config.name;
                    if (!config.init) {
                        $('#tab_' + that.random + ' .' + _theme['body'] + '>div:eq(' + index + ')').html(config.content);
                        if (config.success) config.success();
                        config.init = true;
                    }
                });
            }
        }
        return new ReaderTab(config);
    }
    </script>